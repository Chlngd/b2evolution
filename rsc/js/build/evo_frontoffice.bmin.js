/* This includes 10 files: src/evo_modal_window.js, src/evo_images.js, src/evo_user_crop.js, src/evo_user_report.js, src/evo_user_contact_groups.js, src/evo_rest_api.js, src/evo_item_flag.js, src/evo_links.js, ajax.js, shortlinks.js */

function openModalWindow(t,e,s,o,n,i){var r="overlay_page_active";void 0!==o&&1==o&&(r="overlay_page_active_transparent"),void 0===e&&(e="560px");var l="";void 0!==s&&(0<s||""!=s)&&(l=' style="height:'+s+'"'),0<jQuery("#overlay_page").length?jQuery("#overlay_page").html(t):(jQuery("body").append('<div id="screen_mask"></div><div id="overlay_wrap" style="width:'+e+'"><div id="overlay_layout"><div id="overlay_page"'+l+"></div></div></div>"),jQuery("#screen_mask").fadeTo(1,.5).fadeIn(200),jQuery("#overlay_page").html(t).addClass(r),jQuery(document).on("click","#close_button, #screen_mask, #overlay_page",function(t){if("overlay_page"!=jQuery(this).attr("id"))return closeModalWindow(),!1;var e=jQuery("#overlay_page form");if(e.length){var s=e.position().top+jQuery("#overlay_wrap").position().top,o=s+e.height();t.clientY>s&&t.clientY<o||closeModalWindow()}return!0}))}function closeModalWindow(t){return void 0===t&&(t=window.document),jQuery("#overlay_page",t).hide(),jQuery(".action_messages",t).remove(),jQuery("#server_messages",t).insertBefore(".first_payload_block"),jQuery("#overlay_wrap",t).remove(),jQuery("#screen_mask",t).remove(),!1}function user_crop_avatar(t,e,s){void 0===s&&(s="avatar");var o=750,n=320,i=jQuery(window).width(),r=jQuery(window).height(),l=r/i,a=10,_=10;a=n<(i=o<i?o:i<n?n:i)-2*a?10:0,_=n<(r=o<r?o:r<n?n:r)-2*_?10:0;var d=o<i?o:i,c=o<r?o:r;openModalWindow('<span id="spinner" class="loader_img loader_user_report absolute_center" title="'+evo_js_lang_loading+'"></span>',d+"px",c+"px",!0,evo_js_lang_crop_profile_pic,[evo_js_lang_crop,"btn-primary"],!0);var u=jQuery("div.modal-dialog div.modal-body").length?jQuery("div.modal-dialog div.modal-body"):jQuery("#overlay_page"),h=parseInt(u.css("paddingTop")),p=parseInt(u.css("paddingRight")),k=parseInt(u.css("paddingBottom")),v=parseInt(u.css("paddingLeft")),m=(jQuery("div.modal-dialog div.modal-body").length?parseInt(u.css("min-height")):c-100)-(h+k),y={user_ID:t,file_ID:e,aspect_ratio:l,content_width:d-(v+p),content_height:m,display_mode:"js",crumb_user:evo_js_crumb_user};return evo_js_is_backoffice?(y.ctrl="user",y.user_tab="crop",y.user_tab_from=s):(y.blog=evo_js_blog,y.disp="avatar",y.action="crop"),jQuery.ajax({type:"POST",url:evo_js_user_crop_ajax_url,data:y,success:function(t){openModalWindow(t,d+"px",c+"px",!0,evo_js_lang_crop_profile_pic,[evo_js_lang_crop,"btn-primary"])}}),!1}function user_report(t,e){openModalWindow('<span class="loader_img loader_user_report absolute_center" title="'+evo_js_lang_loading+'"></span>',"auto","",!0,evo_js_lang_report_user,[evo_js_lang_report_this_user_now,"btn-danger"],!0);var s={action:"get_user_report_form",user_ID:t,crumb_user:evo_js_crumb_user};return evo_js_is_backoffice?(s.is_backoffice=1,s.user_tab=e):s.blog=evo_js_blog,jQuery.ajax({type:"POST",url:evo_js_user_report_ajax_url,data:s,success:function(t){openModalWindow(t,"auto","",!0,evo_js_lang_report_user,[evo_js_lang_report_this_user_now,"btn-danger"])}}),!1}function user_contact_groups(t){return openModalWindow('<span class="loader_img loader_user_report absolute_center" title="'+evo_js_lang_loading+'"></span>',"auto","",!0,evo_js_lang_contact_groups,evo_js_lang_save,!0),jQuery.ajax({type:"POST",url:evo_js_user_contact_groups_ajax_url,data:{action:"get_user_contact_form",blog:evo_js_blog,user_ID:t,crumb_user:evo_js_crumb_user},success:function(t){openModalWindow(t,"auto","",!0,evo_js_lang_contact_groups,evo_js_lang_save)}}),!1}function evo_rest_api_request(url,params_func,func_method,method){var params=params_func,func=func_method;"function"==typeof params_func&&(func=params_func,params={},method=func_method),void 0===method&&(method="GET"),jQuery.ajax({contentType:"application/json; charset=utf-8",type:method,url:restapi_url+url,data:params}).then(function(data,textStatus,jqXHR){"object"==typeof jqXHR.responseJSON&&eval(func)(data,textStatus,jqXHR)})}function evo_rest_api_print_error(t,e,s){if("string"!=typeof e&&void 0===e.code&&(e=void 0===e.responseJSON?e.statusText:e.responseJSON),void 0===e.code)var o='<h4 class="text-danger">Unknown error: '+e+"</h4>";else{o='<h4 class="text-danger">'+e.message+"</h4>";s&&(o+="<div><b>Code:</b> "+e.code+"</div><div><b>Status:</b> "+e.data.status+"</div>")}evo_rest_api_end_loading(t,o)}function evo_rest_api_start_loading(t){jQuery(t).addClass("evo_rest_api_loading").append('<div class="evo_rest_api_loader">loading...</div>')}function evo_rest_api_end_loading(t,e){jQuery(t).removeClass("evo_rest_api_loading").html(e).find(".evo_rest_api_loader").remove()}function evo_link_initialize_fieldset(s){if(0<jQuery("#"+s+"attachments_fieldset_table").length){var t=jQuery("#"+s+"attachments_fieldset_table").height();t=320<t?320:t<97?97:t,jQuery("#"+s+"attachments_fieldset_wrapper").height(t),jQuery("#"+s+"attachments_fieldset_wrapper").resizable({minHeight:80,handles:"s",resize:function(t,e){jQuery("#"+s+"attachments_fieldset_wrapper").resizable("option","maxHeight",jQuery("#"+s+"attachments_fieldset_table").height()),evo_link_update_overlay(s)}}),jQuery(document).on("click","#"+s+"attachments_fieldset_wrapper .ui-resizable-handle",function(){var t=jQuery("#"+s+"attachments_fieldset_table").height(),e=jQuery("#"+s+"attachments_fieldset_wrapper").height()+80;jQuery("#"+s+"attachments_fieldset_wrapper").css("height",t<e?t:e),evo_link_update_overlay(s)})}}function evo_link_update_overlay(t){jQuery("#"+t+"attachments_fieldset_overlay").length&&jQuery("#"+t+"attachments_fieldset_overlay").css("height",jQuery("#"+t+"attachments_fieldset_wrapper").closest(".panel").height())}function evo_link_fix_wrapper_height(t){var e=void 0===t?"":t,s=jQuery("#"+e+"attachments_fieldset_table").height();jQuery("#"+e+"attachments_fieldset_wrapper").height()!=s&&jQuery("#"+e+"attachments_fieldset_wrapper").height(jQuery("#"+e+"attachments_fieldset_table").height())}function evo_link_change_position(s,t,e){var o=s,n=s.value,i=s.id.substr(17);return jQuery.get(t+"anon_async.php?action=set_object_link_position&link_ID="+i+"&link_position="+n+"&crumb_link="+e,{},function(t,e){"OK"==(t=ajax_debug_clear(t))?(evoFadeSuccess(jQuery(o).closest("tr")),jQuery(o).closest("td").removeClass("error"),"cover"==n&&jQuery("select[name=link_position][id!="+s.id+"] option[value=cover]:selected").each(function(){jQuery(this).parent().val("aftermore"),evoFadeSuccess(jQuery(this).closest("tr"))})):(jQuery(o).val(t),evoFadeFailure(jQuery(o).closest("tr")),jQuery(o.form).closest("td").addClass("error"))}),!1}function evo_link_insert_inline(t,e,s,o,n){if(null==o&&(o=0),"undefined"!=typeof b2evoCanvas){var i="["+t+":"+e;s.length&&(i+=":"+s),i+="]",void 0!==n&&!1!==n&&(i+=n+"[/"+t+"]");var r=jQuery("#display_position_"+e);0!=r.length&&"inline"!=r.val()?(deferInlineReminder=!0,evo_rest_api_request("links/"+e+"/position/inline",function(t){r.val("inline"),evoFadeSuccess(r.closest("tr")),r.closest("td").removeClass("error"),textarea_wrap_selection(b2evoCanvas,i,"",o,window.document)},"POST"),deferInlineReminder=!1):textarea_wrap_selection(b2evoCanvas,i,"",o,window.document)}}function evo_link_delete(o,n,i,t){return evo_rest_api_request("links/"+i,{action:t},function(t){if("item"==n||"comment"==n||"emailcampaign"==n||"message"==n){var e=window.b2evoCanvas;if(null!=e){var s=new RegExp("\\[(image|file|inline|video|audio|thumbnail):"+i+":?[^\\]]*\\]","ig");textarea_str_replace(e,s,"",window.document)}}jQuery(o).closest("tr").remove(),evo_link_fix_wrapper_height()},"DELETE"),!1}function evo_link_change_order(a,t,_){return evo_rest_api_request("links/"+t+"/"+_,function(t){var e=jQuery(a).closest("tr"),s=e.find("span[data-order]");if("move_up"==_){var o=s.attr("data-order"),n=jQuery(e.prev()).find("span[data-order]"),i=n.attr("data-order");e.prev().before(e),s.attr("data-order",i),n.attr("data-order",o)}else{o=s.attr("data-order");var r=jQuery(e.next()).find("span[data-order]"),l=r.attr("data-order");e.next().after(e),s.attr("data-order",l),r.attr("data-order",o)}evoFadeSuccess(e)},"POST"),!1}function evo_link_attach(t,e,s,o){return evo_rest_api_request("links",{action:"attach",type:t,object_ID:e,root:s,path:o},function(t){var e=jQuery("#attachments_fieldset_table .results table",window.parent.document),s=(e.parent,jQuery(t.list_content));e.replaceWith(jQuery("table",s)).promise().done(function(t){setTimeout(function(){window.parent.evo_link_fix_wrapper_height()},10)})}),!1}function evo_link_ajax_loading_overlay(){var t=jQuery("#attachments_fieldset_table"),e=!1;return 0==t.find(".results_ajax_loading").length&&(e=jQuery('<div class="results_ajax_loading"><div>&nbsp;</div></div>'),t.css("position","relative"),e.css({width:t.width(),height:t.height()}),t.append(e)),e}function evo_link_refresh_list(t,e,s){var o=evo_link_ajax_loading_overlay();return o&&evo_rest_api_request("links",{action:void 0===s?"refresh":"sort",type:t.toLowerCase(),object_ID:e},function(t){jQuery("#attachments_fieldset_table").html(t.html),o.remove(),evo_link_fix_wrapper_height()}),!1}function evo_link_sort_list(s){var o,n=jQuery("#"+s+"attachments_fieldset_table tbody.filelist_tbody tr");n.sort(function(t,e){var s=parseInt(jQuery("span[data-order]",t).attr("data-order")),o=parseInt(jQuery("span[data-order]",e).attr("data-order"));return(s=s||n.length)<(o=o||n.length)?-1:o<s?1:0}),$.each(n,function(t,e){o=(0===t?jQuery(e).prependTo("#"+s+"attachments_fieldset_table tbody.filelist_tbody"):jQuery(e).insertAfter(o),e)})}function ajax_debug_clear(t){return t=(t=t.replace(/<!-- Ajax response end -->/,"")).replace(/(<div class="jslog">[\s\S]*)/i,""),jQuery.trim(t)}function ajax_response_is_correct(t){return!!t.match(/<!-- Ajax response end -->/)&&""!=(t=ajax_debug_clear(t))}function shortlinks_load_window(t,e){var s;switch(t){case"move_comment_to_post":s=shortlinks_title_move_comment_to_post,shortlinks_action_buttons='<button id="shortlinks_btn_move_comment" class="btn btn-primary">'+shortlinks_move_to_post+"</button>";break;case"shortlinks":s=shortlinks_title_link_to_post,shortlinks_action_buttons='<button id="shortlinks_btn_insert" class="btn btn-primary">'+shortlinks_insert_short_link+'</button><button id="shortlinks_btn_options" class="btn btn-default">'+shortlinks_insert_with_options+'...</button><button id="shortlinks_btn_form" class="btn btn-info">'+shortlinks_insert_snippet_link+"...</button>"}openModalWindow('<div id="shortlinks_wrapper"></div>',"auto","",!0,s,["-","shortlinks_post_buttons"],!0),shortlinks_load_colls(shortlinks_coll_urlname,e);var o=jQuery("#shortlinks_wrapper").parent(),n=jQuery(window).height()-20;return o.hasClass("modal-body")&&(n-=119+parseInt(o.css("padding-top"))+parseInt(o.css("padding-bottom"))),o.css({display:"block",overflow:"auto","max-height":n}),!1}function shortlinks_api_print_error(t,e,s){if("string"!=typeof e&&void 0===e.code&&(e=void 0===e.responseJSON?e.statusText:e.responseJSON),void 0===e.code)var o='<h4 class="text-danger">Unknown error: '+e+"</h4>";else{o='<h4 class="text-danger">'+e.message+"</h4>";s&&(o+="<div><b>Code:</b> "+e.code+"</div><div><b>Status:</b> "+e.data.status+"</div>")}shortlinks_end_loading(t,o)}function shortlinks_api_request(t,e,s,o){shortlinks_start_loading(e),void 0===o&&(o={}),jQuery.ajax({url:restapi_url+t,data:o}).then(s,function(t){shortlinks_api_print_error(e,t)})}function shortlinks_start_loading(t){jQuery(t).addClass("shortlinks_loading").append('<div class="shortlinks_loader">loading...</div>')}function shortlinks_end_loading(t,e){jQuery(t).removeClass("shortlinks_loading").html(e).find(".shortlinks_loader").remove()}function shortlinks_get_pagination(t,e){var s="";if(void 0===t.pages_total||t.pages_total<2)return s;var o,n,i=void 0===e?"":' data-search="'+e.replace('"','"')+'"',r=t.page,l=t.pages_total;for(o=r<=parseInt(5.5)?1:r>l-parseInt(5.5)?Math.max(1,l-11+1):r-parseInt(5.5),n=r>l-parseInt(5.5)?l:Math.min(l,o+11-1),s+='<ul class="shortlinks_pagination pagination"'+i+">",1<r&&(s+='<li><a href="#" data-page="'+(r-1)+'">&lt;&lt;</a></li>'),1<o&&(s+='<li><a href="#" data-page="1">1</a></li>',2<o&&(s+='<li><a href="#" data-page="'+Math.ceil(o/2)+'">...</a></li>')),p=o;p<=n;p++)r==p?s+='<li class="active"><span>'+p+"</span></li>":s+='<li><a href="#" data-page="'+p+'">'+p+"</a></li>";return n<l&&(n<l-1&&(s+='<li><a href="#" data-page="'+(n+Math.floor((l-n)/2))+'">...</a></li>'),s+='<li><a href="#" data-page="'+l+'">'+l+"</a></li>"),r<l&&(s+='<li><a href="#" data-page="'+(r+1)+'">&gt;&gt;</a></li>'),s+="</ul>"}function shortlinks_load_colls(r,l){shortlinks_api_request("collections","#shortlinks_wrapper",function(t){var e="",s="",o='<div id="shortlinks_colls_list"><h2>'+shortlinks_collections+'</h2><select class="form-control" id="shortlinks_collections">';for(var n in t.colls){var i=t.colls[n];o+='<option value="'+i.urlname+'" data-coll-id="'+i.id+'" '+(r==i.urlname?' selected="selected"':"")+">"+i.shortname+" : "+i.name+"</option>",""!=e&&i.urlname!=r||(e=i.urlname,s=i.name)}shortlinks_end_loading("#shortlinks_wrapper",o+='</select></div><div id="shortlinks_posts_block"></div><div id="shortlinks_post_block"></div><input type="hidden" id="shortlinks_hidden_prefix" value="'+(l||"")+'" /><div id="shortlinks_post_form" style="display:none"><input type="hidden" id="shortlinks_hidden_ID" /><input type="hidden" id="shortlinks_hidden_cover_link" /><input type="hidden" id="shortlinks_hidden_teaser_link" /><input type="hidden" id="shortlinks_hidden_urltitle" /><input type="hidden" id="shortlinks_hidden_title" /><input type="hidden" id="shortlinks_hidden_excerpt" /><input type="hidden" id="shortlinks_hidden_teaser" /><p><label><input type="checkbox" id="shortlinks_form_full_cover" /> '+shortlinks_insert_full_cover_image+'</label><p><p><label><input type="checkbox" id="shortlinks_form_title" checked="checked" /> '+shortlinks_insert_title+'</label><p><p><label><input type="checkbox" id="shortlinks_form_thumb_cover" checked="checked" /> '+shortlinks_insert_thumbnail_of_cover+'</label><p><p><label><input type="checkbox" id="shortlinks_form_excerpt" checked="checked" /> '+shortlinks_insert_excerpt+'</label><p><p><label><input type="checkbox" id="shortlinks_form_teaser" /> '+shortlinks_insert_teaser+'</label><p><p><label><input type="checkbox" id="shortlinks_form_more" checked="checked" /> '+shortlinks_insert_read_more_link+'</label><p></div><div id="shortlinks_post_options" class="form-horizontal" style="display:none"><div class="form-group"><label class="control-label col-sm-2">'+shortlinks_slug+':</label><div class="controls col-sm-10"><input type="text" id="shortlinks_opt_slug" class="form-control" style="width:100%" /></div></div><div class="form-group"><label class="control-label col-sm-2">'+shortlinks_mode+':</label><div class="controls col-sm-10"><div class="radio"><label><input type="radio" name="shortlinks_opt_mode" id="shortlinks_opt_mode_title" checked="checked"><code>[[...]]</code> '+shortlinks_use_title+'</label></div><div class="radio"><label><input type="radio" name="shortlinks_opt_mode" id="shortlinks_opt_mode_slug"><code>((...))</code> '+shortlinks_use_slug_words+'</label></div></div></div><div class="form-group"><label class="control-label col-sm-2">'+shortlinks_classes+':</label><div class="controls col-sm-10"><input type="text" id="shortlinks_opt_classes" class="form-control" style="width:100%" /></div></div><div class="form-group"><label class="control-label col-sm-2">'+shortlinks_target+':</label><div class="controls col-sm-10"><select id="shortlinks_opt_target" class="form-control"><option value="">'+shortlinks_none+'</option><option value="_blank">'+shortlinks_blank+'</option><option value="_parent">'+shortlinks_parent+'</option><option value="_top">'+shortlinks_top+'</option></select></div></div><div class="form-group"><label class="control-label col-sm-2">'+shortlinks_text+':</label><div class="controls col-sm-10"><input type="text" id="shortlinks_opt_text" class="form-control" style="width:100%" /></div></div></div>'),""!=e&&shortlinks_load_coll_posts(e,s)},{list_in_frontoffice:"all",per_page:-1})}function shortlinks_display_search_form(t,e,s){var o="<h2>"+e+'</h2><form class="form-inline" id="shortlinks_search__form" data-urlname="'+t+'"><div class="input-group"><input type="text" id="shortlinks_search__input" class="form-control" value="'+(void 0===s?"":s)+'"><span class="input-group-btn"><button id="shortlinks_search__submit" class="btn btn-primary">'+shortlinks_search+'</button></span></div> <button id="shortlinks_search__clear" class="btn btn-default">'+shortlinks_clear+'</button></form><div id="shortlinks_posts_list"></div>';jQuery("#shortlinks_posts_block").html(o)}function shortlinks_load_coll_posts(n,t,e){void 0!==t&&!1!==t&&shortlinks_display_search_form(n,t),shortlinks_api_request("collections/"+n+"/items&orderby=datemodified&order=DESC"+(void 0===e||e<2?"":"&page="+e),"#shortlinks_posts_list",function(t){var e="<ul>";for(var s in t.items){var o=t.items[s];e+='<li><a href="#" data-id="'+o.id+'" data-urlname="'+n+'">'+o.title+"</a></li>"}e+="</ul>",shortlinks_end_loading("#shortlinks_posts_list",e+=shortlinks_get_pagination(t))})}function shortlinks_load_coll_search(n,i,t){shortlinks_api_request("collections/"+n+"/search/"+i+"&kind=item"+(void 0===t||t<2?"":"&page="+t),"#shortlinks_posts_list",function(t){if(void 0===t.code){var e="<ul>";for(var s in t.results){var o=t.results[s];"item"==o.kind&&(e+="<li>",e+='<a href="#" data-id="'+o.id+'" data-urlname="'+n+'">'+o.title+"</a>",e+="</li>")}e+="</ul>",shortlinks_end_loading("#shortlinks_posts_list",e+=shortlinks_get_pagination(t,i))}else shortlinks_api_print_error("#shortlinks_posts_list",t)})}if(jQuery(document).keyup(function(t){27==t.keyCode&&closeModalWindow()}),jQuery(document).ready(function(){jQuery("img.loadimg").each(function(){jQuery(this).prop("complete")?(jQuery(this).removeClass("loadimg"),""==jQuery(this).attr("class")&&jQuery(this).removeAttr("class")):jQuery(this).on("load",function(){jQuery(this).removeClass("loadimg"),""==jQuery(this).attr("class")&&jQuery(this).removeAttr("class")})})}),jQuery(document).on("click","a.evo_post_flag_btn",function(){var e=jQuery(this),t=parseInt(e.data("id"));return 0<t&&(e.data("status","inprogress"),jQuery("span",jQuery(this)).addClass("fa-x--hover"),evo_rest_api_request("collections/"+e.data("coll")+"/items/"+t+"/flag",function(t){t.flag?(e.find("span:first").show(),e.find("span:last").hide()):(e.find("span:last").show(),e.find("span:first").hide()),jQuery("span",e).removeClass("fa-x--hover"),setTimeout(function(){e.removeData("status")},500)},"PUT")),!1}),jQuery(document).on("mouseover","a.evo_post_flag_btn",function(){"inprogress"!=jQuery(this).data("status")&&jQuery("span",jQuery(this)).addClass("fa-x--hover")}),"undefined"==typeof b2evo_shortlinks_initialized){function shortlinks_insert_link_text(t){"undefined"!=typeof tinyMCE&&void 0!==tinyMCE.activeEditor&&tinyMCE.activeEditor&&tinyMCE.execCommand("mceFocus",!1,tinyMCE.activeEditor.id),textarea_wrap_selection(window[jQuery("#shortlinks_hidden_prefix").val()+"b2evoCanvas"],t,"",0),closeModalWindow()}function shortlinks_insert_complex_link(t,e){var s="";void 0!==t&&""!=t&&(s+="\r\n"+t),jQuery("#shortlinks_form_title").is(":checked")&&(s+="\r\n## [["+jQuery("#shortlinks_hidden_urltitle").val()+" "+jQuery("#shortlinks_hidden_title").val()+"]]"),void 0!==e&&""!=e&&(s+="\r\n"+e),jQuery("#shortlinks_form_excerpt").is(":checked")&&(s+=(void 0!==e&&""!=e?" ":"\r\n")+jQuery("#shortlinks_hidden_excerpt").val()),jQuery("#shortlinks_form_teaser").is(":checked")&&(s+="\r\n"+jQuery("#shortlinks_hidden_teaser").val()),jQuery("#shortlinks_form_more").is(":checked")&&(s+="\r\n[["+jQuery("#shortlinks_hidden_urltitle").val()+" "+shortlinks_read_more+"...]]"),""!=s&&(s+="\r\n\r\n"),"undefined"!=typeof tinyMCE&&void 0!==tinyMCE.activeEditor&&tinyMCE.activeEditor&&tinyMCE.execCommand("mceFocus",!1,tinyMCE.activeEditor.id),textarea_wrap_selection(window[jQuery("#shortlinks_hidden_prefix").val()+"b2evoCanvas"],s,"",0),closeModalWindow()}b2evo_shortlinks_initialized=!0,jQuery(document).on("change","#shortlinks_colls_list select",function(){return shortlinks_load_coll_posts(jQuery(this).val(),jQuery("option:selected",this).text()),!1}),jQuery(document).on("submit","#shortlinks_search__form",function(){return shortlinks_load_coll_search(jQuery(this).data("urlname"),jQuery("#shortlinks_search__input").val()),!1}),jQuery(document).on("click","#shortlinks_search__clear",function(){return shortlinks_load_coll_posts(jQuery(this).closest("form").data("urlname")),jQuery("#shortlinks_search__input").val(""),!1}),jQuery(document).on("click","#shortlinks_posts_list a[data-id]",function(){var t=jQuery(this).data("urlname"),e=jQuery(this).data("id");return jQuery("#shortlinks_colls_list, #shortlinks_posts_block").hide(),jQuery("#shortlinks_post_block").show(),jQuery("#shortlinks_post_block").data("post")==e?jQuery("#shortlinks_btn_back_to_list, #shortlinks_btn_insert").show():(jQuery("#shortlinks_post_block").html(""),shortlinks_api_request("collections/"+t+"/items/"+e,"#shortlinks_post_block",function(t){jQuery("#shortlinks_post_block").data("post",t.id),jQuery("#shortlinks_hidden_ID").val(t.id),jQuery("#shortlinks_hidden_urltitle").val(t.urltitle),jQuery("#shortlinks_hidden_title").val(t.title),jQuery("#shortlinks_hidden_excerpt").val(t.excerpt),jQuery("#shortlinks_hidden_teaser").val(t.teaser),jQuery("#shortlinks_hidden_cover_link").val(""),jQuery("#shortlinks_hidden_teaser_link").val(""),jQuery("#shortlinks_hidden_coll_ID").val();var e="<h2>"+t.title+"</h2>";if("object"==typeof t.attachments&&0<t.attachments.length)for(var s in t.attachments){var o=t.attachments[s];"image"==o.type&&("cover"==o.position&&jQuery("#shortlinks_hidden_cover_link").val(o.link_ID),""==jQuery("#shortlinks_hidden_teaser_link").val()&&jQuery("#shortlinks_hidden_teaser_link").val(o.link_ID))}shortlinks_end_loading("#shortlinks_post_block",e+='<div id="shortlinks_post_content">'+t.content.replace(/(<h([1-6]).*id\s*=\s*"[^"]+"[^>]*>.+?)(<\/h\2>)/gi,'$1 <button class="btn btn-primary shortlinks_btn_insert_anchor">'+shortlinks_insert_short_link+"</button>$3")+"</div>");var n=jQuery(".shortlinks_post_buttons").length?jQuery(".shortlinks_post_buttons"):jQuery("#shortlinks_post_content");jQuery("#shortlinks_btn_back_to_list, #shortlinks_btn_move_comment, #shortlinks_btn_insert, #shortlinks_btn_form, #shortlinks_btn_options").remove(),n.after('<button id="shortlinks_btn_back_to_list" class="btn btn-default">&laquo; '+shortlinks_back+"</button>"+shortlinks_action_buttons),jQuery("#shortlinks_opt_slug").val(t.urltitle)})),!1}),jQuery(document).on("click","#shortlinks_btn_move_comment",function(){var t=jQuery(".comment_item_title")[0];t.innerHTML=jQuery("#shortlinks_hidden_title").val(),t.href="?ctrl=items&blog="+jQuery("#shortlinks_collections").find(":selected").data("coll-id")+"&p="+jQuery("#shortlinks_hidden_ID").val(),shortlinks_coll_urlname=jQuery("#shortlinks_collections").find(":selected").val(),jQuery('input[name="moveto_post"]').val(jQuery("#shortlinks_hidden_ID").val()),closeModalWindow()}),jQuery(document).on("click","#shortlinks_btn_insert",function(){shortlinks_insert_link_text("[["+jQuery("#shortlinks_hidden_urltitle").val()+"]]")}),jQuery(document).on("click",".shortlinks_btn_insert_anchor",function(){var t=jQuery(this).parent();shortlinks_insert_link_text("(("+jQuery("#shortlinks_hidden_urltitle").val()+"#"+t.attr("id")+" "+t.html().replace(/(\s<a[^>]+>.+?<\/a>)?\s<button[^>]+>.+?<\/button>$/,"")+"))")}),jQuery(document).on("click","#shortlinks_btn_insert_with_options",function(){if(jQuery("#shortlinks_opt_mode_title").is(":checked"))var t="[[",e="]]";else t="((",e="))";var s=t;s+=jQuery("#shortlinks_opt_slug").val();var o=jQuery("#shortlinks_opt_classes").val().trim();""!=(o=o.replace(/^\./g,"").replace(/\s+/g,".").replace(/\.+/g,"."))&&(s+=" ."+o);var n=jQuery("#shortlinks_opt_target option:selected").val().trim();""!=n&&(s+=" "+n);var i=jQuery("#shortlinks_opt_text").val().trim();""!=i&&(s+=" "+i),shortlinks_insert_link_text(s+=e)}),jQuery(document).on("click","#shortlinks_btn_form",function(){jQuery("#modal_window .modal-title").html(shortlinks_insert_snippet_link),jQuery("#shortlinks_post_block, #shortlinks_btn_insert").hide(),jQuery("#shortlinks_post_form").show();var t=jQuery(".shortlinks_post_buttons").length?jQuery(".shortlinks_post_buttons"):jQuery("#shortlinks_post_content");return jQuery("#shortlinks_btn_back_to_list, #shortlinks_btn_move_comment, #shortlinks_btn_insert, #shortlinks_btn_form, #shortlinks_btn_options").hide(),t.after('<button id="shortlinks_btn_back_to_post" class="btn btn-default">&laquo; '+shortlinks_back+'</button><button id="shortlinks_btn_insert_complex" class="btn btn-primary">'+shortlinks_insert_snippet_link+"</button>"),!1}),jQuery(document).on("click","#shortlinks_btn_insert_complex",function(){if(!jQuery("input[id^=shortlinks_form_]").is(":checked"))return alert(shortlinks_select_item),!1;var t=!1,e=!1;jQuery("input[type=hidden][name=temp_link_owner_ID]").length?(t="temporary",e=jQuery("input[type=hidden][name=temp_link_owner_ID]").val()):jQuery("input[type=hidden][name=post_ID]").length&&jQuery("input[type=hidden][name=item_typ_ID]").length?(t="item",e=jQuery("input[type=hidden][name=post_ID]").val()):jQuery("input[type=hidden][name=comment_ID]").length||jQuery("input[type=hidden][name=comment_item_ID]").length?(t="comment",jQuery("input[type=hidden][name=comment_ID]").length&&(e=jQuery("input[type=hidden][name=comment_ID]").val())):jQuery("input[type=hidden][name=ecmp_ID]").length?(t="emailcampaign",e=jQuery("input[type=hidden][name=ecmp_ID]").val()):jQuery("input[name=msg_text]").length&&(t="message",e=0);var s=jQuery("#shortlinks_form_full_cover").is(":checked")&&""!=jQuery("#shortlinks_hidden_cover_link").val()||jQuery("#shortlinks_form_thumb_cover").is(":checked")&&""!=jQuery("#shortlinks_hidden_teaser_link").val();if(s&&0!=t&&0<e){shortlinks_start_loading("#shortlinks_post_block");var o="";jQuery("#shortlinks_form_full_cover").is(":checked")&&!jQuery("#shortlinks_form_thumb_cover").is(":checked")&&(o="cover"),evo_rest_api_request("links",{action:"copy",source_type:"item",source_object_ID:jQuery("#shortlinks_hidden_ID").val(),source_position:o,source_file_type:"image",dest_type:t,dest_object_ID:e,dest_position:"inline",limit_position:1},function(t){var e="",s="";for(var o in t.links){var n=t.links[o];"cover"==n.orig_position&&jQuery("#shortlinks_form_full_cover").is(":checked")&&(e="[image:"+n.ID+"]"),jQuery("#shortlinks_form_thumb_cover").is(":checked")&&(s="[thumbnail:"+n.ID+"]")}shortlinks_insert_complex_link(e,s),shortlinks_end_loading("#shortlinks_post_block",jQuery("#shortlinks_post_block").html());var i=jQuery("a[onclick*=evo_link_refresh_list]");i.length&&i.click()})}else s&&alert("Please save your "+t+" before trying to attach files. This limitation will be removed in a future version of b2evolution."),shortlinks_insert_complex_link();return!1}),jQuery(document).on("click","#shortlinks_btn_options",function(){jQuery("#modal_window .modal-title").html(shortlinks_insert_with_options+"..."),jQuery("#shortlinks_post_block, #shortlinks_btn_insert").hide(),jQuery("#shortlinks_post_options").show();var t=jQuery(".shortlinks_post_buttons").length?jQuery(".shortlinks_post_buttons"):jQuery("#shortlinks_post_content");return jQuery("#shortlinks_btn_back_to_list, #shortlinks_btn_insert, #shortlinks_btn_form, #shortlinks_btn_options").hide(),t.after('<button id="shortlinks_btn_back_to_post" class="btn btn-default">&laquo; '+shortlinks_back+'</button><button id="shortlinks_btn_insert_with_options" class="btn btn-primary">'+shortlinks_insert_link+"</button>"),!1}),jQuery(document).on("click","#shortlinks_btn_back_to_list",function(){return jQuery("#shortlinks_colls_list, #shortlinks_posts_block").show(),jQuery("#shortlinks_post_block, #shortlinks_btn_back_to_list, #shortlinks_btn_insert, #shortlinks_btn_form, #shortlinks_btn_options").hide(),!1}),jQuery(document).on("click","#shortlinks_btn_back_to_post",function(){return jQuery("#modal_window .modal-title").html(shortlinks_link_to_post),jQuery("#shortlinks_post_block, #shortlinks_btn_back_to_list, #shortlinks_btn_insert, #shortlinks_btn_form, #shortlinks_btn_options").show(),jQuery("#shortlinks_btn_back_to_post, #shortlinks_btn_insert_complex, #shortlinks_btn_insert_with_options, #shortlinks_post_form, #shortlinks_post_options").hide(),!1}),jQuery(document).on("click",".shortlinks_pagination a",function(){var t=jQuery("#shortlinks_colls_list select"),e=jQuery(this).closest(".shortlinks_pagination");return null==e.data("search")?shortlinks_load_coll_posts(t.val(),!1,jQuery(this).data("page")):shortlinks_load_coll_search(t.val(),e.data("search"),jQuery(this).data("page")),!1})}