/* This includes 11 files: src/evo_modal_window.js, src/evo_images.js, src/evo_user_crop.js, src/evo_user_report.js, src/evo_user_contact_groups.js, src/evo_rest_api.js, src/evo_item_flag.js, src/evo_links.js, src/evo_forms.js, ajax.js, src/ddexitpop.js */

function evo_prevent_key_enter(e){jQuery(e).keypress(function(e){if(13==e.keyCode)return!1})}function evo_render_star_rating(){jQuery("#comment_rating").each(function(e){var t=jQuery("span.raty_params",this);t&&jQuery(this).html("").raty(t)})}function openModalWindow(e,t,n,o,r,i){var a="overlay_page_active";void 0!==o&&1==o&&(a="overlay_page_active_transparent"),void 0===t&&(t="560px");var s="";void 0!==n&&(0<n||""!=n)&&(s=' style="height:'+n+'"'),0<jQuery("#overlay_page").length?jQuery("#overlay_page").html(e):(jQuery("body").append('<div id="screen_mask"></div><div id="overlay_wrap" style="width:'+t+'"><div id="overlay_layout"><div id="overlay_page"'+s+"></div></div></div>"),jQuery("#screen_mask").fadeTo(1,.5).fadeIn(200),jQuery("#overlay_page").html(e).addClass(a),jQuery(document).on("click","#close_button, #screen_mask, #overlay_page",function(e){if("overlay_page"!=jQuery(this).attr("id"))return closeModalWindow(),!1;var t=jQuery("#overlay_page form");if(t.length){var n=t.position().top+jQuery("#overlay_wrap").position().top,o=n+t.height();e.clientY>n&&e.clientY<o||closeModalWindow()}return!0}))}function closeModalWindow(e){return void 0===e&&(e=window.document),jQuery("#overlay_page",e).hide(),jQuery(".action_messages",e).remove(),jQuery("#server_messages",e).insertBefore(".first_payload_block"),jQuery("#overlay_wrap",e).remove(),jQuery("#screen_mask",e).remove(),!1}function user_crop_avatar(e,t,n){void 0===n&&(n="avatar");var o=750,r=jQuery(window).width(),i=jQuery(window).height(),a=i/r,s=10,_=10;s=320<(r=o<r?o:r<320?320:r)-2*s?10:0,_=320<(i=o<i?o:i<320?320:i)-2*_?10:0;var u=o<r?o:r,c=o<i?o:i;openModalWindow('<span id="spinner" class="loader_img loader_user_report absolute_center" title="'+evo_js_lang_loading+'"></span>',u+"px",c+"px",!0,evo_js_lang_crop_profile_pic,[evo_js_lang_crop,"btn-primary"],!0);var d=jQuery("div.modal-dialog div.modal-body").length?jQuery("div.modal-dialog div.modal-body"):jQuery("#overlay_page"),l=parseInt(d.css("paddingTop")),p=parseInt(d.css("paddingRight")),f=parseInt(d.css("paddingBottom")),y=parseInt(d.css("paddingLeft")),h=(jQuery("div.modal-dialog div.modal-body").length?parseInt(d.css("min-height")):c-100)-(l+f),m={user_ID:e,file_ID:t,aspect_ratio:a,content_width:u-(y+p),content_height:h,display_mode:"js",crumb_user:evo_js_crumb_user};return evo_js_is_backoffice?(m.ctrl="user",m.user_tab="crop",m.user_tab_from=n):(m.blog=evo_js_blog,m.disp="avatar",m.action="crop"),jQuery.ajax({type:"POST",url:evo_js_user_crop_ajax_url,data:m,success:function(e){openModalWindow(e,u+"px",c+"px",!0,evo_js_lang_crop_profile_pic,[evo_js_lang_crop,"btn-primary"])}}),!1}function user_report(e,t){openModalWindow('<span class="loader_img loader_user_report absolute_center" title="'+evo_js_lang_loading+'"></span>',"auto","",!0,evo_js_lang_report_user,[evo_js_lang_report_this_user_now,"btn-danger"],!0);var n={action:"get_user_report_form",user_ID:e,crumb_user:evo_js_crumb_user};return evo_js_is_backoffice?(n.is_backoffice=1,n.user_tab=t):n.blog=evo_js_blog,jQuery.ajax({type:"POST",url:evo_js_user_report_ajax_url,data:n,success:function(e){openModalWindow(e,"auto","",!0,evo_js_lang_report_user,[evo_js_lang_report_this_user_now,"btn-danger"])}}),!1}function user_contact_groups(e){return openModalWindow('<span class="loader_img loader_user_report absolute_center" title="'+evo_js_lang_loading+'"></span>',"auto","",!0,evo_js_lang_contact_groups,evo_js_lang_save,!0),jQuery.ajax({type:"POST",url:evo_js_user_contact_groups_ajax_url,data:{action:"get_user_contact_form",blog:evo_js_blog,user_ID:e,crumb_user:evo_js_crumb_user},success:function(e){openModalWindow(e,"auto","",!0,evo_js_lang_contact_groups,evo_js_lang_save)}}),!1}function evo_rest_api_request(url,params_func,func_method,method){var params=params_func,func=func_method;"function"==typeof params_func&&(func=params_func,params={},method=func_method),void 0===method&&(method="GET"),jQuery.ajax({contentType:"application/json; charset=utf-8",type:method,url:restapi_url+url,data:params}).then(function(data,textStatus,jqXHR){"object"==typeof jqXHR.responseJSON&&eval(func)(data,textStatus,jqXHR)})}function evo_rest_api_print_error(e,t,n){if("string"!=typeof t&&void 0===t.code&&(t=void 0===t.responseJSON?t.statusText:t.responseJSON),void 0===t.code)var o='<h4 class="text-danger">Unknown error: '+t+"</h4>";else o='<h4 class="text-danger">'+t.message+"</h4>",n&&(o+="<div><b>Code:</b> "+t.code+"</div><div><b>Status:</b> "+t.data.status+"</div>");evo_rest_api_end_loading(e,o)}function evo_rest_api_start_loading(e){jQuery(e).addClass("evo_rest_api_loading").append('<div class="evo_rest_api_loader">loading...</div>')}function evo_rest_api_end_loading(e,t){jQuery(e).removeClass("evo_rest_api_loading").html(t).find(".evo_rest_api_loader").remove()}function evo_link_initialize_fieldset(n){if(0<jQuery("#"+n+"attachments_fieldset_table").length){var e=jQuery("#"+n+"attachments_fieldset_table").height();e=320<e?320:e<97?97:e,jQuery("#"+n+"attachments_fieldset_wrapper").height(e),jQuery("#"+n+"attachments_fieldset_wrapper").resizable({minHeight:80,handles:"s",resize:function(e,t){jQuery("#"+n+"attachments_fieldset_wrapper").resizable("option","maxHeight",jQuery("#"+n+"attachments_fieldset_table").height()),evo_link_update_overlay(n)}}),jQuery(document).on("click","#"+n+"attachments_fieldset_wrapper .ui-resizable-handle",function(){var e=jQuery("#"+n+"attachments_fieldset_table").height(),t=jQuery("#"+n+"attachments_fieldset_wrapper").height()+80;jQuery("#"+n+"attachments_fieldset_wrapper").css("height",e<t?e:t),evo_link_update_overlay(n)})}}function evo_link_update_overlay(e){jQuery("#"+e+"attachments_fieldset_overlay").length&&jQuery("#"+e+"attachments_fieldset_overlay").css("height",jQuery("#"+e+"attachments_fieldset_wrapper").closest(".panel").height())}function evo_link_fix_wrapper_height(e){var t=void 0===e?"":e,n=jQuery("#"+t+"attachments_fieldset_table").height();jQuery("#"+t+"attachments_fieldset_wrapper").height()!=n&&jQuery("#"+t+"attachments_fieldset_wrapper").height(jQuery("#"+t+"attachments_fieldset_table").height())}function evo_link_change_position(n,e,t){var o=n,r=n.value,i=n.id.substr(17);return jQuery.get(e+"anon_async.php?action=set_object_link_position&link_ID="+i+"&link_position="+r+"&crumb_link="+t,{},function(e,t){"OK"==(e=ajax_debug_clear(e))?(evoFadeSuccess(jQuery(o).closest("tr")),jQuery(o).closest("td").removeClass("error"),"cover"==r&&jQuery("select[name=link_position][id!="+n.id+"] option[value=cover]:selected").each(function(){jQuery(this).parent().val("aftermore"),evoFadeSuccess(jQuery(this).closest("tr"))})):(jQuery(o).val(e),evoFadeFailure(jQuery(o).closest("tr")),jQuery(o.form).closest("td").addClass("error"))}),!1}function evo_link_insert_inline(e,t,n,o,r,i){if(null==o&&(o=0),void 0!==i){var a="["+e+":"+t;n.length&&(a+=":"+n),a+="]",void 0!==r&&!1!==r&&(a+=r+"[/"+e+"]");var s=jQuery("#display_position_"+t);0!=s.length&&"inline"!=s.val()?(deferInlineReminder=!0,evo_rest_api_request("links/"+t+"/position/inline",function(e){s.val("inline"),evoFadeSuccess(s.closest("tr")),s.closest("td").removeClass("error"),textarea_wrap_selection(i,a,"",o,window.document)},"POST"),deferInlineReminder=!1):textarea_wrap_selection(i,a,"",o,window.document)}}function evo_link_delete(o,r,i,e){return evo_rest_api_request("links/"+i,{action:e},function(e){if("item"==r||"comment"==r||"emailcampaign"==r||"message"==r){var t=window.b2evoCanvas;if(null!=t){var n=new RegExp("\\[(image|file|inline|video|audio|thumbnail):"+i+":?[^\\]]*\\]","ig");textarea_str_replace(t,n,"",window.document)}}jQuery(o).closest("tr").remove(),evo_link_fix_wrapper_height()},"DELETE"),!1}function evo_link_change_order(_,e,u){return evo_rest_api_request("links/"+e+"/"+u,function(e){var t=jQuery(_).closest("tr"),n=t.find("span[data-order]");if("move_up"==u){var o=n.attr("data-order"),r=jQuery(t.prev()).find("span[data-order]"),i=r.attr("data-order");t.prev().before(t),n.attr("data-order",i),r.attr("data-order",o)}else{o=n.attr("data-order");var a=jQuery(t.next()).find("span[data-order]"),s=a.attr("data-order");t.next().after(t),n.attr("data-order",s),a.attr("data-order",o)}evoFadeSuccess(t)},"POST"),!1}function evo_link_attach(e,t,n,o,r){return evo_rest_api_request("links",{action:"attach",type:e,object_ID:t,root:n,path:o},function(e){void 0===r&&(r="");var t=jQuery("#"+r+"attachments_fieldset_table .results table",window.parent.document),n=jQuery(e.list_content);t.replaceWith(jQuery("table",n)).promise().done(function(e){setTimeout(function(){window.parent.evo_link_fix_wrapper_height()},10)})}),!1}function evo_link_ajax_loading_overlay(){var e=jQuery("#attachments_fieldset_table"),t=!1;return 0==e.find(".results_ajax_loading").length&&(t=jQuery('<div class="results_ajax_loading"><div>&nbsp;</div></div>'),e.css("position","relative"),t.css({width:e.width(),height:e.height()}),e.append(t)),t}function evo_link_refresh_list(e,t,n){var o=evo_link_ajax_loading_overlay();return o&&evo_rest_api_request("links",{action:void 0===n?"refresh":"sort",type:e.toLowerCase(),object_ID:t},function(e){jQuery("#attachments_fieldset_table").html(e.html),o.remove(),evo_link_fix_wrapper_height()}),!1}function evo_link_sort_list(n){var o,r=jQuery("#"+n+"attachments_fieldset_table tbody.filelist_tbody tr");r.sort(function(e,t){var n=parseInt(jQuery("span[data-order]",e).attr("data-order")),o=parseInt(jQuery("span[data-order]",t).attr("data-order"));return(n=n||r.length)<(o=o||r.length)?-1:o<n?1:0}),$.each(r,function(e,t){0===e?jQuery(t).prependTo("#"+n+"attachments_fieldset_table tbody.filelist_tbody"):jQuery(t).insertAfter(o),o=t})}function ajax_debug_clear(e){return e=(e=e.replace(/<!-- Ajax response end -->/,"")).replace(/(<div class="jslog">[\s\S]*)/i,""),jQuery.trim(e)}function ajax_response_is_correct(e){return!!e.match(/<!-- Ajax response end -->/)&&""!=ajax_debug_clear(e)}jQuery(document).ready(function(){if("undefined"!=typeof evo_init_datepicker&&jQuery(evo_init_datepicker.selector).datepicker(evo_init_datepicker.config),"undefined"!=typeof evo_link_position_config){var t=(a=evo_link_position_config.config).display_inline_reminder,n=a.defer_inline_reminder;jQuery(document).on("change",evo_link_position_config.selector,{url:a.url,crumb:a.crumb},function(e){"inline"==this.value&&t&&!n&&(alert(a.alert_msg),t=!1),evo_link_change_position(this,e.data.url,e.data.crumb)})}if("undefined"!=typeof evo_itemform_renderers__click&&jQuery("#itemform_renderers .dropdown-menu").on("click",function(e){e.stopPropagation()}),"undefined"!=typeof evo_commentform_renderers__click&&jQuery("#commentform_renderers .dropdown-menu").on("click",function(e){e.stopPropagation()}),"undefined"!=typeof evo_disp_download_delay_config){var e=evo_disp_download_delay_config,o=setInterval(function(){jQuery("#download_timer").html(e),0==e&&(clearInterval(o),jQuery("#download_help_url").show()),e--},1e3);jQuery("#download_timer_js").show()}if("undefined"!=typeof evo_skin_bootstrap_forum__quote_button_click&&jQuery(".quote_button").click(function(){var e=jQuery("form[id^=evo_comment_form_id_]");return 0==e.length||(e.attr("action",jQuery(this).attr("href")),e.submit(),!1)}),"undefined"!=typeof evo_ajax_form_config)for(var r=Object.values(evo_ajax_form_config),i=0;i<r.length;i++){var a=r[i];window["ajax_form_offset_"+a.form_number]=jQuery("#ajax_form_number_"+a.form_number).offset().top,window["request_sent_"+a.form_number]=!1,window["ajax_form_loading_number_"+a.form_number]=0;var s="get_form"+a.form_number;window[s]=function(){var o="#ajax_form_number_"+a.form_number;window["ajax_form_loading_number_"+a.form_number]++,jQuery.ajax({url:htsrv_url+"anon_async.php",type:"POST",data:a.json_params,success:function(e){jQuery(o).html(ajax_debug_clear(e)),"get_comment_form"==a.json_params.action&&evo_render_star_rating()},error:function(e,t,n){jQuery(".loader_ajax_form",o).after('<div class="red center">'+n+": "+e.responseText+"</div>"),window["ajax_form_loading_number_"+a.form_number]<3&&setTimeout(function(){jQuery(".loader_ajax_form",o).next().remove(),window[s]()},1e3)}})};var _="check_and_show_"+a.form_number;window[_]=function(e){if(!window["request_sent_"+a.form_number]){var t=null!=typeof e&&e;(t=t||jQuery(window).scrollTop()>=window["ajax_form_offset_"+a.form_number]-jQuery(window).height()-20)&&(window["request_sent_"+a.form_number]=!0,window[s]())}},jQuery(window).scroll(function(){window[_]()}),jQuery(window).resize(function(){window[_]()}),window[_](a.load_ajax_form_on_page_load)}if("undefined"!=typeof evo_user_func__callback_filter_userlist&&(jQuery("#country").change(function(){jQuery(this),jQuery.ajax({type:"POST",url:htsrv_url+"anon_async.php",data:"action=get_regions_option_list&ctry_id="+jQuery(this).val(),success:function(e){jQuery("#region").html(ajax_debug_clear(e)),1<jQuery("#region option").length?jQuery("#region_filter").show():jQuery("#region_filter").hide(),load_subregions(0)}})}),jQuery("#region").change(function(){load_subregions(jQuery(this).val())}),jQuery("#subregion").change(function(){load_cities(jQuery("#country").val(),jQuery("#region").val(),jQuery(this).val())}),window.load_subregions=function(t){jQuery.ajax({type:"POST",url:htsrv_url+"anon_async.php",data:"action=get_subregions_option_list&rgn_id="+t,success:function(e){jQuery("#subregion").html(ajax_debug_clear(e)),1<jQuery("#subregion option").length?jQuery("#subregion_filter").show():jQuery("#subregion_filter").hide(),load_cities(jQuery("#country").val(),t,0)}})},window.load_cities=function(e,t,n){void 0===e&&(e=0),jQuery.ajax({type:"POST",url:htsrv_url+"anon_async.php",data:"action=get_cities_option_list&ctry_id="+e+"&rgn_id="+t+"&subrg_id="+n,success:function(e){jQuery("#city").html(ajax_debug_clear(e)),1<jQuery("#city option").length?jQuery("#city_filter").show():jQuery("#city_filter").hide()}})}),"undefined"!=typeof evo_widget_param_switcher_config)for(i=0;i<evo_widget_param_switcher_config.length;i++)a=evo_widget_param_switcher_config[i],jQuery("a[data-param-switcher="+a.widget_id+"]").click(function(){var e=a.default_params,t=new RegExp("([?&])(("+jQuery(this).data("code")+"|redir)=[^&]*(&|$))+","g"),n=location.href.replace(t,"$1");for(default_param in n=n.replace(/[\?&]$/,""),n+=-1===n.indexOf("?")?"?":"&",n+=jQuery(this).data("code")+"="+jQuery(this).data("value"),e)t=new RegExp("[?&]"+default_param+"=","g"),n.match(t)||(n+="&"+default_param+"="+e[default_param]);return n+="&redir=no",window.history.pushState("","",n),jQuery("a[data-param-switcher="+a.widget_id+"]").attr("class",a.link_class),jQuery(this).attr("class",a.active_link_class),!1});var u;"undefined"!=typeof coll_activity_stats_widget_config&&(window.resize_coll_activity_stat_widget=function(){var e=[],t=[],n=[],o=coll_activity_stats_widget_config.time_period;if(null==plot){plot=jQuery("#canvasbarschart").data("plot"),n=plot.axes.xaxis.ticks.slice(0);for(var r=0;r<plot.series.length;r++)e.push(plot.series[r].data.slice(0));if(7==e[0].length)t=e;else for(r=0;r<e.length;r++){for(var i=[],a=7,s=1;0<a;a--,s++)i.unshift([a,e[r][e[r].length-s][1]]);t.push(i)}}if(jQuery("#canvasbarschart").width()<650){if("last_week"!=o){for(r=0;r<plot.series.length;r++)plot.series[r].data=t[r];plot.axes.xaxis.ticks=n.slice(-7),o="last_week"}}else if("last_month"!=o){for(r=0;r<plot.series.length;r++)plot.series[r].data=e[r];plot.axes.xaxis.ticks=n,o="last_month"}plot.replot({resetAxes:!0})},jQuery(window).resize(function(){clearTimeout(u),u=setTimeout(resize_coll_activity_stat_widget,100)}))}),jQuery(document).ready(function(){"undefined"!=typeof evo_skin_bootstrap_forums__post_list_header&&jQuery("#evo_workflow_status_filter").change(function(){var e=location.href.replace(/([\?&])((status|redir)=[^&]*(&|$))+/,"$1"),t=jQuery(this).val();""!==t&&(e+=(-1==e.indexOf("?")?"?":"&")+"status="+t+"&redir=no"),location.href=e.replace("?&","?").replace(/\?$/,"")})}),jQuery(document).ready(function(){"undefined"!=typeof evo_comment_rating_config&&evo_render_star_rating()}),jQuery(document).ready(function(){"undefined"!=typeof evo_widget_coll_search_form&&(jQuery(evo_widget_coll_search_form.selector).tokenInput(evo_widget_coll_search_form.url,evo_widget_coll_search_form.config),void 0!==evo_widget_coll_search_form.placeholder&&jQuery("#token-input-search_author").attr("placeholder",evo_widget_coll_search_form.placeholder).css("width","100%"))}),jQuery(document).ready(function(){"undefined"!=typeof evo_autocomplete_login_config&&(jQuery("input.autocomplete_login").on("added",function(){jQuery("input.autocomplete_login").each(function(){if(!jQuery(this).hasClass("tt-input")&&!jQuery(this).hasClass("tt-hint")){var t="";t=jQuery(this).hasClass("only_assignees")?restapi_url+evo_autocomplete_login_config.url:restapi_url+"users/logins",jQuery(this).data("status")&&(t+="&status="+jQuery(this).data("status")),jQuery(this).typeahead(null,{displayKey:"login",source:function(e,o){jQuery.ajax({type:"GET",dataType:"JSON",url:t,data:{q:e},success:function(e){var t=new Array;for(var n in e.list)t.push({login:e.list[n]});o(t)}})}})}})}),jQuery("input.autocomplete_login").trigger("added"),evo_prevent_key_enter(evo_autocomplete_login_config.selector))}),jQuery(document).ready(function(){"undefined"!=typeof evo_widget_poll_initialize&&(jQuery('.evo_poll__selector input[type="checkbox"]').on("click",function(){var e=jQuery(this).closest(".evo_poll__table"),t=jQuery(".evo_poll__selector input:checked",e).length>=e.data("max-answers");jQuery(".evo_poll__selector input[type=checkbox]:not(:checked)",e).prop("disabled",t)}),jQuery(".evo_poll__table").each(function(){var e=jQuery(this);e.width()>e.parent().width()&&(jQuery(".evo_poll__title",e).css("white-space","normal"),jQuery(".evo_poll__title label",e).css({width:Math.floor(e.parent().width()/2)+"px","word-wrap":"break-word"}))}))}),jQuery(document).ready(function(){if("undefined"!=typeof evo_plugin_auto_anchors_settings){jQuery("h1, h2, h3, h4, h5, h6").each(function(){if(jQuery(this).attr("id")&&jQuery(this).hasClass("evo_auto_anchor_header")){var e=location.href.replace(/#.+$/,"")+"#"+jQuery(this).attr("id");jQuery(this).append(' <a href="'+e+'" class="evo_auto_anchor_link"><span class="fa fa-link"></span></a>')}});var t=jQuery("#evo_toolbar").length?jQuery("#evo_toolbar").height():0;jQuery(".evo_auto_anchor_link").on("click",function(){var e=jQuery(this).attr("href");return jQuery("html,body").animate({scrollTop:jQuery(this).offset().top-t-evo_plugin_auto_anchors_settings.offset_scroll},function(){window.history.pushState("","",e)}),!1})}}),jQuery(document).ready(function(){if("undefined"!=typeof evo_plugin_table_contents_settings){var n=jQuery("#evo_toolbar").length?jQuery("#evo_toolbar").height():0;jQuery(".evo_plugin__table_of_contents a").on("click",function(){var e=jQuery("#"+jQuery(this).data("anchor"));if(0==e.length||!e.prop("tagName").match(/^h[1-6]$/i))return!0;var t=jQuery(this).attr("href");return jQuery("html,body").animate({scrollTop:e.offset().top-n-evo_plugin_table_contents_settings.offset_scroll},function(){window.history.pushState("","",t)}),!1})}}),jQuery(document).ready(function(){var o,n,r,i,a;"undefined"!=typeof evo_plugin_tinymce_config__toggle_switch_warning&&(o=evo_plugin_tinymce_config__toggle_switch_warning,window.toggle_switch_warning=function(t){var e=o.activate_link,n=o.deactivate_link;return jQuery.get(t?e:n,function(e){jQuery(document).trigger("wysiwyg_warning_changed",[t])}),!1}),"undefined"!=typeof evo_plugin_tinymce_config__quicksettings&&(n=evo_plugin_tinymce_config__quicksettings,r=jQuery("#"+n.item_id),jQuery(document).on("wysiwyg_warning_changed",function(e,t){r.html(t?n.deactivate_warning_link:n.activate_warning_link)})),"undefined"!=typeof evo_plugin_tinymce_config__toggle_editor&&(i=evo_plugin_tinymce_config__toggle_editor,window.displayWarning=i.display_warning,window.confirm_switch=function(){return jQuery("input[name=hideWarning]").is(":checked")&&window.toggle_switch_warning(!1),window.tinymce_plugin_toggleEditor(i.content_id),closeModalWindow(),!1},window.tinymce_plugin_toggleEditor=function(e){var t=jQuery("#"+i.content_id);if(jQuery("[id^=tinymce_plugin_toggle_button_]").removeClass("active").attr("disabled","disabled"),!window.tinymce_plugin_init_done)return window.tinymce_plugin_init_done=!0,void window.tinymce_plugin_init_tinymce(function(){window.tinymce_plugin_toggleEditor(null)});window.tinymce.get(e)?(window.tinymce.execCommand("mceRemoveEditor",!1,e),jQuery.get(i.save_editor_state_url),jQuery("#tinymce_plugin_toggle_button_html").addClass("active"),jQuery("#tinymce_plugin_toggle_button_wysiwyg").removeAttr("disabled"),jQuery('[name="editor_code"]').attr("value","html"),jQuery(".quicktags_toolbar, .evo_code_toolbar, .evo_prism_toolbar, .b2evMark_toolbar, .evo_mermaid_toolbar").show(),jQuery("#block_renderer_evo_code, #block_renderer_evo_prism, #block_renderer_b2evMark, #block_renderer_evo_mermaid").removeClass("disabled"),jQuery("input#renderer_evo_code, input#renderer_evo_prism, input#renderer_b2evMark, input#renderer_evo_mermaid").each(function(){jQuery(this).hasClass("checked")&&jQuery(this).attr("checked","checked").removeClass("checked"),jQuery(this).removeAttr("disabled")}),e&&t.attr("data-required")&&(t.removeAttr("data-required"),t.attr("required",!0))):(window.tinymce.execCommand("mceAddEditor",!1,e),jQuery.get(i.save_editor_state_url),jQuery("#tinymce_plugin_toggle_button_wysiwyg").addClass("active"),jQuery("#tinymce_plugin_toggle_button_html").removeAttr("disabled"),jQuery('[name="editor_code"]').attr("value",i.plugin_code),jQuery(".quicktags_toolbar, .evo_code_toolbar, .evo_prism_toolbar, .b2evMark_toolbar, .evo_mermaid_toolbar").hide(),jQuery("#block_renderer_evo_code, #block_renderer_evo_prism, #block_renderer_b2evMark, #block_renderer_evo_mermaid").addClass("disabled"),jQuery("input#renderer_evo_code, input#renderer_evo_prism, input#renderer_b2evMark, input#renderer_evo_mermaid").each(function(){jQuery(this).is(":checked")&&jQuery(this).addClass("checked"),jQuery(this).attr("disabled","disabled").removeAttr("checked")}),e&&t.prop("required")&&(t.attr("data-required",!0),t.removeAttr("required")))},jQuery(document).on("wysiwyg_warning_changed",function(e,t){window.displayWarning=t}),jQuery("[id^=tinymce_plugin_toggle_button_]").click(function(){"WYSIWYG"==jQuery(this).val()&&window.displayWarning?(evo_js_lang_close=i.cancel_btn_label,openModalWindow("<p>"+i.toggle_warning_msg+'</p><form><input type="checkbox" name="hideWarning" value="1"> '+i.wysiwyg_checkbox_label+'<input type="submit" name="submit" onclick="return confirm_switch();"></form>',"500px","",!0,'<span class="text-danger">'+i.warning_text+"</span>",[i.ok_btn_label,"btn-primary"],!0)):window.tinymce_plugin_toggleEditor(i.content_id)})),"undefined"!=typeof evo_plugin_tinymce_config__init&&(a=evo_plugin_tinymce_config__init,window.autocomplete_static_options=[],jQuery(".user.login").each(function(){var e=jQuery(this).text();""!=e&&-1==window.autocomplete_static_options.indexOf(e)&&("@"==e[0]&&(e=e.substr(1)),window.autocomplete_static_options.push(e))}),window.autocomplete_static_options=window.autocomplete_static_options.join(),window.tmce_init=a.tmce_init,window.tinymce_plugin_displayed_error=!1,window.tinymce_plugin_init_done=!1,window.tinymce_plugin_init_tinymce=function(t){void 0===window.tinymce?window.tinymce_plugin_displayed_error||(alert(a.display_error_msg),window.tinymce_plugin_displayed_error=!0):(void 0!==window.tmce_init.oninit&&(t=function(){window.tmce_init.oninit(),t()}),window.tmce_init.oninit=function(){t(),window.tinymce.get(a.content_id)&&"object"==typeof b2evo_Callbacks&&(b2evo_Callbacks.register_callback("get_selected_text_for_"+a.content_id,function(e){var t=window.tinymce.get(a.content_id);return t?t.selection.getContent():null},!0),b2evo_Callbacks.register_callback("wrap_selection_for_"+a.content_id,function(e){var t=window.tinymce.get(a.content_id);if(!t)return null;var n=t.selection.getContent();if(e.replace)var o=e.before+e.after;else o=e.before+n+e.after;return t.selection.setContent(o),!0},!0),b2evo_Callbacks.register_callback("str_replace_for_"+a.content_id,function(e){var t=window.tinymce.get(a.content_id);return t?(t.setContent(t.getContent().replace(e.search,e.replace)),!0):null},!0),b2evo_Callbacks.register_callback("insert_raw_into_"+a.content_id,function(e){return window.tinymce.execInstanceCommand(a.content_id,"mceInsertRawHTML",!1,e),!0},!0));var e=jQuery("#"+a.content_id);e.prop("required")&&(e.attr("data-required",!0),e.removeAttr("required"))},window.tmce_init.init_instance_callback=function(e){if(window.shortcut_keys)for(var t=0;t<window.shortcut_keys.length;t++){var n=window.shortcut_keys[t];e.shortcuts.add(n,"b2evo shortcut key: "+n,function(){window.shortcut_handler(n)})}},window.tmce_init.setup=function(e){e.on("init",window.tmce_init.oninit)},window.tinymce.on("AddEditor",function(t){var e=jQuery("#"+a.content_id);return e.val().match(/<(p\s?|br\s?\/?)[^>]*>/i)||jQuery.ajax({type:"POST",url:a.update_content_url,data:{content:e.val()},success:function(e){t.editor.setContent(e)}}),!1}),window.tinymce.init(window.tmce_init))},a.use_tinymce&&window.tinymce_plugin_toggleEditor(a.content_id),jQuery('[name="editor_code"]').attr("value",a.editor_code))}),jQuery(document).keyup(function(e){27==e.keyCode&&closeModalWindow()}),jQuery(document).ready(function(){jQuery("img.loadimg").each(function(){jQuery(this).prop("complete")?(jQuery(this).removeClass("loadimg"),""==jQuery(this).attr("class")&&jQuery(this).removeAttr("class")):jQuery(this).on("load",function(){jQuery(this).removeClass("loadimg"),""==jQuery(this).attr("class")&&jQuery(this).removeAttr("class")})})}),jQuery(document).on("click","a.evo_post_flag_btn",function(){var t=jQuery(this),e=parseInt(t.data("id"));return 0<e&&(t.data("status","inprogress"),jQuery("span",jQuery(this)).addClass("fa-x--hover"),evo_rest_api_request("collections/"+t.data("coll")+"/items/"+e+"/flag",function(e){e.flag?(t.find("span:first").show(),t.find("span:last").hide()):(t.find("span:last").show(),t.find("span:first").hide()),jQuery("span",t).removeClass("fa-x--hover"),setTimeout(function(){t.removeData("status")},500)},"PUT")),!1}),jQuery(document).on("mouseover","a.evo_post_flag_btn",function(){"inprogress"!=jQuery(this).data("status")&&jQuery("span",jQuery(this)).addClass("fa-x--hover")}),jQuery(document).on("keydown","textarea, input",function(e){!e.metaKey&&!e.ctrlKey||13!=e.keyCode&&10!=e.keyCode||jQuery(this).closest("form").submit()});var ddexitpop=function(o){var r={delayregister:0,delayshow:200,hideaftershow:!0,displayfreq:"always",persistcookie:"ddexitpop_shown",fxclass:"rubberBand",mobileshowafter:3e3,onddexitpop:function(){}},e=["bounce","flash","pulse","rubberBand","shake","swing","tada","wobble","jello","bounceIn","bounceInDown","bounceInLeft","bounceInRight","bounceInUp","fadeIn","fadeInDown","fadeInDownBig","fadeInLeft","fadeInLeftBig","fadeInRight","fadeInRightBig","fadeInUp","fadeInUpBig","flipInX","flipInY","lightSpeedIn","rotateIn","rotateInDownLeft","rotateInDownRight","rotateInUpLeft","rotateInUpRight","slideInUp","slideInDown","slideInLeft","slideInRight","zoomIn","zoomInDown","zoomInLeft","zoomInRight","zoomInUp","rollIn"],t="ontouchstart"in window||0<navigator.msMaxTouchPoints?"touchstart":"click";function i(e){var t=new RegExp(e+"=[^;]+","i");return document.cookie.match(t)?document.cookie.match(t)[0].split("=")[1]:null}function a(e,t,n){var o="",r=new Date;if(void 0!==n){var i=parseInt(n)*(/hr/i.test(n)?60:/day/i.test(n)?1440:1);r.setMinutes(r.getMinutes()+i),o="; expires="+r.toUTCString()}document.cookie=e+"="+t+"; path=/"+o}var s={wrappermarkup:'<div id="ddexitpopwrapper"><div class="veil"></div></div>',$wrapperref:null,$contentref:null,displaypopup:!0,delayshowtimer:null,settings:null,ajaxrequest:function(e){var t=function(e){if(/^http/i.test(e)){var t=document.createElement("a");return t.href=e,t.href.replace(RegExp(t.hostname,"i"),location.hostname)}return e}(e);o.ajax({url:t,dataType:"html",error:function(e){alert("Error fetching content.<br />Server Response: "+e.responseText)},success:function(e){s.$contentref=o(e).appendTo(document.body),s.setup(s.$contentref)}})},detectexit:function(e){e.clientY<60&&(this.delayshowtimer=setTimeout(function(){s.showpopup(),s.settings.onddexitpop(s.$contentref)},this.settings.delayshow))},detectenter:function(e){e.clientY<60&&clearTimeout(this.delayshowtimer)},showpopup:function(){null!=this.$contentref&&1==this.displaypopup&&(!0===this.settings.randomizefxclass&&(this.settings.fxclass=e[Math.floor(Math.random()*e.length)]),this.$wrapperref.addClass("open"),this.$contentref.addClass(this.settings.fxclass),this.displaypopup=!1,this.settings.hideaftershow&&o(document).off("mouseleave.registerexit"))},hidepopup:function(){this.$wrapperref.removeClass("open"),this.$contentref.removeClass(this.settings.fxclass),this.displaypopup=!0},setup:function(e){this.$contentref.addClass("animated"),this.$wrapperref=o(this.wrappermarkup).appendTo(document.body),this.$wrapperref.append(this.$contentref),this.$wrapperref.find(".veil").on(t,function(){s.hidepopup()}),"always"!=this.settings.displayfreq&&("session"==this.settings.displayfreq?a(this.settings.persistcookie,"yes"):/\d+(hr|day)/i.test(this.settings.displayfreq)&&(a(this.settings.persistcookie,"yes",this.settings.displayfreq),a(this.settings.persistcookie+"_duration",this.settings.displayfreq,this.settings.displayfreq)))},init:function(e){var t=o.extend({},r,e),n=i(t.persistcookie+"_duration");!n||"session"!=t.displayfreq&&t.displayfreq==n||(a(t.persistcookie,"yes",-1),a(t.persistcookie+"_duration","",-1)),"always"!=t.displayfreq&&i(t.persistcookie)||("random"==t.fxclass&&(t.randomizefxclass=!0),"ajax"==(this.settings=t).contentsource[0]?this.ajaxrequest(t.contentsource[1]):"id"==t.contentsource[0]?(this.$contentref=o("#"+t.contentsource[1]).appendTo(document.body),this.setup(this.$contentref)):"inline"==t.contentsource[0]&&(this.$contentref=o(t.contentsource[1]).appendTo(document.body),this.setup(this.$contentref)),setTimeout(function(){o(document).on("mouseleave.registerexit",function(e){s.detectexit(e)}),o(document).on("mouseenter.registerenter",function(e){s.detectenter(e)})},t.delayregister),0<t.mobileshowafter&&o(document).one("touchstart",function(){setTimeout(function(){s.showpopup()},t.mobileshowafter)}))}};return s}(jQuery);