/* This includes 11 files: build/evo_generic.bmin.js, src/bootstrap-evo_modal_window.js, src/evo_images.js, src/evo_user_crop.js, src/evo_user_report.js, src/evo_user_contact_groups.js, src/evo_rest_api.js, src/evo_item_flag.js, src/evo_links.js, src/evo_forms.js, ajax.js */

function evo_prevent_key_enter(e){jQuery(e).keypress(function(e){if(13==e.keyCode)return!1})}function evo_render_star_rating(){jQuery("#comment_rating").each(function(e){var t=jQuery("span.raty_params",this);t&&jQuery(this).html("").raty(t)})}function link_attachment_window(e,t,i,n,o,r){openModalWindow('<span class="loader_img loader_user_report absolute_center" title="'+evo_link_attachment_window_config.loader_title+'"></span>',"90%","80%",!0,evo_link_attachment_window_config.window_title,"",!0);var a={action:"link_attachment",link_owner_type:e,link_owner_ID:t,crumb_link:evo_link_attachment_window_config.crumb_link,root:void 0===i?"":i,path:void 0===n?"":n,fm_highlight:void 0===o?"":o,prefix:void 0===r?"":r};return jQuery.ajax({type:"POST",url:htsrv_url+"async.php",data:a,success:function(e){openModalWindow(e,"90%","80%",!0,evo_link_attachment_window_config.window_title,"")}}),!1}function init_link_sortable(o){jQuery("#"+o.fieldset_prefix+"attachments_fieldset_table table").sortable({containerSelector:"table",itemPath:"> tbody",itemSelector:"tr",placeholder:jQuery.parseHTML('<tr class="placeholder"><td colspan="5"></td></tr>'),onMousedown:function(e,t,i){if(!i.target.nodeName.match(/^(a|img|select|span)$/i))return i.preventDefault(),!0},onDrop:function(t,e,i){jQuery("#"+o.fieldset_prefix+"attachments_fieldset_table table tr").removeClass("odd even"),jQuery("#"+o.fieldset_prefix+"attachments_fieldset_table table tr:odd").addClass("even"),jQuery("#"+o.fieldset_prefix+"attachments_fieldset_table table tr:even").addClass("odd");var n="";jQuery("#"+o.fieldset_prefix+"attachments_fieldset_table table tr").each(function(){var e=jQuery(this).find(".link_id_cell > span[data-order]");0<e.length&&(n+=e.html()+",")}),n=n.slice(0,-1),jQuery.ajax({url:htsrv_url+"anon_async.php",type:"POST",data:{action:"update_links_order",links:n,crumb_link:o.crumb_link},success:function(e){link_data=JSON.parse(ajax_debug_clear(e)),jQuery("#"+o.fieldset_prefix+"attachments_fieldset_table table tr").each(function(){var e=jQuery(this).find(".link_id_cell > span[data-order]");0<e.length&&e.attr("data-order",link_data[e.html()])}),evoFadeSuccess(t)}}),t.removeClass(e.group.options.draggedClass).removeAttr("style")}})}jQuery(document).ready(function(){if("undefined"!=typeof evo_init_datepicker&&jQuery(evo_init_datepicker.selector).datepicker(evo_init_datepicker.config),"undefined"!=typeof evo_link_position_config&&(window.displayInlineReminder=evo_link_position_config.display_inline_reminder,window.deferInlineReminder=evo_link_position_config.defer_inline_reminder,jQuery(document).on("change",evo_link_position_config.selector,{url:evo_link_position_config.url,crumb:evo_link_position_config.crumb},function(e){"inline"==this.value&&window.displayInlineReminder&&!window.deferInlineReminder&&(alert(evo_link_position_config.alert_msg),window.displayInlineReminder=!1),evo_link_change_position(this,e.data.url,e.data.crumb)})),"undefined"!=typeof evo_itemform_renderers__click&&jQuery("#itemform_renderers .dropdown-menu").on("click",function(e){e.stopPropagation()}),"undefined"!=typeof evo_commentform_renderers__click&&jQuery("#commentform_renderers .dropdown-menu").on("click",function(e){e.stopPropagation()}),"undefined"!=typeof evo_disp_download_delay_config&&(window.b2evo_download_timer=evo_disp_download_delay_config,window.downloadInterval=setInterval(function(){jQuery("#download_timer").html(window.b2evo_download_timer),0==window.b2evo_download_timer&&(clearInterval(window.downloadInterval),jQuery("#download_help_url").show()),window.b2evo_download_timer--},1e3),jQuery("#download_timer_js").show()),"undefined"!=typeof evo_skin_bootstrap_forum__quote_button_click&&jQuery(".quote_button").click(function(){var e=jQuery("form[id^=evo_comment_form_id_]");return 0==e.length||(e.attr("action",jQuery(this).attr("href")),e.submit(),!1)}),"undefined"!=typeof evo_ajax_form_config)for(var t=Object.values(evo_ajax_form_config),i=0;i<t.length;i++)!function(){var o=t[i];window["ajax_form_offset_"+o.form_number]=jQuery("#ajax_form_number_"+o.form_number).offset().top,window["request_sent_"+o.form_number]=!1,window["ajax_form_loading_number_"+o.form_number]=0;var r="get_form"+o.form_number;window[r]=function(){var n="#ajax_form_number_"+o.form_number;window["ajax_form_loading_number_"+o.form_number]++,jQuery.ajax({url:htsrv_url+"anon_async.php",type:"POST",data:o.json_params,success:function(e){jQuery(n).html(ajax_debug_clear(e)),"get_comment_form"==o.json_params.action&&evo_render_star_rating()},error:function(e,t,i){jQuery(".loader_ajax_form",n).after('<div class="red center">'+i+": "+e.responseText+"</div>"),window["ajax_form_loading_number_"+o.form_number]<3&&setTimeout(function(){jQuery(".loader_ajax_form",n).next().remove(),window[r]()},1e3)}})};var e="check_and_show_"+o.form_number;window[e]=function(e){if(!window["request_sent_"+o.form_number]){var t=null!=typeof e&&e;(t=t||jQuery(window).scrollTop()>=window["ajax_form_offset_"+o.form_number]-jQuery(window).height()-20)&&(window["request_sent_"+o.form_number]=!0,window[r]())}},jQuery(window).scroll(function(){window[e]()}),jQuery(window).resize(function(){window[e]()}),window[e](o.load_ajax_form_on_page_load)}();if("undefined"!=typeof evo_thread_form_config&&(window.check_multiple_recipients=function(){1<jQuery('input[name="thrd_recipients_array[login][]"]').length?jQuery("#multiple_recipients").show():jQuery("#multiple_recipients").hide()},window.check_form_thread=function(){return""==jQuery("input#token-input-thrd_recipients").val()||(alert(evo_thread_form_config.missing_username_msg),jQuery("input#token-input-thrd_recipients").focus(),!1)},evo_thread_form_config.token_input_config.tokenFormatter=function(e){return"<li>"+e[evo_thread_form_config.username_display]+'<input type="hidden" name="thrd_recipients_array[id][]" value="'+e.id+'" /><input type="hidden" name="thrd_recipients_array[login][]" value="'+e.login+'" /></li>'},evo_thread_form_config.token_input_config.resultsFormatter=function(e){var t=e.login;return null!=e.fullname&&void 0!==e.fullname&&(t+="<br />"+e.fullname),"<li>"+e.avatar+"<div>"+t+"</div><span></span></li>"},evo_thread_form_config.token_input_config.onAdd=function(){window.check_multiple_recipients()},evo_thread_form_config.token_input_config.onDelete=function(){window.check_multiple_recipients()},evo_thread_form_config.token_input_config.onReady=function(){evo_thread_form_config.thrd_recipients_has_error&&jQuery(".token-input-list-facebook").addClass("token-input-list-error"),jQuery("#thrd_recipients").removeAttr("required")},jQuery("#thrd_recipients").tokenInput(restapi_url+"users/recipients",evo_thread_form_config.token_input_config),window.check_multiple_recipients()),"undefined"!=typeof evo_comment_form_preview_button_config&&jQuery("input[type=submit].preview.btn-info").val(evo_comment_form_preview_button_config.button_value),"undefined"!=typeof evo_user_func__callback_filter_userlist&&(jQuery("#country").change(function(){jQuery(this),jQuery.ajax({type:"POST",url:htsrv_url+"anon_async.php",data:"action=get_regions_option_list&ctry_id="+jQuery(this).val(),success:function(e){jQuery("#region").html(ajax_debug_clear(e)),1<jQuery("#region option").length?jQuery("#region_filter").show():jQuery("#region_filter").hide(),window.load_subregions(0)}})}),jQuery("#region").change(function(){window.load_subregions(jQuery(this).val())}),jQuery("#subregion").change(function(){window.load_cities(jQuery("#country").val(),jQuery("#region").val(),jQuery(this).val())}),window.load_subregions=function(t){jQuery.ajax({type:"POST",url:htsrv_url+"anon_async.php",data:"action=get_subregions_option_list&rgn_id="+t,success:function(e){jQuery("#subregion").html(ajax_debug_clear(e)),1<jQuery("#subregion option").length?jQuery("#subregion_filter").show():jQuery("#subregion_filter").hide(),load_cities(jQuery("#country").val(),t,0)}})},window.load_cities=function(e,t,i){void 0===e&&(e=0),jQuery.ajax({type:"POST",url:htsrv_url+"anon_async.php",data:"action=get_cities_option_list&ctry_id="+e+"&rgn_id="+t+"&subrg_id="+i,success:function(e){jQuery("#city").html(ajax_debug_clear(e)),1<jQuery("#city option").length?jQuery("#city_filter").show():jQuery("#city_filter").hide()}})}),"undefined"!=typeof coll_activity_stats_widget_config&&(window.coll_activity_stats_widget_resize_timer,window.resize_coll_activity_stat_widget=function(){var e=[],t=[],i=[],n=coll_activity_stats_widget_config.time_period;if(null==plot){plot=jQuery("#canvasbarschart").data("plot"),i=plot.axes.xaxis.ticks.slice(0);for(var o=0;o<plot.series.length;o++)e.push(plot.series[o].data.slice(0));if(7==e[0].length)t=e;else for(o=0;o<e.length;o++){for(var r=[],a=7,l=1;0<a;a--,l++)r.unshift([a,e[o][e[o].length-l][1]]);t.push(r)}}if(jQuery("#canvasbarschart").width()<650){if("last_week"!=n){for(o=0;o<plot.series.length;o++)plot.series[o].data=t[o];plot.axes.xaxis.ticks=i.slice(-7),n="last_week"}}else if("last_month"!=n){for(o=0;o<plot.series.length;o++)plot.series[o].data=e[o];plot.axes.xaxis.ticks=i,n="last_month"}plot.replot({resetAxes:!0})},jQuery(window).resize(function(){clearTimeout(coll_activity_stats_widget_resize_timer),coll_activity_stats_widget_resize_timer=setTimeout(resize_coll_activity_stat_widget,100)})),"undefined"!=typeof evo_link_sortable_js_config){var e=Object.keys(evo_link_sortable_js_config);for(i=0;i<e.length;i++)init_link_sortable(evo_link_sortable_js_config[e[i]])}"undefined"!=typeof evo_link_initialize_fieldset_config&&function(){for(var e=Object.values(evo_link_initialize_fieldset_config),t=0;t<e.length;t++)evo_link_initialize_fieldset(e[t].fieldset_prefix)}(),"undefined"!=typeof evo_display_attachments_fieldset_config&&function(){for(var e=Object.values(evo_display_attachments_fieldset_config),t=0;t<e.length;t++)jQuery("#"+e[t].fieldset_prefix+e[t].form_id).show()}()}),jQuery(document).ready(function(){if("undefined"!=typeof evo_init_password_indicator_config){var c=evo_init_password_indicator_config;window.passcheck=function(){var e=jQuery("input#"+c.pass1_id);if(0!=e.length){c.field_width||(c.field_width=e.outerWidth());var t=jQuery("input#"+c.pass2_id);0!=t.length&&t.css("width",c.field_width-2+"px"),e.css("width",c.field_width-2+"px"),e.attr("onkeyup","return passinfo( this );"),e.parent().append('<div id="p-container"><div id="p-result"></div><div id="p-status"></div><div id="p-time"></div></div>'),jQuery("head").append("<style>#p-container { position: relative; margin-top: 4px; height:5px; border: 1px solid #CCC; font-size: 84%; line-height:normal; color: #999; background: #FFF } #p-result { height:5px } #p-status { position:absolute; width: 100px; top:-5px; left: "+(c.field_width+8)+"px } #p-time { position:absolute; width: 400px } </style>"),jQuery("#p-container").css("width",e.outerWidth()-2);var i=parseInt(e.css("margin-left"));0<i&&jQuery("#p-container").css("margin-left",i+"px")}},window.passinfo=function(e){var t=document.getElementById("p-result"),i=document.getElementById("p-status"),n=document.getElementById("p-time"),o="",r=document.getElementById(c.login_id);null!=r&&""!=r.value&&(o=r.value);var a="",l=document.getElementById(c.email_id);null!=l&&""!=l.value&&(a=l.value);var s=[o,a],_=zxcvbn(e.value,s.concat(c.blacklist)),d="red",u=c.msg_status_very_weak;switch(0==e.value.length?(t.style.display="none",i.style.display="none",n.style.display="none"):(t.style.display="block",i.style.display="block",n.style.display="block"),_.score){case 1:d="#F88158",u=c.msg_status_weak;break;case 2:d="#FBB917",u=c.msg_status_soso;break;case 3:d="#8BB381",u=c.msg_status_good;break;case 4:d="#59E817",u=c.msg_status_great}t.style.width=20*_.score+20+"%",t.style.background=d,c.disp_status&&(i.innerHTML=u),c.disp_time&&(document.getElementById("p-time").innerHTML=c.msg_est_crack_time+": "+_.crack_time_display)},function(){var e;e=function(){var e,t;return(t=document.createElement("script")).src=c.rsc_url+"js/zxcvbn.js",t.type="text/javascript",t.async=!0,(e=document.getElementsByTagName("script")[0]).parentNode.insertBefore(t,e)},null!=window.attachEvent?window.attachEvent("onload",e):window.addEventListener("load",e,!1)}.call(this),jQuery("input#"+c.pass1_id+", input#"+c.pass2_id).keyup(function(){var e=c.min_pwd_len,t=jQuery("input#"+c.pass1_id),i=jQuery("input#"+c.pass2_id),n=jQuery("#pass2_status"),o="",r=/^[^\<\&\>]+$/g;t.val().length&&null==t.val().match(r)||i.val().length&&null==i.val().match(r)?(o=c.msg_illegal_char,t[0].setCustomValidity(t.val().match(r)?"":o),i[0].setCustomValidity(i.val().match(r)?"":o),n.html(c.error_icon+" "+o)):0<t.val().length&&t.val().length<e||0<i.val().length&&i.val().length<e?(o=c.msg_min_pwd_len,t[0].setCustomValidity(t.val().length<e?o:""),i[0].setCustomValidity(i.val().length<e?o:""),n.html(c.error_icon+" "+o)):i.val()!=t.val()?(o=c.msg_pwd_not_matching,t[0].setCustomValidity(""),i[0].setCustomValidity(o),n.html(c.error_icon+" "+o)):(t[0].setCustomValidity(o),i[0].setCustomValidity(o),n.html(o))}),window.passcheck()}}),jQuery(document).ready(function(){if("undefined"!=typeof evo_init_password_edit_config){var r=evo_init_password_edit_config;window.user_pass_clear_style=function(e){jQuery(e).each(function(){jQuery(this).parent().find("span.field_error span:visible").length?jQuery(this).addClass("field_error"):jQuery(this).removeClass("field_error")})},jQuery("#current_user_pass").keyup(function(){var e=jQuery(this).parent().find("span.field_error");e.length&&(""==jQuery(this).val()?e.show():e.hide()),user_pass_clear_style("#current_user_pass")}),jQuery("#edited_user_pass1, #edited_user_pass2").keyup(function(){var e=jQuery(this).parent().find(".pass_check_min");e.length&&(jQuery.trim(jQuery(this).val()).length>=r.user_minpwdlen?e.hide():e.show());var t=jQuery(".pass_check_diff");t.length&&jQuery("#edited_user_pass1").val()==jQuery(" #edited_user_pass2").val()&&t.hide();var i=jQuery(this).parent().find(".pass_check_new");i.length&&(""==jQuery(this).val()?i.show():i.hide());var n=jQuery(this).parent().find(".pass_check_twice");n.length&&(""==jQuery(this).val()?n.show():n.hide());var o=jQuery(this).parent().find(".pass_check_warning");jQuery.trim(jQuery(this).val())!=jQuery(this).val()?o.length||jQuery(this).parent().append('<span class="pass_check_warning notes field_error">'+r.msg_pwd_trim_warning+"</span>"):o.length&&o.remove(),user_pass_clear_style("#edited_user_pass1, #edited_user_pass2")})}}),jQuery(document).ready(function(){if("undefined"!=typeof evo_init_login_validator_config){var e=evo_init_login_validator_config,i=e.login_icon_load,n=e.login_icon_exists,o=e.login_icon_error,r=e.login_text_empty,a=e.login_text_exists,l=jQuery("#register_form input#"+e.login_id);l.change(function(){var t=jQuery("#login_status_msg");""==jQuery(this).val()?(jQuery("#login_status").html(""),t.html(r).attr("class","notes")):(jQuery("#login_status").html(i),jQuery.ajax({type:"POST",url:e.login_htsrv_url+"anon_async.php",data:"action=validate_login&login="+jQuery(this).val(),success:function(e){"exists"==(e=ajax_debug_clear(e))?(jQuery("#login_status").html(""),t.html(n+" "+a).attr("class","red"),l[0].setCustomValidity(a)):"available"==e?(jQuery("#login_status").html(""),t.html(""),l[0].setCustomValidity("")):(jQuery("#login_status").html(""),t.html(o.replace("$error_msg$",e.replace(/(<([^>]+)>)/gi,""))+" "+e).attr("class","red"),l[0].setCustomValidity(e.replace(/(<([^>]+)>)/gi,"")))}}))})}}),jQuery(document).ready(function(){"undefined"!=typeof evo_skin_bootstrap_forums__post_list_header&&jQuery("#evo_workflow_status_filter").change(function(){var e=location.href.replace(/([\?&])((status|redir)=[^&]*(&|$))+/,"$1"),t=jQuery(this).val();""!==t&&(e+=(-1==e.indexOf("?")?"?":"&")+"status="+t+"&redir=no"),location.href=e.replace("?&","?").replace(/\?$/,"")})}),jQuery(document).ready(function(){"undefined"!=typeof evo_comment_rating_config&&evo_render_star_rating()}),jQuery(document).ready(function(){"undefined"!=typeof evo_widget_coll_search_form&&(jQuery(evo_widget_coll_search_form.selector).tokenInput(evo_widget_coll_search_form.url,evo_widget_coll_search_form.config),void 0!==evo_widget_coll_search_form.placeholder&&jQuery("#token-input-search_author").attr("placeholder",evo_widget_coll_search_form.placeholder).css("width","100%"))}),jQuery(document).ready(function(){"undefined"!=typeof evo_autocomplete_login_config&&(jQuery("input.autocomplete_login").on("added",function(){jQuery("input.autocomplete_login").each(function(){if(!jQuery(this).hasClass("tt-input")&&!jQuery(this).hasClass("tt-hint")){var t="";t=jQuery(this).hasClass("only_assignees")?restapi_url+evo_autocomplete_login_config.url:restapi_url+"users/logins",jQuery(this).data("status")&&(t+="&status="+jQuery(this).data("status")),jQuery(this).typeahead(null,{displayKey:"login",source:function(e,n){jQuery.ajax({type:"GET",dataType:"JSON",url:t,data:{q:e},success:function(e){var t=new Array;for(var i in e.list)t.push({login:e.list[i]});n(t)}})}})}})}),jQuery("input.autocomplete_login").trigger("added"),evo_prevent_key_enter(evo_autocomplete_login_config.selector))}),jQuery(document).ready(function(){"undefined"!=typeof evo_widget_poll_initialize&&(jQuery('.evo_poll__selector input[type="checkbox"]').on("click",function(){var e=jQuery(this).closest(".evo_poll__table"),t=jQuery(".evo_poll__selector input:checked",e).length>=e.data("max-answers");jQuery(".evo_poll__selector input[type=checkbox]:not(:checked)",e).prop("disabled",t)}),jQuery(".evo_poll__table").each(function(){var e=jQuery(this);e.width()>e.parent().width()&&(jQuery(".evo_poll__title",e).css("white-space","normal"),jQuery(".evo_poll__title label",e).css({width:Math.floor(e.parent().width()/2)+"px","word-wrap":"break-word"}))}))}),jQuery(document).ready(function(){if("undefined"!=typeof evo_plugin_auto_anchors_settings){jQuery("h1, h2, h3, h4, h5, h6").each(function(){if(jQuery(this).attr("id")&&jQuery(this).hasClass("evo_auto_anchor_header")){var e=location.href.replace(/#.+$/,"")+"#"+jQuery(this).attr("id");jQuery(this).append(' <a href="'+e+'" class="evo_auto_anchor_link"><span class="fa fa-link"></span></a>')}});var t=jQuery("#evo_toolbar").length?jQuery("#evo_toolbar").height():0;jQuery(".evo_auto_anchor_link").on("click",function(){var e=jQuery(this).attr("href");return jQuery("html,body").animate({scrollTop:jQuery(this).offset().top-t-evo_plugin_auto_anchors_settings.offset_scroll},function(){window.history.pushState("","",e)}),!1})}}),jQuery(document).ready(function(){if("undefined"!=typeof evo_plugin_table_contents_settings){var i=jQuery("#evo_toolbar").length?jQuery("#evo_toolbar").height():0;jQuery(".evo_plugin__table_of_contents a").on("click",function(){var e=jQuery("#"+jQuery(this).data("anchor"));if(0==e.length||!e.prop("tagName").match(/^h[1-6]$/i))return!0;var t=jQuery(this).attr("href");return jQuery("html,body").animate({scrollTop:e.offset().top-i-evo_plugin_table_contents_settings.offset_scroll},function(){window.history.pushState("","",t)}),!1})}}),jQuery(document).ready(function(){var n,i,o,r,a;"undefined"!=typeof evo_plugin_tinymce_config__toggle_switch_warning&&(n=evo_plugin_tinymce_config__toggle_switch_warning,window.toggle_switch_warning=function(t){var e=n.activate_link,i=n.deactivate_link;return jQuery.get(t?e:i,function(e){jQuery(document).trigger("wysiwyg_warning_changed",[t])}),!1}),"undefined"!=typeof evo_plugin_tinymce_config__quicksettings&&(i=evo_plugin_tinymce_config__quicksettings,o=jQuery("#"+i.item_id),jQuery(document).on("wysiwyg_warning_changed",function(e,t){o.html(t?i.deactivate_warning_link:i.activate_warning_link)})),"undefined"!=typeof evo_plugin_tinymce_config__toggle_editor&&(r=evo_plugin_tinymce_config__toggle_editor,window.displayWarning=r.display_warning,window.confirm_switch=function(){return jQuery("input[name=hideWarning]").is(":checked")&&window.toggle_switch_warning(!1),window.tinymce_plugin_toggleEditor(r.content_id),closeModalWindow(),!1},window.tinymce_plugin_toggleEditor=function(e){var t=jQuery("#"+r.content_id);if(jQuery("[id^=tinymce_plugin_toggle_button_]").removeClass("active").attr("disabled","disabled"),!window.tinymce_plugin_init_done)return window.tinymce_plugin_init_done=!0,void window.tinymce_plugin_init_tinymce(function(){window.tinymce_plugin_toggleEditor(null)});window.tinymce.get(e)?(window.tinymce.execCommand("mceRemoveEditor",!1,e),jQuery.get(r.save_editor_state_url),jQuery("#tinymce_plugin_toggle_button_html").addClass("active"),jQuery("#tinymce_plugin_toggle_button_wysiwyg").removeAttr("disabled"),jQuery('[name="editor_code"]').attr("value","html"),jQuery(".quicktags_toolbar, .evo_code_toolbar, .evo_prism_toolbar, .b2evMark_toolbar, .evo_mermaid_toolbar").show(),jQuery("#block_renderer_evo_code, #block_renderer_evo_prism, #block_renderer_b2evMark, #block_renderer_evo_mermaid").removeClass("disabled"),jQuery("input#renderer_evo_code, input#renderer_evo_prism, input#renderer_b2evMark, input#renderer_evo_mermaid").each(function(){jQuery(this).hasClass("checked")&&jQuery(this).attr("checked","checked").removeClass("checked"),jQuery(this).removeAttr("disabled")}),e&&t.attr("data-required")&&(t.removeAttr("data-required"),t.attr("required",!0))):(window.tinymce.execCommand("mceAddEditor",!1,e),jQuery.get(r.save_editor_state_url),jQuery("#tinymce_plugin_toggle_button_wysiwyg").addClass("active"),jQuery("#tinymce_plugin_toggle_button_html").removeAttr("disabled"),jQuery('[name="editor_code"]').attr("value",r.plugin_code),jQuery(".quicktags_toolbar, .evo_code_toolbar, .evo_prism_toolbar, .b2evMark_toolbar, .evo_mermaid_toolbar").hide(),jQuery("#block_renderer_evo_code, #block_renderer_evo_prism, #block_renderer_b2evMark, #block_renderer_evo_mermaid").addClass("disabled"),jQuery("input#renderer_evo_code, input#renderer_evo_prism, input#renderer_b2evMark, input#renderer_evo_mermaid").each(function(){jQuery(this).is(":checked")&&jQuery(this).addClass("checked"),jQuery(this).attr("disabled","disabled").removeAttr("checked")}),e&&t.prop("required")&&(t.attr("data-required",!0),t.removeAttr("required")))},jQuery(document).on("wysiwyg_warning_changed",function(e,t){window.displayWarning=t}),jQuery("[id^=tinymce_plugin_toggle_button_]").click(function(){"WYSIWYG"==jQuery(this).val()&&window.displayWarning?(evo_js_lang_close=r.cancel_btn_label,openModalWindow("<p>"+r.toggle_warning_msg+'</p><form><input type="checkbox" name="hideWarning" value="1"> '+r.wysiwyg_checkbox_label+'<input type="submit" name="submit" onclick="return confirm_switch();"></form>',"500px","",!0,'<span class="text-danger">'+r.warning_text+"</span>",[r.ok_btn_label,"btn-primary"],!0)):window.tinymce_plugin_toggleEditor(r.content_id)})),"undefined"!=typeof evo_plugin_tinymce_config__init&&(a=evo_plugin_tinymce_config__init,window.autocomplete_static_options=[],jQuery(".user.login").each(function(){var e=jQuery(this).text();""!=e&&-1==window.autocomplete_static_options.indexOf(e)&&("@"==e[0]&&(e=e.substr(1)),window.autocomplete_static_options.push(e))}),window.autocomplete_static_options=window.autocomplete_static_options.join(),window.tmce_init=a.tmce_init,window.tinymce_plugin_displayed_error=!1,window.tinymce_plugin_init_done=!1,window.tinymce_plugin_init_tinymce=function(t){void 0===window.tinymce?window.tinymce_plugin_displayed_error||(alert(a.display_error_msg),window.tinymce_plugin_displayed_error=!0):(void 0!==window.tmce_init.oninit&&(t=function(){window.tmce_init.oninit(),t()}),window.tmce_init.oninit=function(){t(),window.tinymce.get(a.content_id)&&"object"==typeof b2evo_Callbacks&&(b2evo_Callbacks.register_callback("get_selected_text_for_"+a.content_id,function(e){var t=window.tinymce.get(a.content_id);return t?t.selection.getContent():null},!0),b2evo_Callbacks.register_callback("wrap_selection_for_"+a.content_id,function(e){var t=window.tinymce.get(a.content_id);if(!t)return null;var i=t.selection.getContent();if(e.replace)var n=e.before+e.after;else n=e.before+i+e.after;return t.selection.setContent(n),!0},!0),b2evo_Callbacks.register_callback("str_replace_for_"+a.content_id,function(e){var t=window.tinymce.get(a.content_id);return t?(t.setContent(t.getContent().replace(e.search,e.replace)),!0):null},!0),b2evo_Callbacks.register_callback("insert_raw_into_"+a.content_id,function(e){return window.tinymce.execInstanceCommand(a.content_id,"mceInsertRawHTML",!1,e),!0},!0));var e=jQuery("#"+a.content_id);e.prop("required")&&(e.attr("data-required",!0),e.removeAttr("required"))},window.tmce_init.init_instance_callback=function(e){if(window.shortcut_keys)for(var t=0;t<window.shortcut_keys.length;t++){var i=window.shortcut_keys[t];e.shortcuts.add(i,"b2evo shortcut key: "+i,function(){window.shortcut_handler(i)})}},tmce_init.init_instance_callback=function(e){if(window.shortcut_keys)for(var t=0;t<window.shortcut_keys.length;t++){var i=window.shortcut_keys[t];e.shortcuts.add(i,"b2evo shortcut key: "+i,function(){window.shortcut_handler(i)})}},window.tmce_init.setup=function(e){e.on("init",window.tmce_init.oninit)},window.tinymce.on("AddEditor",function(t){var e=jQuery("#"+a.content_id);return e.val().match(/<(p\s?|br\s?\/?)[^>]*>/i)||jQuery.ajax({type:"POST",url:a.update_content_url,data:{content:e.val()},success:function(e){t.editor.setContent(e)}}),!1}),window.tinymce.init(window.tmce_init))},a.use_tinymce&&window.tinymce_plugin_toggleEditor(a.content_id),jQuery('[name="editor_code"]').attr("value",a.editor_code))}),jQuery(document).ready(function(){if("undefined"!=typeof evo_init_shortlinks_toolbar_config){var n=evo_init_shortlinks_toolbar_config;if(window.shortlinks_toolbar=function(e,t){var i=n.toolbar_title_before+e+n.toolbar_title_after+n.toolbar_group_before+'<input type="button" title="'+n.button_title+'" class="'+n.button_class+'" data-func="shortlinks_load_window|'+t+'" value="'+n.button_value+'" />'+n.toolbar_group_after;jQuery("."+t+n.plugin_code+"_toolbar").html(i)},"undefined"!=typeof evo_init_shortlinks_toolbar)for(var e=Object.values(evo_init_shortlinks_toolbar),t=0;t<e.length;t++)window.shortlinks_toolbar(e[t].title,e[t].prefix)}}),jQuery(document).ready(function(){if("undefined"!=typeof evo_init_polls_toolbar_config){var n=evo_init_polls_toolbar_config;if(window.polls_toolbar=function(e,t){var i=n.toolbar_title_before+e+n.toolbar_title_after+n.toolbar_group_before+'<input type="button" title="'+n.button_title+'" class="'+n.button_class+'" data-func="polls_load_window|'+t+'" value="'+n.button_value+'" />'+n.toolbar_group_after;jQuery("."+t+n.plugin_code+"_toolbar").html(i)},window.polls_load_window=function(e){return openModalWindow('<div id="poll_wrapper"></div>',"auto","",!0,n.modal_window_title,["Insert Poll"],!0),polls_load_polls(e),!1},window.polls_api_request=function(e,t,i){jQuery.ajax({url:restapi_url+e}).then(i,function(e){polls_api_print_error(t,e)})},window.polls_api_print_error=function(e,t){if("string"!=typeof t&&void 0===t.code&&(t=void 0===t.responseJSON?t.statusText:t.responseJSON),void 0===t.code)var i='<h4 class="text-danger">Unknown error: '+t+"</h4>";else i='<h4 class="text-danger">'+t.message+"</h4>",n.debug&&(i+="<div><b>Code:</b> "+t.code+"</div><div><b>Status:</b> "+t.data.status+"</div>");jQuery(e).html(i)},window.polls_load_polls=function(o){o=o||"",polls_api_request("polls","#poll_wrapper",function(e){var t='<div id="'+o+'polls_list">';for(var i in t+="<ul>",e.polls){var n=e.polls[i];t+='<li><a href="#" data-poll-id="'+n.pqst_ID+'" data-prefix="'+o+'">'+n.pqst_question_text+"</a></li>"}t+="</ul>",t+="</div>",jQuery("#poll_wrapper").html(t),jQuery(document).on("click","#"+o+"polls_list a[data-poll-id]",function(){"undefined"!=typeof tinyMCE&&void 0!==tinyMCE.activeEditor&&tinyMCE.activeEditor&&tinyMCE.execCommand("mceFocus",!1,tinyMCE.activeEditor.id);var e=jQuery(this).data("prefix")?jQuery(this).data("prefix"):"";return textarea_wrap_selection(window[e+"b2evoCanvas"],"[poll:"+jQuery(this).data("pollId")+"]","",0),closeModalWindow(),!1})})},"undefined"!=typeof evo_init_polls_toolbar)for(var e=Object.values(evo_init_polls_toolbar),t=0;t<e.length;t++)window.polls_toolbar(e[t].title,e[t].prefix)}}),jQuery(document).ready(function(){if(window.dndb={},window.init_uploader=function(config){if("draggable"in document.createElement("span"))var button_text=config.draggable_button_text,file_uploader_note_text=config.draggable_note_text;else var button_text=config.nondraggable_button_text,file_uploader_note_text=config.nondraggable_note_text;window.dndb[config.fieldset_prefix+"url"]=config.quickupload_url,window.dndb[config.fieldset_prefix+"root_and_path"]=config.root_and_path,jQuery("#fm_dirtree input[type=radio]").click(function(){window.dndb[config.fieldset_prefix+"url"]=config.quickupload_url+"&root_and_path="+this.value+"&"+config.crumb_file,window.dndb[config.fieldset_prefix+"root_and_path"]=this.value,window.dndb[config.fieldset_prefix+"uploader"].setParams({root_and_path:window.dndb[config.fieldset_prefix+"root_and_path"]})}),config.link_owner&&(window.dndb[config.fieldset_prefix+"url"]+="&link_owner="+config.link_owner),config.fm_mode&&"file_select"==config.fm_mode&&(window.dndb[config.fieldset_prefix+"url"]+="&fm_mode="+config.fm_mode),window.dndb[config.fieldset_prefix+"uploader"]=new qq.FineUploader({debug:!1,request:{endpoint:window.dndb[config.fieldset_prefix+"url"],params:{root_and_path:window.dndb[config.fieldset_prefix+"root_and_path"]}},template:document.getElementById(config.fieldset_prefix+"qq-template"),element:document.getElementById(config.fieldset_prefix+"file-uploader"),listElement:document.querySelector(config.list_element),dragAndDrop:{extraDropzones:eval(config.extra_dropzones)},list_style:config.list_style,action:window.dndb[config.fieldset_prefix+"url"],sizeLimit:config.size_limit,messages:{typeError:config.msg_type_error,sizeError:config.msg_size_error,minSizeError:config.msg_min_size_error,emptyError:config.msg_empty_error,onLeave:config.msg_on_leave},text:{formatProgress:config.msg_format_progress,sizeSymbols:[config.size_symbol_kb,config.size_symbol_mb,config.size_symbol_gb,config.size_symbol_tb,config.size_symbol_pb,config.size_symbol_eb]},validation:{sizeLimit:config.validation_size_limit,allowedExtensions:config.allowed_extensions},callbacks:{onSubmit:function(e,t,i){var n={root_and_path:window.dndb[config.fieldset_prefix+"root_and_path"]};jQuery(i).hasClass("link_attachment_dropzone")&&qq.extend(n,{link_position:"inline"}),this.setParams(n);var o=jQuery("#"+config.fieldset_prefix+config.table_id+" tr.noresults");o.length&&(""!=config.table_headers&&o.parent().parent().prepend(config.table_headers),o.remove()),setTimeout(function(){evo_link_fix_wrapper_height(config.fieldset_prefix),config.resize_frame&&(window.dndb.update_iframe_height(config.fieldset_prefix),jQuery(document).on("load","#"+config.fieldset_prefix+config.table_id+" img",function(){window.dndb.update_iframe_height(config.fieldset_prefix)}))},10)},onProgress:function(e,t,i,n){var o=jQuery("#"+config.fieldset_prefix+config.table_id+" tr[qq-file-id="+e+"] .progress-bar"),r=Math.round(i/n*100)+"%";o.get(0).style.width=r,o.text(r),config.resize_frame&&window.dndb.update_iframe_height(config.fieldset_prefix)},onDropzoneDragOver:function(e){jQuery(".qq-upload-button").addClass("qq-upload-button-dragover")},onDropzoneDragOut:function(e){jQuery(".qq-upload-button").removeClass("qq-upload-button-dragover")},onDropzoneDragDrop:function(e){jQuery(".qq-upload-button").removeClass("qq-upload-button-dragover")},onComplete:function(e,t,i,n,o){var r;if(null!=i&&(i.data.text&&(r=1==i.specialchars?htmlspecialchars_decode(i.data.text):i.data.text),r=base64_decode(r),"list"==config.list_style&&null!=i.data.status&&"rename"==i.data.status&&jQuery("#"+config.fieldset_prefix+config.table_id+" #saveBtn").show()),"table"==config.list_style){var a=jQuery("#"+config.fieldset_prefix+config.table_id+" tr[qq-file-id="+e+"]");if(null==i||null==i.data||"error"==i.data.status||"fatal"==i.data.status)a.find(".qq-upload-status").html('<span class="red">'+config.msg_upload_error+"</span>"),i.error?r=i.error:void 0!==r&&""!=r||(r=config.msg_dropped_connection),a.find(".qq-upload-file-selector").append(': <span class="text-danger result_error">'+r+"</span>"),a.find(".qq-upload-image-selector, td.size").prepend(config.warning_icon);else{var l=void 0!==i.data.link_ID?"link":"file",s=config.filename_before;""!=s&&(s=s.replace("$file_path$",i.data.path));var _="";i.data.select_link_button&&(_=i.data.select_link_button);var d="";""!=i.data.warning&&(d='<div class="orange">'+i.data.warning+"</div>");var u=void 0!==i.data.link_url?i.data.link_url:i.data.formatted_name;if(a.find(".qq-upload-checkbox").html(i.data.checkbox),"success"==i.data.status)config.display_status_success?a.find(".qq-upload-status-text-selector").html('<span class="green">'+config.msg_upload_ok+"</span>"):a.find(".qq-upload-status-text-selector").html(""),a.find(".qq-upload-image").html(r),a.find(".qq-upload-file-selector").html(s+_+'<input type="hidden" value="'+i.data.newpath+'" /><span class="fname">'+u+"</span>"+d),a.find(".qq-upload-size-selector").html(i.data.filesize),i.data.filetype&&a.find(".qq-upload-file-type").html(i.data.filetype),i.data.creator&&a.find(".qq-upload-file-creator").html(i.data.creator),null!=i.data.downloads&&a.find(".qq-upload-downloads").html(i.data.downloads),i.data.owner&&a.find(".fsowner").html(i.data.owner),i.data.group&&a.find(".fsgroup").html(i.data.group),i.data.file_date&&a.find(".fsdate").html(i.data.file_date),i.data.file_actions&&a.find(".actions").html(i.data.file_actions),jQuery("#evo_multi_file_selector").length&&jQuery("#evo_multi_file_selector").show();else if("rename"==i.data.status){var c='<span class="orange">'+config.msg_upload_confict+"</span>";"default"==config.status_conflict_place?a.find(".qq-upload-status-text-selector").html(c):a.find(".qq-upload-status-text-selector").html(""),a.find(".qq-upload-image").html(i.data.file),a.find(".qq-upload-image-selector").append(htmlspecialchars_decode(i.data.file)),a.find(".qq-upload-file-selector").html(s+_+'<input type="hidden" value="'+i.data.newpath+'" /><span class="fname">'+u+"</span>"+("before_button"==config.status_conflict_place?" - "+c:"")+' - <a href="#" class="'+config.button_class+' roundbutton_text_noicon qq-conflict-replace" old="'+i.data.old_rootrelpath+'" new="'+i.data.new_rootrelpath+'"><div>'+config.msg_replace_file+'</div><div style="display:none">'+config.msg_revert+"</div></a>"+d);var p=jQuery("#"+config.fieldset_prefix+config.table_id+' input[type=hidden][value="'+i.data.oldpath+'"]');0<p.length&&p.parent().append(' <span class="orange">'+config.msg_old_file+"</span>")}"link"==l&&(a.find(".qq-upload-link-id").html('<span data-order="'+i.data.link_order+'">'+i.data.link_ID+"</span>"),a.find(".qq-upload-image").html(i.data.link_preview),a.find(".qq-upload-link-actions").prepend(i.data.link_actions),void 0!==i.data.link_position&&a.find(".qq-upload-link-position").html(i.data.link_position)),init_colorbox(a.find('.qq-upload-image a[rel^="lightbox"]')),evo_link_sort_list(config.fieldset_prefix)}}else jQuery(window.dndb[config.fieldset_prefix+"uploader"].getItemByFileId(e)).append(r),null==i.data&&""!=i&&jQuery(window.dndb[config.fieldset_prefix+"uploader"].getItemByFileId(e)).append(i);if(config.resize_frame&&(window.dndb.update_iframe_height(config.fieldset_prefix),jQuery(document).on("load","#"+config.fieldset_prefix+config.table_id+" img",function(){window.dndb.update_iframe_height(config.fieldset_preifx)})),jQuery(o).hasClass("link_attachment_dropzone"))switch(i.data.filetype){case"image":case"video":case"audio":textarea_wrap_selection(o,"["+i.data.filetype+":"+i.data.link_ID+"]","",0)}},onCancel:function(e,t){"table"==config.list_style&&setTimeout(function(){var e=jQuery("#"+config.fieldset_prefix+config.table_id+" .filelist_tbody");if(!e.find("tr").length){var t=config.no_results;e.append(t)}},10)}}}),jQuery("div.qq-upload-button-selector > div, div.qq-upload-drop-area > div").html(button_text),config.resize_frame&&(window.dndb.update_iframe_height=function(e){var t=jQuery("#"+e+config.table_id).height();jQuery("#"+e+"attachments_fieldset_wrapper").css({height:t,"max-height":t})}),"table"==config.list_style&&jQuery(document).on("click","#"+config.fieldset_prefix+config.table_id+" .qq-conflict-replace",function(){var l=jQuery(this),s=l.children("div:first").is(":visible"),e=l.attr("old"),_=jQuery("#"+config.fieldset_prefix+config.table_id+' input[type=hidden][value="'+e+'"]'),d=0<_.length;l.hide();var u=l.parent().parent().children("td");return d&&(u=u.add(_.parent().parent().children("td"))),u.css("background","#FFFF00"),u.find("span.error").remove(),jQuery.ajax({type:"POST",url:htsrv_url+"async.php",data:{action:"conflict_files",fileroot_ID:config.fileroot_ID,path:config.path,oldfile:e.replace(/^(.+[\/:])?([^\/]+)$/,"$2"),newfile:l.attr("new").replace(/^(.+[\/:])?([^\/]+)$/,"$2"),format:config.conflict_file_format,crumb_conflictfiles:config.crumb_conflictfiles},success:function(e){var t=jQuery.parseJSON(e);if(void 0===t.error){l.show();var i=l.parent().find("span.fname");if(s?(l.children("div:first").hide(),l.children("div:last").show()):(l.children("div:first").show(),l.children("div:last").hide()),d){var n=_.parent().find("span.fname"),o=n.html();n.html(i.html()),i.html(o);var r=n.prev();if(0!=r.length&&"A"==r.get(0).tagName||(r=n.parent().prev()),0<r.length&&"A"==r.get(0).tagName){var a=r.attr("href");r.attr("href",i.prev().attr("href")),i.prev().attr("href",a)}}else i.html(s?t.old:t.new)}else l.show(),l.parent().append('<span class="error"> - '+t.error+"</span>");u.css("background","")}}),!1}),config.display_support_msg&&document.write('<p class="note">'+file_uploader_note_text+"</p>")},"undefined"!=typeof evo_init_dragdrop_button_config)for(var evo_init_dragdrop_button_config_keys=Object.keys(evo_init_dragdrop_button_config),i=0;i<evo_init_dragdrop_button_config_keys.length;i++)window.init_uploader(evo_init_dragdrop_button_config[evo_init_dragdrop_button_config_keys[i]])});var modal_window_js_initialized=!1;function openModalWindow(e,t,i,n,o,r,a,l,s,_,d){var u=void 0===t||"auto"==t?"":"width:"+t+";",c=void 0===i||0==i||""==i?"":"height:"+i,p=c.match(/%$/i)?' style="height:100%;overflow:hidden;"':"",f=i.match(/px/i)?' style="min-height:'+(i.replace("px","")-157)+'px"':"",m=void 0===r||0!=r;if(void 0!==r&&""!=r)if("object"==typeof r)var g=r[0],y=r[1],h=void 0===r[2]?"form":r[2];else g=r,y="btn-primary",h="form";if(void 0!==a&&a&&jQuery("#modal_window").remove(),0==jQuery("#modal_window").length){var v='<div id="modal_window" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true"><div class="modal-dialog" style="'+u+c+'"><div class="modal-content"'+p+">";if(void 0!==o&&""!=o&&(v+='<div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title">'+o+"</h4></div>"),v+='<div class="modal-body"'+p+f+">"+e,s){jQuery("#"+s);v+="<script>jQuery( document ).ready( function() {var iframe = jQuery( '#"+s+"' );iframe.on( 'load', function() {iframe.closest( '.modal-body' ).find( 'span.loader_img' ).remove();setModalIFrameUnload( '"+s+"' );});});<\/script>"}v+="</div>",m&&(v+='<div class="modal-footer">',void 0!==r&&""!=r&&(v+='<button class="btn '+y+'" type="submit" style="display:none">'+g+"</button>"),v+='<button class="btn btn-default" data-dismiss="modal" aria-hidden="true">'+evo_js_lang_close+"</button></div>"),v+="</div></div></div>",jQuery("body").append(v)}else jQuery("#modal_window .modal-body").html(e);void 0!==s?jQuery("#"+s).on("load",function(){prepareModalWindow(jQuery(this).contents(),h,m,l),jQuery("#modal_window .loader_img").remove(),jQuery("#"+s).show()}):prepareModalWindow("#modal_window",h,m,l),"function"==typeof _&&jQuery("#modal_window").on("shown.bs.modal",_);var w={};modal_window_js_initialized&&(w="show"),jQuery("#modal_window").modal(w),u||(jQuery("#modal_window .modal-dialog").css({display:"table",width:"auto"}),jQuery("#modal_window .modal-dialog .modal-content").css({display:"table-cell"})),jQuery("#modal_window").on("hidden.bs.modal",function(){jQuery(this).remove(),"function"==typeof d&&d()}),modal_window_js_initialized=!0}function prepareModalWindow(e,t,i,n){i&&(void 0!==n&&n||(jQuery("legend",e).remove(),jQuery("#close_button",e).remove(),jQuery(".panel, .panel-body",e).removeClass("panel panel-default panel-body")),0==jQuery(t+" input[type=submit]",e).length?jQuery("#modal_window .modal-footer button[type=submit]").hide():(jQuery(t+" input[type=submit]",e).hide(),jQuery("#modal_window .modal-footer button[type=submit]").show()),jQuery(t,e).change(function(){var e=jQuery(this).find("input[type=submit]");0<e.length?(e.hide(),jQuery("#modal_window .modal-footer button[type=submit]").show()):jQuery("#modal_window .modal-footer button[type=submit]").hide()}),jQuery("#modal_window .modal-footer button[type=submit]").off("click"),jQuery("#modal_window .modal-footer button[type=submit]").on("click",function(){1!==jQuery(this).data("click_init")&&(jQuery(t+" input[type=submit]",e).click(),jQuery(this).data("click_init",1))})),jQuery(t+" a.btn",e).each(function(){jQuery("#modal_window .modal-footer").prepend("<a href="+jQuery(this).attr("href")+'><button type="button" class="'+jQuery(this).attr("class")+'">'+jQuery(this).html()+"</button></a>"),jQuery(this).remove()}),0<jQuery(t+" #current_modal_title",e).length&&jQuery("#modal_window .modal-title").html(jQuery(t+" #current_modal_title",e).html())}function closeModalWindow(e,t){return void 0===e&&(e=window.document),"function"==typeof t&&jQuery("#modal_window").on("hidden.bs.modal",t),jQuery("#modal_window",e).modal("hide"),!1}function setModalIFrameUnload(e){var i=jQuery("#"+e);i[0].contentWindow.onunload=function(){var e=i.closest(".modal-body"),t=jQuery('<span class="loader_img absolute_center" title="'+evo_js_lang_loading+'"></span>');jQuery(e).prepend(t)}}function user_crop_avatar(e,t,i){void 0===i&&(i="avatar");var n=750,o=jQuery(window).width(),r=jQuery(window).height(),a=r/o,l=10,s=10;l=320<(o=n<o?n:o<320?320:o)-2*l?10:0,s=320<(r=n<r?n:r<320?320:r)-2*s?10:0;var _=n<o?n:o,d=n<r?n:r;openModalWindow('<span id="spinner" class="loader_img loader_user_report absolute_center" title="'+evo_js_lang_loading+'"></span>',_+"px",d+"px",!0,evo_js_lang_crop_profile_pic,[evo_js_lang_crop,"btn-primary"],!0);var u=jQuery("div.modal-dialog div.modal-body").length?jQuery("div.modal-dialog div.modal-body"):jQuery("#overlay_page"),c=parseInt(u.css("paddingTop")),p=parseInt(u.css("paddingRight")),f=parseInt(u.css("paddingBottom")),m=parseInt(u.css("paddingLeft")),g=(jQuery("div.modal-dialog div.modal-body").length?parseInt(u.css("min-height")):d-100)-(c+f),y={user_ID:e,file_ID:t,aspect_ratio:a,content_width:_-(m+p),content_height:g,display_mode:"js",crumb_user:evo_js_crumb_user};return evo_js_is_backoffice?(y.ctrl="user",y.user_tab="crop",y.user_tab_from=i):(y.blog=evo_js_blog,y.disp="avatar",y.action="crop"),jQuery.ajax({type:"POST",url:evo_js_user_crop_ajax_url,data:y,success:function(e){openModalWindow(e,_+"px",d+"px",!0,evo_js_lang_crop_profile_pic,[evo_js_lang_crop,"btn-primary"])}}),!1}function user_report(e,t){openModalWindow('<span class="loader_img loader_user_report absolute_center" title="'+evo_js_lang_loading+'"></span>',"auto","",!0,evo_js_lang_report_user,[evo_js_lang_report_this_user_now,"btn-danger"],!0);var i={action:"get_user_report_form",user_ID:e,crumb_user:evo_js_crumb_user};return evo_js_is_backoffice?(i.is_backoffice=1,i.user_tab=t):i.blog=evo_js_blog,jQuery.ajax({type:"POST",url:evo_js_user_report_ajax_url,data:i,success:function(e){openModalWindow(e,"auto","",!0,evo_js_lang_report_user,[evo_js_lang_report_this_user_now,"btn-danger"])}}),!1}function user_contact_groups(e){return openModalWindow('<span class="loader_img loader_user_report absolute_center" title="'+evo_js_lang_loading+'"></span>',"auto","",!0,evo_js_lang_contact_groups,evo_js_lang_save,!0),jQuery.ajax({type:"POST",url:evo_js_user_contact_groups_ajax_url,data:{action:"get_user_contact_form",blog:evo_js_blog,user_ID:e,crumb_user:evo_js_crumb_user},success:function(e){openModalWindow(e,"auto","",!0,evo_js_lang_contact_groups,evo_js_lang_save)}}),!1}function evo_rest_api_request(url,params_func,func_method,method){var params=params_func,func=func_method;"function"==typeof params_func&&(func=params_func,params={},method=func_method),void 0===method&&(method="GET"),jQuery.ajax({contentType:"application/json; charset=utf-8",type:method,url:restapi_url+url,data:params}).then(function(data,textStatus,jqXHR){"object"==typeof jqXHR.responseJSON&&eval(func)(data,textStatus,jqXHR)})}function evo_rest_api_print_error(e,t,i){if("string"!=typeof t&&void 0===t.code&&(t=void 0===t.responseJSON?t.statusText:t.responseJSON),void 0===t.code)var n='<h4 class="text-danger">Unknown error: '+t+"</h4>";else{n='<h4 class="text-danger">'+t.message+"</h4>";i&&(n+="<div><b>Code:</b> "+t.code+"</div><div><b>Status:</b> "+t.data.status+"</div>")}evo_rest_api_end_loading(e,n)}function evo_rest_api_start_loading(e){jQuery(e).addClass("evo_rest_api_loading").append('<div class="evo_rest_api_loader">loading...</div>')}function evo_rest_api_end_loading(e,t){jQuery(e).removeClass("evo_rest_api_loading").html(t).find(".evo_rest_api_loader").remove()}function evo_link_initialize_fieldset(i){if(0<jQuery("#"+i+"attachments_fieldset_table").length){var e=jQuery("#"+i+"attachments_fieldset_table").height();e=320<e?320:e<97?97:e,jQuery("#"+i+"attachments_fieldset_wrapper").height(e),jQuery("#"+i+"attachments_fieldset_wrapper").resizable({minHeight:80,handles:"s",resize:function(e,t){jQuery("#"+i+"attachments_fieldset_wrapper").resizable("option","maxHeight",jQuery("#"+i+"attachments_fieldset_table").height()),evo_link_update_overlay(i)}}),jQuery(document).on("click","#"+i+"attachments_fieldset_wrapper .ui-resizable-handle",function(){var e=jQuery("#"+i+"attachments_fieldset_table").height(),t=jQuery("#"+i+"attachments_fieldset_wrapper").height()+80;jQuery("#"+i+"attachments_fieldset_wrapper").css("height",e<t?e:t),evo_link_update_overlay(i)})}}function evo_link_update_overlay(e){jQuery("#"+e+"attachments_fieldset_overlay").length&&jQuery("#"+e+"attachments_fieldset_overlay").css("height",jQuery("#"+e+"attachments_fieldset_wrapper").closest(".panel").height())}function evo_link_fix_wrapper_height(e){var t=void 0===e?"":e,i=jQuery("#"+t+"attachments_fieldset_table").height();jQuery("#"+t+"attachments_fieldset_wrapper").height()!=i&&jQuery("#"+t+"attachments_fieldset_wrapper").height(jQuery("#"+t+"attachments_fieldset_table").height())}function evo_link_change_position(i,e,t){var n=i,o=i.value,r=i.id.substr(17);return jQuery.get(e+"anon_async.php?action=set_object_link_position&link_ID="+r+"&link_position="+o+"&crumb_link="+t,{},function(e,t){"OK"==(e=ajax_debug_clear(e))?(evoFadeSuccess(jQuery(n).closest("tr")),jQuery(n).closest("td").removeClass("error"),"cover"==o&&jQuery("select[name=link_position][id!="+i.id+"] option[value=cover]:selected").each(function(){jQuery(this).parent().val("aftermore"),evoFadeSuccess(jQuery(this).closest("tr"))})):(jQuery(n).val(e),evoFadeFailure(jQuery(n).closest("tr")),jQuery(n.form).closest("td").addClass("error"))}),!1}function evo_link_insert_inline(e,t,i,n,o,r){if(null==n&&(n=0),void 0!==r){var a="["+e+":"+t;i.length&&(a+=":"+i),a+="]",void 0!==o&&!1!==o&&(a+=o+"[/"+e+"]");var l=jQuery("#display_position_"+t);0!=l.length&&"inline"!=l.val()?(deferInlineReminder=!0,evo_rest_api_request("links/"+t+"/position/inline",function(e){l.val("inline"),evoFadeSuccess(l.closest("tr")),l.closest("td").removeClass("error"),textarea_wrap_selection(r,a,"",n,window.document)},"POST"),deferInlineReminder=!1):textarea_wrap_selection(r,a,"",n,window.document)}}function evo_link_delete(n,o,r,e){return evo_rest_api_request("links/"+r,{action:e},function(e){if("item"==o||"comment"==o||"emailcampaign"==o||"message"==o){var t=window.b2evoCanvas;if(null!=t){var i=new RegExp("\\[(image|file|inline|video|audio|thumbnail):"+r+":?[^\\]]*\\]","ig");textarea_str_replace(t,i,"",window.document)}}jQuery(n).closest("tr").remove(),evo_link_fix_wrapper_height()},"DELETE"),!1}function evo_link_change_order(s,e,_){return evo_rest_api_request("links/"+e+"/"+_,function(e){var t=jQuery(s).closest("tr"),i=t.find("span[data-order]");if("move_up"==_){var n=i.attr("data-order"),o=jQuery(t.prev()).find("span[data-order]"),r=o.attr("data-order");t.prev().before(t),i.attr("data-order",r),o.attr("data-order",n)}else{n=i.attr("data-order");var a=jQuery(t.next()).find("span[data-order]"),l=a.attr("data-order");t.next().after(t),i.attr("data-order",l),a.attr("data-order",n)}evoFadeSuccess(t)},"POST"),!1}function evo_link_attach(e,t,i,n,o){return evo_rest_api_request("links",{action:"attach",type:e,object_ID:t,root:i,path:n},function(e){void 0===o&&(o="");var t=jQuery("#"+o+"attachments_fieldset_table .results table",window.parent.document),i=jQuery(e.list_content);t.replaceWith(jQuery("table",i)).promise().done(function(e){setTimeout(function(){window.parent.evo_link_fix_wrapper_height()},10)})}),!1}function evo_link_ajax_loading_overlay(){var e=jQuery("#attachments_fieldset_table"),t=!1;return 0==e.find(".results_ajax_loading").length&&(t=jQuery('<div class="results_ajax_loading"><div>&nbsp;</div></div>'),e.css("position","relative"),t.css({width:e.width(),height:e.height()}),e.append(t)),t}function evo_link_refresh_list(e,t,i,n){var o=evo_link_ajax_loading_overlay();return o&&evo_rest_api_request("links",{action:void 0===i?"refresh":"sort",type:e.toLowerCase(),object_ID:t,prefix:n},function(e){jQuery("#"+n+"attachments_fieldset_table").html(e.html),init_uploader(window.evo_init_dragdrop_button_config["fieldset_"+n]),evo_link_fix_wrapper_height(),o.remove()}),!1}function evo_link_sort_list(i){var n,o=jQuery("#"+i+"attachments_fieldset_table tbody.filelist_tbody tr");o.sort(function(e,t){var i=parseInt(jQuery("span[data-order]",e).attr("data-order")),n=parseInt(jQuery("span[data-order]",t).attr("data-order"));return(i=i||o.length)<(n=n||o.length)?-1:n<i?1:0}),$.each(o,function(e,t){n=(0===e?jQuery(t).prependTo("#"+i+"attachments_fieldset_table tbody.filelist_tbody"):jQuery(t).insertAfter(n),t)})}function ajax_debug_clear(e){return e=(e=e.replace(/<!-- Ajax response end -->/,"")).replace(/(<div class="jslog">[\s\S]*)/i,""),jQuery.trim(e)}function ajax_response_is_correct(e){return!!e.match(/<!-- Ajax response end -->/)&&""!=(e=ajax_debug_clear(e))}jQuery(document).ready(function(){jQuery("img.loadimg").each(function(){jQuery(this).prop("complete")?(jQuery(this).removeClass("loadimg"),""==jQuery(this).attr("class")&&jQuery(this).removeAttr("class")):jQuery(this).on("load",function(){jQuery(this).removeClass("loadimg"),""==jQuery(this).attr("class")&&jQuery(this).removeAttr("class")})})}),jQuery(document).on("click","a.evo_post_flag_btn",function(){var t=jQuery(this),e=parseInt(t.data("id"));return 0<e&&(t.data("status","inprogress"),jQuery("span",jQuery(this)).addClass("fa-x--hover"),evo_rest_api_request("collections/"+t.data("coll")+"/items/"+e+"/flag",function(e){e.flag?(t.find("span:first").show(),t.find("span:last").hide()):(t.find("span:last").show(),t.find("span:first").hide()),jQuery("span",t).removeClass("fa-x--hover"),setTimeout(function(){t.removeData("status")},500)},"PUT")),!1}),jQuery(document).on("mouseover","a.evo_post_flag_btn",function(){"inprogress"!=jQuery(this).data("status")&&jQuery("span",jQuery(this)).addClass("fa-x--hover")}),jQuery(document).on("keydown","textarea, input",function(e){!e.metaKey&&!e.ctrlKey||13!=e.keyCode&&10!=e.keyCode||jQuery(this).closest("form").submit()});