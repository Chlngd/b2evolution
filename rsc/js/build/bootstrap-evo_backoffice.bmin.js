/* This includes 21 files: functions.js, ajax.js, communication.js, form_extensions.js, extracats.js, dynamic_select.js, backoffice.js, blog_widgets.js, shortlinks.js, src/bootstrap-evo_modal_window.js, src/evo_images.js, src/evo_user_crop.js, src/evo_user_report.js, src/evo_user_deldata.js, src/evo_user_org.js, src/evo_automation.js, src/evo_user_tags.js, src/evo_user_status.js, src/evo_user_groups.js, src/evo_rest_api.js, src/evo_links.js */

function pop_up_window(e,t,n,r,i){return void 0===n&&(n=750),void 0===r&&(r=550),void 0===i&&(i="scrollbars=yes, status=yes, resizable=yes, menubar=yes"),i="width="+n+", height="+r+", left="+(screen.width-n)/2+", top="+(screen.height-r)/2+", "+i,opened=window.open(e,t,i),opened.focus(),"undefined"==typeof openedWindows?openedWindows=new Array(opened):openedWindows.push(opened),!1}function textarea_replace_selection(e,t,n){textarea_wrap_selection(e,t,"",1,n)}function textarea_wrap_selection(e,t,n,r,i){var o={element:e,before:t,after:n,replace:r,target_document:i=i||document};if(!b2evo_Callbacks.trigger_callback("wrap_selection_for_"+e.id,o)){if(window.opener&&void 0!==window.opener)try{if(window.opener.b2evo_Callbacks&&void 0!==window.opener.b2evo_Callbacks&&window.opener.b2evo_Callbacks.trigger_callback("wrap_selection_for_"+e.id,o))return}catch(e){}if(!(window.parent&&void 0!==window.parent&&window.parent.b2evo_Callbacks&&void 0!==window.parent.b2evo_Callbacks&&window.parent.b2evo_Callbacks.trigger_callback("wrap_selection_for_"+e.id,o)))if(i.selection)e.focus(),sel=i.selection.createRange(),sel.text=r?t+n:t+sel.text+n,e.focus();else if(e.selectionStart||"0"==e.selectionStart){var a,s,l,d=e.selectionStart,_=e.selectionEnd;"textarea"==e.type&&void 0!==e.scrollTop&&(s=e.scrollTop,l=e.scrollLeft),a=r?(e.value=e.value.substring(0,d)+t+n+e.value.substring(_,e.value.length),d+t.length+n.length):(e.value=e.value.substring(0,d)+t+e.value.substring(d,_)+n+e.value.substring(_,e.value.length),_+t.length+n.length),void 0!==s&&(e.scrollTop=s,e.scrollLeft=l),e.focus(),e.selectionStart=a,e.selectionEnd=a}else e.value+=t+n,e.focus()}}function textarea_str_replace(e,t,n,r){var i={element:e,search:t,replace:n,target_document:r=r||document};if(!b2evo_Callbacks.trigger_callback("str_replace_for_"+e.id,i)){if(window.opener&&void 0!==window.opener)try{if(window.opener.b2evo_Callbacks&&void 0!==window.opener.b2evo_Callbacks&&window.opener.b2evo_Callbacks.trigger_callback("str_replace_for_"+e.id,i))return}catch(e){}window.parent&&void 0!==window.parent&&window.parent.b2evo_Callbacks&&void 0!==window.parent.b2evo_Callbacks&&window.parent.b2evo_Callbacks.trigger_callback("str_replace_for_"+e.id,i)||(e.value=e.value.replace(t,n),e.focus())}}function toggle_filter_area(e){var t=jQuery("#clickdiv_"+e),n=jQuery("#clickimg_"+e);if(0==t.length||0==n.length)return alert("ID "+e+" not found!"),!1;if(n.hasClass("fa")||n.hasClass("glyphicon")){if(""!=n.data("toggle")&&null!=n.data("toggle")){var r=n.hasClass("fa")?"fa":"glyphicon";null==n.data("toggle-orig-class")&&n.data("toggle-orig-class",n.attr("class").replace(new RegExp("^"+r+" (.+)$","g"),"$1")),n.hasClass(n.data("toggle-orig-class"))?n.removeClass(n.data("toggle-orig-class")).addClass(r+"-"+n.data("toggle")):n.removeClass(r+"-"+n.data("toggle")).addClass(n.data("toggle-orig-class"))}}else{var i=n.css("background-position").match(/-*\d+/g);n.css("background-position",parseInt(i[0])+(t.is(":hidden")?-16:16)+"px "+parseInt(i[1])+"px")}return t.is(":hidden")?(t.slideDown(500),jQuery.post(htsrv_url+"anon_async.php?action=expand_filter&target="+e)):(t.slideUp(500),jQuery.post(htsrv_url+"anon_async.php?action=collapse_filter&target="+e)),!1}function b2evo_Callbacks(){this.eventHandlers=new Array}b2evo_Callbacks.prototype={register_callback:function(e,t,n){void 0===this.eventHandlers[e]&&(this.eventHandlers[e]=new Array),void 0!==n&&n?this.eventHandlers[e][0]=t:this.eventHandlers[e][this.eventHandlers[e].length]=t},trigger_callback:function(event,args){if(void 0===this.eventHandlers[event])return null;for(var r=!1,cb_args="",cb_arguments=arguments,i=1;i<arguments.length;i++)cb_args+="cb_arguments["+i+"], ";cb_args.length&&(cb_args=cb_args.substring(0,cb_args.length-2));for(var i=0;i<this.eventHandlers[event].length;i++){var f=this.eventHandlers[event][i];r=eval("f("+cb_args+");")||r}return r}};var b2evo_Callbacks=new b2evo_Callbacks;function evoAlert(e){var t=jQuery(".b2evo_alert");0<t.length&&t.remove(),jQuery("body").append('<div class="b2evo_alert">'+e+"</div>"),setTimeout(function(){jQuery(".b2evo_alert").fadeOut({complete:function(){jQuery(this).remove()}})},3e3),evo_alert_events_initialized||(evo_alert_events_initialized=!0,jQuery(document).on("click",".b2evo_alert",function(){jQuery(this).remove()}))}function debounce(i,o,a){var s,l;return function(){var e,t,n=this,r=arguments;return e=function(){s=null,a||(l=i.apply(n,r))},t=a&&!s,clearTimeout(s),s=setTimeout(e,o),t&&(l=i.apply(n,r)),l}}function ajax_debug_clear(e){return e=(e=e.replace(/<!-- Ajax response end -->/,"")).replace(/(<div class="jslog">[\s\S]*)/i,""),jQuery.trim(e)}function ajax_response_is_correct(e){return!!e.match(/<!-- Ajax response end -->/)&&""!=(e=ajax_debug_clear(e))}function SendAdminRequest(e,t,n,r){void 0!==r&&!r||(n+=(""!==n?"&":"")+"nocache_dummy="+(new Date).getTime());SendServerRequest(b2evo_dispatcher_url+"?ctrl="+e+"&action="+t+(n?"&"+n:""))}function SendServerRequest(e){e+=-1!=e.indexOf("?")?"&":"?";var t=(e+="display_mode=js").split("?");e=t[0],t=t[1],jQuery.ajax({type:"POST",url:e,data:t,dataType:"script"})}function AttachServerRequest(e){jQuery('<input type="hidden" name="display_mode" value="js" /><input type="hidden" name="js_target" value="window.parent." />').appendTo("#"+e),jQuery("#"+e).attr("target","server_postback")}function DisplayServerMessages(e,t){jQuery("#server_messages").html(e),"object"==typeof t&&(jQuery("input.field_error, select.field_error, textarea.field_error").each(function(){jQuery(this).removeClass("field_error");var e=jQuery(this).next();e.hasClass("notes")&&"SPAN"==e.get(0).tagName&&e.remove()}),jQuery.each(t,function(e,t){jQuery("#"+e).addClass("field_error").after('<span class="oneline notes"> <span class="field_error" rel="'+e+'">'+t+"</span></span>")})),jQuery("#server_messages .log_success").animate({backgroundColor:"#88ff88"},"fast").animate({backgroundColor:"#ffffff"},"fast","",function(){jQuery(this).removeAttr("style")}),jQuery("#server_messages > .log_error").animate({backgroundColor:"#ff8888"},"fast").animate({backgroundColor:"#ffffff"},"fast","",function(){jQuery(this).removeAttr("style")})}evo_alert_events_initialized=!1,jQuery(document).ready(function(){function n(e){var t=e.data("prefix")?e.data("prefix"):"",n=jQuery("."+t+e.val()+"_toolbar");if(0==n.length)return!0;e.is(":checked")?(n.removeClass("disabled"),n.find("input[type=button]").removeAttr("disabled")):(n.addClass("disabled"),n.find("input[type=button]").attr("disabled","disabled"))}jQuery(document).on("click","[data-func]",function(){var e=jQuery(this).data("func").match(/([^\\|]|\\\|)+/g),t=e[0];e.splice(0,1);for(var n=0;n<e.length;n++)-1<e[n].indexOf("b2evoCanvas")?e[n]=window[e[n]]:" "==e[n]?e[n]="":e[n]=e[n].replace(/\\\|/g,"|");return 0<jQuery(this).closest(".disabled[class*=_toolbar]").length||window[t].apply(null,e),!1}),jQuery('input[type=checkbox][name="renderers[]"]').each(function(){n(jQuery(this))}),jQuery('input[type=checkbox][name="renderers[]"]').click(function(){n(jQuery(this))}),jQuery(".plugin-toolbar").on("click",function(){if(jQuery(this).hasClass("disabled")){var e=jQuery(this).attr("data-plugin-toolbar");if(e){if(0===(e=e.replace("_toolbar","")).indexOf("meta_")){e=e.replace("meta_","");var t=jQuery('input[type=checkbox][id="meta_renderer_'+e+'"]')}else t=jQuery('input[type=checkbox][id="renderer_'+e+'"]');0<t.length&&(t.prop("checked",!0),n(t))}}})}),jQuery(document).ready(function(){jQuery(".pblock").length?jQuery('<div id="server_messages"></div>').prependTo(".pblock"):jQuery(".level2").length?jQuery(".level2").after('<div id="server_messages"></div>'):jQuery(".navbar.level1").after('<div id="server_messages"></div>'),jQuery('<iframe id="server_postback" name="server_postback"></iframe>').appendTo("body").css({position:"absolute",left:"-1000em",top:"-1000em"})});var _b2evoCommunications=function(){var n,r,t=2500,i=250;return{Init:function(){var e=jQuery.fn.extend({delay:t,interval:i,dispatcher:r},arguments.length?arguments[0]:"");t=e.delay,i=e.interval,r=e.dispatcher,n=this,b2evoHelper.info("Communications object ready")},BufferedServerCall:function(){var e=jQuery.fn.extend({ticker_callback:function(){return!0},send_callback:function(){},delay:t,interval:i,buffer_name:""},arguments.length?arguments[0]:"");if(ticker_status=e.ticker_callback(e.delay))switch(!0!==ticker_status&&b2evoHelper.log("Ticker status : "+ticker_status),ticker_status){case"cancel":return void b2evoHelper.DisplayMessage('<div class="log_message">'+T_("Update cancelled")+"</div>");case"pause":return b2evoHelper.DisplayMessage('<div class="log_error">'+T_("Update Paused")+" : "+b2evoHelper.str_repeat(".",e.delay/e.interval)+"</div>"),void n.BufferedServerLoop(e);case"ignore":return void n.BufferedServerLoop(e);case"immediate":break;default:if(e.delay-=e.interval,0<e.delay)return b2evoHelper.DisplayMessage('<div class="log_error">'+T_("Changes pending")+" : "+b2evoHelper.str_repeat(".",e.delay/e.interval)+"</div>"),void n.BufferedServerLoop(e);b2evoHelper.DisplayMessage('<div class="log_message">'+T_("Saving changes")+"</div>"),e.send_callback()}},BufferedServerLoop:function(e){var t=jQuery(n).data("buffers");void 0===t&&(t=Array()),t[e.buffer_name]=e,jQuery(n).data("buffers",t),window.setTimeout('b2evoCommunications.BufferedServerCallback( "'+e.buffer_name+'" )',e.interval)},BufferedServerCallback:function(e){var t=jQuery(n).data("buffers");n.BufferedServerCall(t[e])},SendAdminRequest:function(){var e=jQuery.fn.extend({ctrl:"",action:"",data:"",key:"",error:function(){return!1},ok:function(){return!1}},arguments.length?arguments[0]:""),t="ctrl="+e.ctrl+"&key="+e.key+"&action="+e.action+"&"+e.data;n.SendServerRequest({url:r,data:t,error:e.error,ok:e.ok})},SendServerRequest:function(){var e=jQuery.fn.extend({url:"",data:"",error:function(){return!1},ok:function(){return!1}},arguments.length?arguments[0]:"");if(e.url){e.url+=(!0===e.url.indexOf("?")?"&":"?")+"mode=js",e.data&&(e.url+="&"+e.data);var t=jQuery("<script><\/script>");t.attr("src",e.url),t.load(e.ok()),t.error(e.error()),t.appendTo("body"),b2evoHelper.log("Sending request : "+e.url)}}}},b2evoCommunications=new _b2evoCommunications;function get_form(e){for(;"FORM"!=e.tagName;){if(void 0===e)return!1;e=e.parentNode}return e}function check(e,t){if(form_obj=get_form(e),!form_obj)return alert("Could not find form"),!1;for(i=0;i<form_obj.length;)"checkbox"==form_obj.elements[i].type&&(form_obj.elements[i].checked=t),i++;return!1}function check_all(e){return target=findTarget(e),check(target,!0),cancelClick(e),!1}function uncheck_all(e){return target=findTarget(e),check(target,!1),cancelClick(e),!1}function cancelClick(e){return window.event&&window.event.returnValue&&(window.event.returnValue=!1),e&&e.preventDefault&&e.preventDefault(),!1}function surround_check(e,t,n){var r=findTarget(e);for(el_form=get_form(r),el_inputs=el_form.getElementsByTagName("INPUT"),i=0;i<el_inputs.length;i++)el_input=el_inputs[i],"checkbox"==el_input.type&&(null!=n&&el_input.checked!=n||(el_input.parentNode.className=t))}function surround_unchecked(e){surround_check(e,"checkbox_surround",!1)}function surround_checked(e){surround_check(e,"checkbox_surround",!0)}function unsurround_all(e){surround_check(e,"checkbox_surround_init",null)}function init_check_all(){for(var e=document.getElementsByName("check_all_nocheckchanges"),t=0;t<e.length;t++){var n=e[t];jQuery(n).bind({click:check_all,mouseover:surround_unchecked,mouseout:unsurround_all})}var r=document.getElementsByName("uncheck_all_nocheckchanges");for(t=0;t<r.length;t++){n=r[t];jQuery(n).bind({click:uncheck_all,mouseover:surround_checked,mouseout:unsurround_all})}}function clear_form(e){for(e=check(e,!1),i=0;i<e.length;)"text"==e.elements[i].type&&(e.elements[i].value=""),i++;return e}function focus_on_first_input(){if(all_inputs=document.getElementsByTagName("input"),all_inputs.length)for(i=0;i<all_inputs.length;i++)if("text"==all_inputs[i].type&&1!=all_inputs[i].disabled){try{all_inputs[i].focus()}catch(e){}break}}function check_combo(e){var t=jQuery(e),n=t.next();t.find("option:first").is(":selected")?(n.show().focus(),"required"==t.attr("required")&&n.attr("required","required")):(n.hide(),n.removeAttr("required"))}function input_decorated_help(e,t){function n(){""!=r.value&&r.value!=t||(r.style.color="#666",r.value=t)}var r=document.getElementById(e);jQuery(r).bind("blur",n),jQuery(r).bind("focus",function(){r.style.color="",r.value==t&&(r.value="")}),jQuery(r.form).bind("submit",function(){r.value==t&&(r.value="")}),n()}function findTarget(e){var t;if(window.event&&window.event.srcElement?t=window.event.srcElement:e&&e.target&&(t=e.target),!t)return null;for(;t!=document.body&&"a"!=t.nodeName.toLowerCase();)t=t.parentNode;return"a"!=t.nodeName.toLowerCase()?null:t}function addSpinner(e){(e=jQuery(e)).addClass("btn-spinner"),e.css("width","+=24px")}function checkInputLength(e,t,n){e.value.length<t?e.setCustomValidity(n):e.setCustomValidity("")}function check_extracat(e){for(var t=e.value,n=document.getElementsByName("post_extracats[]"),r=0;r<n.length;r++){var i=n[r];i.value==t&&(i.checked=!0)}}function init_dynamicSelect(){for(var e=0;e<nb_dynamicSelects;e++)dynamicSelect(tab_dynamicSelects[e].parent,tab_dynamicSelects[e].child)}function dynamicSelect(e,t){if(document.getElementById&&document.getElementsByTagName){var n=document.getElementById(e),r=document.getElementById(t),i=r.cloneNode(!0).getElementsByTagName("option");refreshDynamicSelectOptions(n,r,i),n.onchange=function(){refreshDynamicSelectOptions(n,r,i)}}}function refreshDynamicSelectOptions(e,t,n){for(;t.options.length;)t.remove(0);for(var r=new RegExp("^"+e.options[e.selectedIndex].value+"-.*$"),i=0;i<n.length;i++)!n[i].value.match(r)&&""!=n[i].value||t.appendChild(n[i].cloneNode(!0))}function toggle_clickopen(e,t,n){if(!(clickdiv=document.getElementById("clickdiv_"+e))||!(clickimg=document.getElementById("clickimg_"+e)))return alert("ID "+e+" not found!"),!1;if(void 0===t&&(t="none"!=clickdiv.style.display),void 0===n&&(n=""),clickimg=jQuery(clickimg),clickimg.hasClass("fa")||clickimg.hasClass("glyphicon")){if(""!=clickimg.data("toggle")){var r=clickimg.hasClass("fa")?"fa":"glyphicon";null==clickimg.data("toggle-orig-class")&&clickimg.data("toggle-orig-class",clickimg.attr("class").replace(new RegExp("^"+r+" (.+)$","g"),"$1")),clickimg.hasClass(clickimg.data("toggle-orig-class"))?clickimg.removeClass(clickimg.data("toggle-orig-class")).addClass(r+"-"+clickimg.data("toggle")):clickimg.removeClass(r+"-"+clickimg.data("toggle")).addClass(clickimg.data("toggle-orig-class"))}}else{var i=clickimg.css("background-position").match(/-*\d+/g);clickimg.css("background-position",parseInt(i[0])+(t?16:-16)+"px "+parseInt(i[1])+"px")}return clickdiv.style.display=t?"none":n,!1}function evoFadeSuccess(e){evoFadeBg(e,new Array("#ddff00","#bbff00"))}function evoFadeFailure(e){evoFadeBg(e,new Array("#9300ff","#ff000a","#ff0000"))}function evoFadeHighlight(e){evoFadeBg(e,new Array("#ffbf00","#ffe79f"))}function evoFadeBg(selector,bgs,options){var origBg=jQuery(selector).css("backgroundColor"),speed=options&&options.speed||'"slow"',toEval="jQuery(selector).animate({ backgroundColor: ";for(e in bgs)"string"==typeof bgs[e]&&(toEval+='"'+bgs[e]+'"}, '+speed+" ).animate({ backgroundColor: ");toEval+="origBg }, "+speed+', "", function(){jQuery( this ).css( "backgroundColor", "" );});',eval(toEval)}function b2edit_open_preview(e,t){var n=jQuery(e);if(0==n.length)return location.href=t,!1;if("b2evo_preview"==n.attr("target"))return!1;var r=n.attr("action");return n.attr("action",t),n.attr("target","b2evo_preview"),preview_window=window.open("","b2evo_preview"),preview_window.focus(),n.submit(),n.attr("action",r),n.attr("target","_self"),!1}function b2edit_reload(e,t,n,r,i){var o=jQuery(e);if(0==o.length||0==o.find("input[type=hidden][name^=crumb_]").length)return location.href=t,!1;o.attr("action",t);if((0<o.find('[name="actionArray[update]"]').length?o.append('<input type="hidden" name="action" value="edit_switchtab" />'):0<o.find('[name="actionArray[create]"]').length?o.append('<input type="hidden" name="action" value="new_switchtab" />'):o.append('<input type="hidden" name="action" value="switchtab" />'),!0)&&void 0!==r)for(param in r)o.append('<input type="hidden" name="'+param+'" value="'+r[param]+'" />');return void 0!==n&&"undefined"!=n&&(null==n&&(n=""),o.find('[name="blog"]').val(n)),window.onbeforeunload=null,void 0!==i&&1==i&&o.reset(),o.submit(),!1}function b2edit_type(e,t,n){var r=!1;return 0<bozo.nb_changes&&(r=!confirm(e)),b2edit_reload("#item_checkchanges",t,null,{action:n},r)}function b2edit_confirm(e,t,n){return!(0<bozo.nb_changes&&!confirm(e))&&b2edit_reload("#item_checkchanges",t,null,{action:n},!1)}function get_whois_info(t){var n=jQuery(window).height()-40;return openModalWindow('<span id="spinner" class="loader_img loader_user_report absolute_center" title="'+evo_js_lang_whois_title+'"></span>',"90%",n+"px",!0,"WHOIS - "+t,!0,!0),jQuery.ajax({type:"GET",url:htsrv_url+"async.php",data:{action:"get_whois_info",query:t,window_height:n},success:function(e){ajax_response_is_correct(e)&&openModalWindow(e=ajax_debug_clear(e),"90%",n+"px",!0,"WHOIS - "+t,!0)}}),!1}jQuery(document).on("change",".btn-file :file",function(){var e=jQuery(this).val().replace(/\\/g,"/").replace(/.*\//,"");jQuery(this).parent().next().html(e)});var edit_icon_tag="",delete_icon_tag="",current_widgets="",reorder_widgets_queue,reorder_delay=200,reorder_delay_remaining=0,crumb_url="";function makeDragnDrop(e){makeDraggable(e),makeDroppable(e)}function makeDraggable(e){jQuery(e).draggable({helper:"clone",scroll:!0,scrollSensitivity:100,zIndex:999,opacity:.8,cursor:"move",cancel:"input,textarea,button,select,option,a,span.fa,span.widget_checkbox",start:function(){jQuery(this).hide()},stop:function(){jQuery(this).show()}}).addClass("draggable_widget")}function makeDroppable(e){jQuery(e).droppable({accept:".draggable_widget",hoverClass:"droppable-hover",greedy:!0,tolerance:"pointer",delay:1e3,drop:function(e,t){jQuery(".fade_me").removeClass("fade_me"),jQuery(".available_widgets").removeClass("available_widgets_active"),jQuery(this).hasClass("available_widgets")?jQuery(t.draggable).hasClass("new_widget")||jQuery(t.draggable).remove():jQuery(t.draggable).hasClass("new_widget")?addNewWidget(t.draggable,this):(jQuery(t.draggable).insertAfter(this),jQuery(t.draggable).addClass("fade_me server_update"),jQuery(t.draggable).droppable("enable")),doFade(".fade_me"),colourWidgets(),sendWidgetOrder()}})}function doFade(e){jQuery(e).addClass("evo_highlight"),setTimeout(function(){jQuery(e).removeClass("evo_highlight")},5e3)}function sendWidgetOrder(){reorder_delay_remaining<1&&jQuery("#server_messages").html('<div class="log_container"><div class="log_error"></div></div>'),reorder_delay_remaining=reorder_delay,bufferedServerCall()}function sendWidgetOrderCallback(e){doFade(".server_updating"),jQuery(".server_updating").removeClass("server_updating"),colourWidgets()}function bufferedServerCall(){var e=getWidgetOrder();e!=current_widgets?(jQuery("#server_messages").html('<div class="action_messages container-fluid"><ul><li><div class="alert alert-dismissible alert-info fade in">'+T_("Saving changes")+"</div></li></ul></div>"),current_widgets=e,e+="&"+crumb_url,jQuery(".pending_update").removeClass("pending_update").addClass("server_updating"),SendAdminRequest("widgets","re-order",e,!1)):(jQuery("#server_messages").html('<div class="action_messages container-fluid"><ul><li><div class="alert alert-dismissible alert-warning fade in">'+T_("Widget order unchanged")+"</div></li></ul></div>"),jQuery(".pending_update").removeClass("pending_update"),colourWidgets())}function getWidgetOrder(){var t=new Array;jQuery(".widget_container").each(function(){var e=jQuery(this).attr("id");t[e]="",jQuery("#"+e+" .draggable_widget").each(function(){jQuery(this).attr("id")&&"undefined"!=jQuery(this).attr("id")&&(t[e]+=jQuery(this).attr("id")+", ")})});var e="",n="";for(container in t)e+=container+"="+t[container]+"&",n+=container+",";return("undefined"!=typeof blog?"blog="+blog:"")+"&"+e+"container_list="+n}function colourWidgets(){jQuery(".draggable_widget").removeClass("odd"),jQuery(".draggable_widget").removeClass("even");var e=!1;jQuery("#current_widgets .draggable_widget").each(function(){e=!e,jQuery(this).addClass(e?"even":"odd")})}function deleteWidget(e){return jQuery("#wi_ID_"+e.substr(6,e.length)).animate({backgroundColor:"#f88"},"fast",function(){jQuery(this).remove(),colourWidgets(),sendWidgetOrder()}),!1}function editWidget(e){return jQuery("#server_messages").html(""),msg="wi_ID="+e.substr(6,e.length)+"&"+crumb_url,SendAdminRequest("widgets","edit",msg,!0),!1}function widgetSettings(e,t,n){jQuery("body").append('<div id="screen_mask" onclick="closeWidgetSettings()"></div><div id="widget_settings" class="modal-content"></div>'),jQuery("#screen_mask").fadeTo(1,.5).fadeIn(200),jQuery("#widget_settings").html(e).addClass("widget_settings_active edit_widget_"+t+"_"+n),jQuery("#widget_settings").prepend(jQuery("#server_messages")),AttachServerRequest("widget_checkchanges");var r=jQuery("#widget_settings").find("form > h2.page-title:first");if(0<r.length){var i=r.parent().children("span.global_icons"),o="";0<i.length&&(i.find("a.close_link").remove(),o='<span class="pull-right">'+i.html()+"</span>",i.remove()),jQuery("#widget_settings").prepend('<div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>'+o+'<h4 class="modal-title">'+r.html()+"</h4></div>"),r.remove(),jQuery("#widget_settings button.close").bind("click",closeWidgetSettings)}jQuery("#widget_settings a.close_link").bind("click",closeWidgetSettings)}function widgetSettingsCallback(e,t,n){jQuery("#wi_ID_"+e+" .widget_name").html(t),jQuery("#wi_ID_"+e+" .widget_cache_status").html(getWidgetCacheIcon("wi_ID_"+e,n))}function closeWidgetSettings(e){if(!jQuery("#widget_settings").is(":visible"))return!1;if("undefined"!=typeof bozo&&(void 0===e||"update"!=e)){if(bozo.validate_close()&&!confirm(bozo.validate_close()))return!1;bozo.reset_changes()}return jQuery("#widget_settings").hide(),jQuery("#server_messages").insertBefore(".available_widgets"),jQuery("#widget_settings").remove(),jQuery("#screen_mask").remove(),!1}function showMessagesWidgetSettings(e){return void 0!==e&&"success"==e&&"undefined"!=typeof bozo&&bozo.reset_changes(),jQuery("#widget_settings").animate({scrollTop:jQuery("#widget_settings").scrollTop()+ +jQuery("#server_messages").position().top-20},100),!1}function T_(e){return void 0===T_arr[e]?e:T_arr[e]}function convertAvailableList(){jQuery(".fieldset_title > span > a[id^='add_new']").attr("href","#").bind("click",function(e){jQuery("body").append('<div id="screen_mask" onclick="closeAvailableWidgets()"></div>'),jQuery("#screen_mask").fadeTo(1,.5).fadeIn(200),offset=jQuery(this).offset();var t=offset.top,n=jQuery(document).height()-10-jQuery(".available_widgets").height();return n<20&&(n=20),n<t&&(t=n),jQuery(".available_widgets").addClass("available_widgets_active").attr("id","available_"+jQuery(this).attr("id")),!1}),jQuery(".available_widgets_toolbar > a").bind("click",function(e){return closeAvailableWidgets(),!1}),jQuery(".available_widgets li").each(function(){jQuery(this).addClass("new_widget");var e=jQuery(this).children("a").attr("href");e=e.substr(e.indexOf("&type")+1,e.length),jQuery(this).children("a:first").attr("href","#").bind("click",function(){return addNewWidget(this,e),!1})})}function closeAvailableWidgets(){if(!jQuery(".available_widgets").is(":visible"))return!1;jQuery(".available_widgets").removeClass("available_widgets_active"),jQuery("#screen_mask").remove()}function addNewWidget(e,t){closeAvailableWidgets();var n=jQuery(e).attr("id");jQuery(e).attr("id",n);jQuery(e).html();var r=jQuery(".available_widgets").attr("id");r=r.substr(18,r.length).replace(/_/g," ").replace(/-/g,":"),SendAdminRequest("widgets","create",t+"&blog="+blog+"&container="+r,!0)}function addNewWidgetCallback(e,t,n,r,i,o){jQuery(".fade_me").removeClass("fade_me"),createWidget("wi_ID_"+e,t.replace(/ /g,"_").replace(/:/g,"-"),n,r,"",1,i,o),doFade("#wi_ID_"+e),0<reorder_delay_remaining?reorder_delay_remaining=0:current_widgets=getWidgetOrder()}function createWidget(e,t,n,r,i,o,a,s){var l=jQuery('<li id="'+e+'" class="draggable_widget"><span class="widget_title">'+r+"</span></li>");l.find("a.widget_name").click(function(){return editWidget(e)}),i&&jQuery(l).addClass(i),jQuery(l).prepend(jQuery('<span class="widget_state">'+(a?disabled_plugin_tag:'<a href="#" class="toggle_action" onclick="return toggleWidget( \''+e+"' );\">"+(o?enabled_icon_tag:disabled_icon_tag)+"</a>")+"</span>")),jQuery(l).prepend(jQuery('<span class="widget_checkbox'+(o?" widget_checkbox_enabled":"")+'"><input type="checkbox" name="widgets[]" value="'+e.replace("wi_ID_","")+'" '+(a?'disabled="disabled" ':"")+"/></span>"));var d=jQuery('<span class="widget_cache_status">'+getWidgetCacheIcon(e,s)+"</span>");jQuery(l).append(d);var _='<span class="widget_actions"><a href="#" class="toggle_action" onclick="return toggleWidget( \''+e+"' );\""+(a?' style="visibility: hidden">':">")+(o?deactivate_icon_tag:activate_icon_tag)+"</a>";_+='<a href="#" onclick="return editWidget( \''+e+"' );\">"+edit_icon_tag+'</a><a href="#" onclick="return deleteWidget( \''+e+"' );\">"+delete_icon_tag+"</a></span>",_=jQuery(_),jQuery(l).append(_),jQuery("#container_"+t).append(l),makeDragnDrop("#"+e),colourWidgets()}function toggleWidget(e){return SendAdminRequest("widgets","toggle","wi_ID="+e.substr(6)+"&"+crumb_url,!0),!1}function doToggle(e,t,n){n?(jQuery("#wi_ID_"+e+" .widget_state").html(disabled_plugin_tag),jQuery("#wi_ID_"+e+" .toggle_action").css("visibility","hidden")):(jQuery("#wi_ID_"+e+" .toggle_action").css("visibility","visible"),jQuery("#wi_ID_"+e+" .widget_state").html('<a href="#" class="toggle_state" onclick="return toggleWidget( \'wi_ID_'+e+"', '"+crumb_url+"' );\">"+(t?enabled_icon_tag:disabled_icon_tag)+"</a>")),t?jQuery("#wi_ID_"+e+" .widget_checkbox").addClass("widget_checkbox_enabled"):jQuery("#wi_ID_"+e+" .widget_checkbox").removeClass("widget_checkbox_enabled"),jQuery("#wi_ID_"+e+" .toggle_action").html(t?deactivate_icon_tag:activate_icon_tag),doFade("#wi_ID_"+e)}function toggleCacheWidget(e,t){return SendAdminRequest("widgets","cache_"+t,"wi_ID="+e.substr(6)+"&"+crumb_url,!0),!1}function doToggleCache(e,t){jQuery("#wi_ID_"+e+" .widget_cache_status").html(getWidgetCacheIcon("wi_ID_"+e,t)),doFade("#wi_ID_"+e)}function str_repeat(e,t){return new Array(t+1).join(e)}function getWidgetCacheIcon(e,t){switch(t){case"enabled":return'<a href="#" class="cache_action" onclick="return toggleCacheWidget( \''+e+"', 'disable' );\">"+cache_enabled_icon_tag+"</a>";case"disabled":return'<a href="#" class="cache_action" onclick="return toggleCacheWidget( \''+e+"', 'enable' );\">"+cache_disabled_icon_tag+"</a>";case"disallowed":return cache_disallowed_icon_tag;case"denied":return'<a href="?ctrl=coll_settings&amp;tab=advanced&amp;blog='+blog+'#fieldset_wrapper_caching">'+cache_denied_icon_tag+"</a>"}}function shortlinks_load_window(e,t){var n;switch(e){case"move_comment_to_post":n=shortlinks_title_move_comment_to_post,shortlinks_action_buttons='<button id="shortlinks_btn_move_comment" class="btn btn-primary">'+shortlinks_move_to_post+"</button>";break;case"shortlinks":n=shortlinks_title_link_to_post,shortlinks_action_buttons='<button id="shortlinks_btn_insert" class="btn btn-primary">'+shortlinks_insert_short_link+'</button><button id="shortlinks_btn_options" class="btn btn-default">'+shortlinks_insert_with_options+'...</button><button id="shortlinks_btn_form" class="btn btn-info">'+shortlinks_insert_snippet_link+"...</button>"}openModalWindow('<div id="shortlinks_wrapper"></div>',"auto","",!0,n,["-","shortlinks_post_buttons"],!0),shortlinks_load_colls(shortlinks_coll_urlname,t);var r=jQuery("#shortlinks_wrapper").parent(),i=jQuery(window).height()-20;return r.hasClass("modal-body")&&(i-=119+parseInt(r.css("padding-top"))+parseInt(r.css("padding-bottom"))),r.css({display:"block",overflow:"auto","max-height":i}),!1}function shortlinks_api_print_error(e,t,n){if("string"!=typeof t&&void 0===t.code&&(t=void 0===t.responseJSON?t.statusText:t.responseJSON),void 0===t.code)var r='<h4 class="text-danger">Unknown error: '+t+"</h4>";else{r='<h4 class="text-danger">'+t.message+"</h4>";n&&(r+="<div><b>Code:</b> "+t.code+"</div><div><b>Status:</b> "+t.data.status+"</div>")}shortlinks_end_loading(e,r)}function shortlinks_api_request(e,t,n,r){shortlinks_start_loading(t),void 0===r&&(r={}),jQuery.ajax({url:restapi_url+e,data:r}).then(n,function(e){shortlinks_api_print_error(t,e)})}function shortlinks_start_loading(e){jQuery(e).addClass("shortlinks_loading").append('<div class="shortlinks_loader">loading...</div>')}function shortlinks_end_loading(e,t){jQuery(e).removeClass("shortlinks_loading").html(t).find(".shortlinks_loader").remove()}function shortlinks_get_pagination(e,t){var n="";if(void 0===e.pages_total||e.pages_total<2)return n;var r,i,o=void 0===t?"":' data-search="'+t.replace('"','"')+'"',a=e.page,s=e.pages_total;for(r=a<=parseInt(5.5)?1:a>s-parseInt(5.5)?Math.max(1,s-11+1):a-parseInt(5.5),i=a>s-parseInt(5.5)?s:Math.min(s,r+11-1),n+='<ul class="shortlinks_pagination pagination"'+o+">",1<a&&(n+='<li><a href="#" data-page="'+(a-1)+'">&lt;&lt;</a></li>'),1<r&&(n+='<li><a href="#" data-page="1">1</a></li>',2<r&&(n+='<li><a href="#" data-page="'+Math.ceil(r/2)+'">...</a></li>')),p=r;p<=i;p++)a==p?n+='<li class="active"><span>'+p+"</span></li>":n+='<li><a href="#" data-page="'+p+'">'+p+"</a></li>";return i<s&&(i<s-1&&(n+='<li><a href="#" data-page="'+(i+Math.floor((s-i)/2))+'">...</a></li>'),n+='<li><a href="#" data-page="'+s+'">'+s+"</a></li>"),a<s&&(n+='<li><a href="#" data-page="'+(a+1)+'">&gt;&gt;</a></li>'),n+="</ul>"}function shortlinks_load_colls(a,s){shortlinks_api_request("collections","#shortlinks_wrapper",function(e){var t="",n="",r='<div id="shortlinks_colls_list"><h2>'+shortlinks_collections+'</h2><select class="form-control" id="shortlinks_collections">';for(var i in e.colls){var o=e.colls[i];r+='<option value="'+o.urlname+'" data-coll-id="'+o.id+'" '+(a==o.urlname?' selected="selected"':"")+">"+o.shortname+" : "+o.name+"</option>",""!=t&&o.urlname!=a||(t=o.urlname,n=o.name)}shortlinks_end_loading("#shortlinks_wrapper",r+='</select></div><div id="shortlinks_posts_block"></div><div id="shortlinks_post_block"></div><input type="hidden" id="shortlinks_hidden_prefix" value="'+(s||"")+'" /><div id="shortlinks_post_form" style="display:none"><input type="hidden" id="shortlinks_hidden_ID" /><input type="hidden" id="shortlinks_hidden_cover_link" /><input type="hidden" id="shortlinks_hidden_teaser_link" /><input type="hidden" id="shortlinks_hidden_urltitle" /><input type="hidden" id="shortlinks_hidden_title" /><input type="hidden" id="shortlinks_hidden_excerpt" /><input type="hidden" id="shortlinks_hidden_teaser" /><p><label><input type="checkbox" id="shortlinks_form_full_cover" /> '+shortlinks_insert_full_cover_image+'</label><p><p><label><input type="checkbox" id="shortlinks_form_title" checked="checked" /> '+shortlinks_insert_title+'</label><p><p><label><input type="checkbox" id="shortlinks_form_thumb_cover" checked="checked" /> '+shortlinks_insert_thumbnail_of_cover+'</label><p><p><label><input type="checkbox" id="shortlinks_form_excerpt" checked="checked" /> '+shortlinks_insert_excerpt+'</label><p><p><label><input type="checkbox" id="shortlinks_form_teaser" /> '+shortlinks_insert_teaser+'</label><p><p><label><input type="checkbox" id="shortlinks_form_more" checked="checked" /> '+shortlinks_insert_read_more_link+'</label><p></div><div id="shortlinks_post_options" class="form-horizontal" style="display:none"><div class="form-group"><label class="control-label col-sm-2">'+shortlinks_slug+':</label><div class="controls col-sm-10"><input type="text" id="shortlinks_opt_slug" class="form-control" style="width:100%" /></div></div><div class="form-group"><label class="control-label col-sm-2">'+shortlinks_mode+':</label><div class="controls col-sm-10"><div class="radio"><label><input type="radio" name="shortlinks_opt_mode" id="shortlinks_opt_mode_title" checked="checked"><code>[[...]]</code> '+shortlinks_use_title+'</label></div><div class="radio"><label><input type="radio" name="shortlinks_opt_mode" id="shortlinks_opt_mode_slug"><code>((...))</code> '+shortlinks_use_slug_words+'</label></div></div></div><div class="form-group"><label class="control-label col-sm-2">'+shortlinks_classes+':</label><div class="controls col-sm-10"><input type="text" id="shortlinks_opt_classes" class="form-control" style="width:100%" /></div></div><div class="form-group"><label class="control-label col-sm-2">'+shortlinks_target+':</label><div class="controls col-sm-10"><select id="shortlinks_opt_target" class="form-control"><option value="">'+shortlinks_none+'</option><option value="_blank">'+shortlinks_blank+'</option><option value="_parent">'+shortlinks_parent+'</option><option value="_top">'+shortlinks_top+'</option></select></div></div><div class="form-group"><label class="control-label col-sm-2">'+shortlinks_text+':</label><div class="controls col-sm-10"><input type="text" id="shortlinks_opt_text" class="form-control" style="width:100%" /></div></div></div>'),""!=t&&shortlinks_load_coll_posts(t,n)},{list_in_frontoffice:"all",per_page:-1})}function shortlinks_display_search_form(e,t,n){var r="<h2>"+t+'</h2><form class="form-inline" id="shortlinks_search__form" data-urlname="'+e+'"><div class="input-group"><input type="text" id="shortlinks_search__input" class="form-control" value="'+(void 0===n?"":n)+'"><span class="input-group-btn"><button id="shortlinks_search__submit" class="btn btn-primary">'+shortlinks_search+'</button></span></div> <button id="shortlinks_search__clear" class="btn btn-default">'+shortlinks_clear+'</button></form><div id="shortlinks_posts_list"></div>';jQuery("#shortlinks_posts_block").html(r)}function shortlinks_load_coll_posts(i,e,t){void 0!==e&&!1!==e&&shortlinks_display_search_form(i,e),shortlinks_api_request("collections/"+i+"/items&orderby=datemodified&order=DESC"+(void 0===t||t<2?"":"&page="+t),"#shortlinks_posts_list",function(e){var t="<ul>";for(var n in e.items){var r=e.items[n];t+='<li><a href="#" data-id="'+r.id+'" data-urlname="'+i+'">'+r.title+"</a></li>"}t+="</ul>",shortlinks_end_loading("#shortlinks_posts_list",t+=shortlinks_get_pagination(e))})}function shortlinks_load_coll_search(i,o,e){shortlinks_api_request("collections/"+i+"/search/"+o+"&kind=item"+(void 0===e||e<2?"":"&page="+e),"#shortlinks_posts_list",function(e){if(void 0===e.code){var t="<ul>";for(var n in e.results){var r=e.results[n];"item"==r.kind&&(t+="<li>",t+='<a href="#" data-id="'+r.id+'" data-urlname="'+i+'">'+r.title+"</a>",t+="</li>")}t+="</ul>",shortlinks_end_loading("#shortlinks_posts_list",t+=shortlinks_get_pagination(e,o))}else shortlinks_api_print_error("#shortlinks_posts_list",e)})}if(jQuery(document).ready(function(){if(0!=jQuery("#current_widgets").length){edit_icon_tag=jQuery(".edit_icon_hook").find("a").html(),delete_icon_tag=jQuery(".delete_icon_hook").find("a").html(),void 0!==(crumb_url=jQuery(".delete_icon_hook").find("a").attr("href"))&&(crumb_url=crumb_url.match(/crumb_.*?$/)),jQuery(".new_widget").parent().parent().remove(),jQuery(".odd").addClass("widget_row").removeClass(".odd"),jQuery(".even").addClass("widget_row").removeClass(".even"),jQuery(".fieldset_title").each(function(){jQuery(this).droppable({accept:".draggable_widget",hoverClass:"droppable-hover",greedy:!0,tolerance:"pointer",delay:1e3,drop:function(e,t){jQuery(".fade_me").removeClass("fade_me"),jQuery(".available_widgets").removeClass("available_widgets_active"),jQuery(t.draggable).prependTo(jQuery("#container_"+jQuery(this).find(".container_name").data("container-name").replace(/ /g,"_").replace(/:/g,"-"))),jQuery(t.draggable).addClass("fade_me server_update"),jQuery(t.draggable).droppable("enable"),doFade(".fade_me"),colourWidgets(),sendWidgetOrder()}})}),jQuery(".widget_row td:nth-child(7)").each(function(){var e=jQuery(this).find("a").attr("href");e=e.match(/wi_ID=([0-9]+)/)[1],jQuery(this).parent().attr("id","wi_ID_"+e)});var n=new Array;for(container in jQuery(".widget_container_list").each(function(){var t=jQuery(this).attr("id");n[t]=new Array,jQuery("#"+t+" .widget_row").each(function(){var e=jQuery(this).attr("id");n[t][e]=new Array,n[t][e].name=jQuery("#"+e).find(".widget_name").parent().html(),n[t][e].class=jQuery(this).attr("className"),n[t][e].enabled=jQuery("#"+e+" .widget_is_enabled").size(),n[t][e].plugin_disabled=jQuery("#"+e+" .plugin_is_disabled").size(),n[t][e].cache=jQuery("#"+e+" .widget_cache_status [rel]").attr("rel")})}),n){var e=!jQuery("#"+container).hasClass("no-drop");for(widget in newContainer=jQuery('<ul id="container_'+container+'" class="widget_container"></ul>'),e||jQuery(newContainer).addClass("no-drop"),jQuery("#"+container).replaceWith(newContainer),n[container])createWidget(widget,container,0,n[container][widget].name,n[container][widget].class,n[container][widget].enabled,n[container][widget].plugin_disabled,n[container][widget].cache)}jQuery(".no-drop .draggable_widget").droppable("disable"),jQuery(".draggable_widget").bind("mousedown",function(){jQuery(this).hasClass("new_widget")||jQuery(".available_widgets_active").removeClass("available_widgets_active")}),colourWidgets(),convertAvailableList(),current_widgets=getWidgetOrder(),doFade(".evo_highlight"),jQuery("#widget_button_check_all").click(function(){jQuery(this).closest("form").find("input[type=checkbox]:enabled").prop("checked",!0)}),jQuery("#widget_button_uncheck_all").click(function(){jQuery(this).closest("form").find("input[type=checkbox]").prop("checked",!1)}),jQuery("#widget_button_check_active").click(function(){jQuery(this).closest("form").find(".widget_checkbox.widget_checkbox_enabled input[type=checkbox]:enabled").prop("checked",!0),jQuery(this).closest("form").find(".widget_checkbox:not(.widget_checkbox_enabled) input[type=checkbox]").prop("checked",!1)}),jQuery("#widget_button_check_inactive").click(function(){jQuery(this).closest("form").find(".widget_checkbox.widget_checkbox_enabled input[type=checkbox]").prop("checked",!1),jQuery(this).closest("form").find(".widget_checkbox:not(.widget_checkbox_enabled) input[type=checkbox]:enabled").prop("checked",!0)}),jQuery(document).keyup(function(e){27==e.keyCode&&(closeWidgetSettings(),closeAvailableWidgets())})}}),"undefined"==typeof b2evo_shortlinks_initialized){function shortlinks_insert_link_text(e){"undefined"!=typeof tinyMCE&&void 0!==tinyMCE.activeEditor&&tinyMCE.activeEditor&&tinyMCE.execCommand("mceFocus",!1,tinyMCE.activeEditor.id),textarea_wrap_selection(window[jQuery("#shortlinks_hidden_prefix").val()+"b2evoCanvas"],e,"",0),closeModalWindow()}function shortlinks_insert_complex_link(e,t){var n="";void 0!==e&&""!=e&&(n+="\r\n"+e),jQuery("#shortlinks_form_title").is(":checked")&&(n+="\r\n## [["+jQuery("#shortlinks_hidden_urltitle").val()+" "+jQuery("#shortlinks_hidden_title").val()+"]]"),void 0!==t&&""!=t&&(n+="\r\n"+t),jQuery("#shortlinks_form_excerpt").is(":checked")&&(n+=(void 0!==t&&""!=t?" ":"\r\n")+jQuery("#shortlinks_hidden_excerpt").val()),jQuery("#shortlinks_form_teaser").is(":checked")&&(n+="\r\n"+jQuery("#shortlinks_hidden_teaser").val()),jQuery("#shortlinks_form_more").is(":checked")&&(n+="\r\n[["+jQuery("#shortlinks_hidden_urltitle").val()+" "+shortlinks_read_more+"...]]"),""!=n&&(n+="\r\n\r\n"),"undefined"!=typeof tinyMCE&&void 0!==tinyMCE.activeEditor&&tinyMCE.activeEditor&&tinyMCE.execCommand("mceFocus",!1,tinyMCE.activeEditor.id),textarea_wrap_selection(window[jQuery("#shortlinks_hidden_prefix").val()+"b2evoCanvas"],n,"",0),closeModalWindow()}b2evo_shortlinks_initialized=!0,jQuery(document).on("change","#shortlinks_colls_list select",function(){return shortlinks_load_coll_posts(jQuery(this).val(),jQuery("option:selected",this).text()),!1}),jQuery(document).on("submit","#shortlinks_search__form",function(){return shortlinks_load_coll_search(jQuery(this).data("urlname"),jQuery("#shortlinks_search__input").val()),!1}),jQuery(document).on("click","#shortlinks_search__clear",function(){return shortlinks_load_coll_posts(jQuery(this).closest("form").data("urlname")),jQuery("#shortlinks_search__input").val(""),!1}),jQuery(document).on("click","#shortlinks_posts_list a[data-id]",function(){var e=jQuery(this).data("urlname"),t=jQuery(this).data("id");return jQuery("#shortlinks_colls_list, #shortlinks_posts_block").hide(),jQuery("#shortlinks_post_block").show(),jQuery("#shortlinks_post_block").data("post")==t?jQuery("#shortlinks_btn_back_to_list, #shortlinks_btn_insert").show():(jQuery("#shortlinks_post_block").html(""),shortlinks_api_request("collections/"+e+"/items/"+t,"#shortlinks_post_block",function(e){jQuery("#shortlinks_post_block").data("post",e.id),jQuery("#shortlinks_hidden_ID").val(e.id),jQuery("#shortlinks_hidden_urltitle").val(e.urltitle),jQuery("#shortlinks_hidden_title").val(e.title),jQuery("#shortlinks_hidden_excerpt").val(e.excerpt),jQuery("#shortlinks_hidden_teaser").val(e.teaser),jQuery("#shortlinks_hidden_cover_link").val(""),jQuery("#shortlinks_hidden_teaser_link").val(""),jQuery("#shortlinks_hidden_coll_ID").val();var t="<h2>"+e.title+"</h2>";if("object"==typeof e.attachments&&0<e.attachments.length)for(var n in e.attachments){var r=e.attachments[n];"image"==r.type&&("cover"==r.position&&jQuery("#shortlinks_hidden_cover_link").val(r.link_ID),""==jQuery("#shortlinks_hidden_teaser_link").val()&&jQuery("#shortlinks_hidden_teaser_link").val(r.link_ID))}shortlinks_end_loading("#shortlinks_post_block",t+='<div id="shortlinks_post_content">'+e.content.replace(/(<h([1-6]).*id\s*=\s*"[^"]+"[^>]*>.+?)(<\/h\2>)/gi,'$1 <button class="btn btn-primary shortlinks_btn_insert_anchor">'+shortlinks_insert_short_link+"</button>$3")+"</div>");var i=jQuery(".shortlinks_post_buttons").length?jQuery(".shortlinks_post_buttons"):jQuery("#shortlinks_post_content");jQuery("#shortlinks_btn_back_to_list, #shortlinks_btn_move_comment, #shortlinks_btn_insert, #shortlinks_btn_form, #shortlinks_btn_options").remove(),i.after('<button id="shortlinks_btn_back_to_list" class="btn btn-default">&laquo; '+shortlinks_back+"</button>"+shortlinks_action_buttons),jQuery("#shortlinks_opt_slug").val(e.urltitle)})),!1}),jQuery(document).on("click","#shortlinks_btn_move_comment",function(){var e=jQuery(".comment_item_title")[0];e.innerHTML=jQuery("#shortlinks_hidden_title").val(),e.href="?ctrl=items&blog="+jQuery("#shortlinks_collections").find(":selected").data("coll-id")+"&p="+jQuery("#shortlinks_hidden_ID").val(),shortlinks_coll_urlname=jQuery("#shortlinks_collections").find(":selected").val(),jQuery('input[name="moveto_post"]').val(jQuery("#shortlinks_hidden_ID").val()),closeModalWindow()}),jQuery(document).on("click","#shortlinks_btn_insert",function(){shortlinks_insert_link_text("[["+jQuery("#shortlinks_hidden_urltitle").val()+"]]")}),jQuery(document).on("click",".shortlinks_btn_insert_anchor",function(){var e=jQuery(this).parent();shortlinks_insert_link_text("(("+jQuery("#shortlinks_hidden_urltitle").val()+"#"+e.attr("id")+" "+e.html().replace(/(\s<a[^>]+>.+?<\/a>)?\s<button[^>]+>.+?<\/button>$/,"")+"))")}),jQuery(document).on("click","#shortlinks_btn_insert_with_options",function(){if(jQuery("#shortlinks_opt_mode_title").is(":checked"))var e="[[",t="]]";else e="((",t="))";var n=e;n+=jQuery("#shortlinks_opt_slug").val();var r=jQuery("#shortlinks_opt_classes").val().trim();""!=(r=r.replace(/^\./g,"").replace(/\s+/g,".").replace(/\.+/g,"."))&&(n+=" ."+r);var i=jQuery("#shortlinks_opt_target option:selected").val().trim();""!=i&&(n+=" "+i);var o=jQuery("#shortlinks_opt_text").val().trim();""!=o&&(n+=" "+o),shortlinks_insert_link_text(n+=t)}),jQuery(document).on("click","#shortlinks_btn_form",function(){jQuery("#modal_window .modal-title").html(shortlinks_insert_snippet_link),jQuery("#shortlinks_post_block, #shortlinks_btn_insert").hide(),jQuery("#shortlinks_post_form").show();var e=jQuery(".shortlinks_post_buttons").length?jQuery(".shortlinks_post_buttons"):jQuery("#shortlinks_post_content");return jQuery("#shortlinks_btn_back_to_list, #shortlinks_btn_move_comment, #shortlinks_btn_insert, #shortlinks_btn_form, #shortlinks_btn_options").hide(),e.after('<button id="shortlinks_btn_back_to_post" class="btn btn-default">&laquo; '+shortlinks_back+'</button><button id="shortlinks_btn_insert_complex" class="btn btn-primary">'+shortlinks_insert_snippet_link+"</button>"),!1}),jQuery(document).on("click","#shortlinks_btn_insert_complex",function(){if(!jQuery("input[id^=shortlinks_form_]").is(":checked"))return alert(shortlinks_select_item),!1;var e=!1,t=!1;jQuery("input[type=hidden][name=temp_link_owner_ID]").length?(e="temporary",t=jQuery("input[type=hidden][name=temp_link_owner_ID]").val()):jQuery("input[type=hidden][name=post_ID]").length&&jQuery("input[type=hidden][name=item_typ_ID]").length?(e="item",t=jQuery("input[type=hidden][name=post_ID]").val()):jQuery("input[type=hidden][name=comment_ID]").length||jQuery("input[type=hidden][name=comment_item_ID]").length?(e="comment",jQuery("input[type=hidden][name=comment_ID]").length&&(t=jQuery("input[type=hidden][name=comment_ID]").val())):jQuery("input[type=hidden][name=ecmp_ID]").length?(e="emailcampaign",t=jQuery("input[type=hidden][name=ecmp_ID]").val()):jQuery("input[name=msg_text]").length&&(e="message",t=0);var n=jQuery("#shortlinks_form_full_cover").is(":checked")&&""!=jQuery("#shortlinks_hidden_cover_link").val()||jQuery("#shortlinks_form_thumb_cover").is(":checked")&&""!=jQuery("#shortlinks_hidden_teaser_link").val();if(n&&0!=e&&0<t){shortlinks_start_loading("#shortlinks_post_block");var r="";jQuery("#shortlinks_form_full_cover").is(":checked")&&!jQuery("#shortlinks_form_thumb_cover").is(":checked")&&(r="cover"),evo_rest_api_request("links",{action:"copy",source_type:"item",source_object_ID:jQuery("#shortlinks_hidden_ID").val(),source_position:r,source_file_type:"image",dest_type:e,dest_object_ID:t,dest_position:"inline",limit_position:1},function(e){var t="",n="";for(var r in e.links){var i=e.links[r];"cover"==i.orig_position&&jQuery("#shortlinks_form_full_cover").is(":checked")&&(t="[image:"+i.ID+"]"),jQuery("#shortlinks_form_thumb_cover").is(":checked")&&(n="[thumbnail:"+i.ID+"]")}shortlinks_insert_complex_link(t,n),shortlinks_end_loading("#shortlinks_post_block",jQuery("#shortlinks_post_block").html());var o=jQuery("a[onclick*=evo_link_refresh_list]");o.length&&o.click()})}else n&&alert("Please save your "+e+" before trying to attach files. This limitation will be removed in a future version of b2evolution."),shortlinks_insert_complex_link();return!1}),jQuery(document).on("click","#shortlinks_btn_options",function(){jQuery("#modal_window .modal-title").html(shortlinks_insert_with_options+"..."),jQuery("#shortlinks_post_block, #shortlinks_btn_insert").hide(),jQuery("#shortlinks_post_options").show();var e=jQuery(".shortlinks_post_buttons").length?jQuery(".shortlinks_post_buttons"):jQuery("#shortlinks_post_content");return jQuery("#shortlinks_btn_back_to_list, #shortlinks_btn_insert, #shortlinks_btn_form, #shortlinks_btn_options").hide(),e.after('<button id="shortlinks_btn_back_to_post" class="btn btn-default">&laquo; '+shortlinks_back+'</button><button id="shortlinks_btn_insert_with_options" class="btn btn-primary">'+shortlinks_insert_link+"</button>"),!1}),jQuery(document).on("click","#shortlinks_btn_back_to_list",function(){return jQuery("#shortlinks_colls_list, #shortlinks_posts_block").show(),jQuery("#shortlinks_post_block, #shortlinks_btn_back_to_list, #shortlinks_btn_insert, #shortlinks_btn_form, #shortlinks_btn_options").hide(),!1}),jQuery(document).on("click","#shortlinks_btn_back_to_post",function(){return jQuery("#modal_window .modal-title").html(shortlinks_link_to_post),jQuery("#shortlinks_post_block, #shortlinks_btn_back_to_list, #shortlinks_btn_insert, #shortlinks_btn_form, #shortlinks_btn_options").show(),jQuery("#shortlinks_btn_back_to_post, #shortlinks_btn_insert_complex, #shortlinks_btn_insert_with_options, #shortlinks_post_form, #shortlinks_post_options").hide(),!1}),jQuery(document).on("click",".shortlinks_pagination a",function(){var e=jQuery("#shortlinks_colls_list select"),t=jQuery(this).closest(".shortlinks_pagination");return null==t.data("search")?shortlinks_load_coll_posts(e.val(),!1,jQuery(this).data("page")):shortlinks_load_coll_search(e.val(),t.data("search"),jQuery(this).data("page")),!1})}var modal_window_js_initialized=!1;function openModalWindow(e,t,n,r,i,o,a,s,l,d,_){var c=void 0===t||"auto"==t?"":"width:"+t+";",u=void 0===n||0==n||""==n?"":"height:"+n,p=u.match(/%$/i)?' style="height:100%;overflow:hidden;"':"",h=n.match(/px/i)?' style="min-height:'+(n.replace("px","")-157)+'px"':"",g=void 0===o||0!=o;if(void 0!==o&&""!=o)if("object"==typeof o)var v=o[0],m=o[1],f=void 0===o[2]?"form":o[2];else v=o,m="btn-primary",f="form";if(void 0!==a&&a&&jQuery("#modal_window").remove(),0==jQuery("#modal_window").length){var y='<div id="modal_window" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true"><div class="modal-dialog" style="'+c+u+'"><div class="modal-content"'+p+">";if(void 0!==i&&""!=i&&(y+='<div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title">'+i+"</h4></div>"),y+='<div class="modal-body"'+p+h+">"+e,l){jQuery("#"+l);y+="<script>jQuery( document ).ready( function() {var iframe = jQuery( '#"+l+"' );iframe.on( 'load', function() {iframe.closest( '.modal-body' ).find( 'span.loader_img' ).remove();setModalIFrameUnload( '"+l+"' );});});<\/script>"}y+="</div>",g&&(y+='<div class="modal-footer">',void 0!==o&&""!=o&&(y+='<button class="btn '+m+'" type="submit" style="display:none">'+v+"</button>"),y+='<button class="btn btn-default" data-dismiss="modal" aria-hidden="true">'+evo_js_lang_close+"</button></div>"),y+="</div></div></div>",jQuery("body").append(y)}else jQuery("#modal_window .modal-body").html(e);void 0!==l?jQuery("#"+l).load(function(){prepareModalWindow(jQuery(this).contents(),f,g,s),jQuery("#modal_window .loader_img").remove(),jQuery("#"+l).show()}):prepareModalWindow("#modal_window",f,g,s),"function"==typeof d&&jQuery("#modal_window").on("shown.bs.modal",d);var b={};modal_window_js_initialized&&(b="show"),jQuery("#modal_window").modal(b),c||(jQuery("#modal_window .modal-dialog").css({display:"table",width:"auto"}),jQuery("#modal_window .modal-dialog .modal-content").css({display:"table-cell"})),jQuery("#modal_window").on("hidden.bs.modal",function(){jQuery(this).remove(),"function"==typeof _&&_()}),modal_window_js_initialized=!0}function prepareModalWindow(e,t,n,r){n&&(void 0!==r&&r||(jQuery("legend",e).remove(),jQuery("#close_button",e).remove(),jQuery(".panel, .panel-body",e).removeClass("panel panel-default panel-body")),0==jQuery(t+" input[type=submit]",e).length?jQuery("#modal_window .modal-footer button[type=submit]").hide():(jQuery(t+" input[type=submit]",e).hide(),jQuery("#modal_window .modal-footer button[type=submit]").show()),jQuery(t,e).change(function(){var e=jQuery(this).find("input[type=submit]");0<e.length?(e.hide(),jQuery("#modal_window .modal-footer button[type=submit]").show()):jQuery("#modal_window .modal-footer button[type=submit]").hide()}),jQuery("#modal_window .modal-footer button[type=submit]").off("click"),jQuery("#modal_window .modal-footer button[type=submit]").on("click",function(){1!==jQuery(this).data("click_init")&&(jQuery(t+" input[type=submit]",e).click(),jQuery(this).data("click_init",1))})),jQuery(t+" a.btn",e).each(function(){jQuery("#modal_window .modal-footer").prepend("<a href="+jQuery(this).attr("href")+'><button type="button" class="'+jQuery(this).attr("class")+'">'+jQuery(this).html()+"</button></a>"),jQuery(this).remove()}),0<jQuery(t+" #current_modal_title",e).length&&jQuery("#modal_window .modal-title").html(jQuery(t+" #current_modal_title",e).html())}function closeModalWindow(e,t){return void 0===e&&(e=window.document),"function"==typeof t&&jQuery("#modal_window").on("hidden.bs.modal",t),jQuery("#modal_window",e).modal("hide"),!1}function setModalIFrameUnload(e){var n=jQuery("#"+e);n[0].contentWindow.onunload=function(){var e=n.closest(".modal-body"),t=jQuery('<span class="loader_img absolute_center" title="'+evo_js_lang_loading+'"></span>');jQuery(e).prepend(t)}}function user_crop_avatar(e,t,n){void 0===n&&(n="avatar");var r=750,i=jQuery(window).width(),o=jQuery(window).height(),a=o/i,s=10,l=10;s=320<(i=r<i?r:i<320?320:i)-2*s?10:0,l=320<(o=r<o?r:o<320?320:o)-2*l?10:0;var d=r<i?r:i,_=r<o?r:o;openModalWindow('<span id="spinner" class="loader_img loader_user_report absolute_center" title="'+evo_js_lang_loading+'"></span>',d+"px",_+"px",!0,evo_js_lang_crop_profile_pic,[evo_js_lang_crop,"btn-primary"],!0);var c=jQuery("div.modal-dialog div.modal-body").length?jQuery("div.modal-dialog div.modal-body"):jQuery("#overlay_page"),u=parseInt(c.css("paddingTop")),p=parseInt(c.css("paddingRight")),h=parseInt(c.css("paddingBottom")),g=parseInt(c.css("paddingLeft")),v=(jQuery("div.modal-dialog div.modal-body").length?parseInt(c.css("min-height")):_-100)-(u+h),m={user_ID:e,file_ID:t,aspect_ratio:a,content_width:d-(g+p),content_height:v,display_mode:"js",crumb_user:evo_js_crumb_user};return evo_js_is_backoffice?(m.ctrl="user",m.user_tab="crop",m.user_tab_from=n):(m.blog=evo_js_blog,m.disp="avatar",m.action="crop"),jQuery.ajax({type:"POST",url:evo_js_user_crop_ajax_url,data:m,success:function(e){openModalWindow(e,d+"px",_+"px",!0,evo_js_lang_crop_profile_pic,[evo_js_lang_crop,"btn-primary"])}}),!1}function user_report(e,t){openModalWindow('<span class="loader_img loader_user_report absolute_center" title="'+evo_js_lang_loading+'"></span>',"auto","",!0,evo_js_lang_report_user,[evo_js_lang_report_this_user_now,"btn-danger"],!0);var n={action:"get_user_report_form",user_ID:e,crumb_user:evo_js_crumb_user};return evo_js_is_backoffice?(n.is_backoffice=1,n.user_tab=t):n.blog=evo_js_blog,jQuery.ajax({type:"POST",url:evo_js_user_report_ajax_url,data:n,success:function(e){openModalWindow(e,"auto","",!0,evo_js_lang_report_user,[evo_js_lang_report_this_user_now,"btn-danger"])}}),!1}function user_deldata(e,t){return openModalWindow('<span class="loader_img loader_user_deldata absolute_center" title="'+evo_js_lang_loading+'"></span>',"auto","",!0,evo_js_lang_delete_user_data,[evo_js_lang_delete_selected_data,"btn-danger"],!0),jQuery.ajax({type:"POST",url:evo_js_user_deldata_ajax_url,data:{ctrl:"user",user_tab:"deldata",user_tab_from:t,user_ID:e,display_mode:"js",crumb_user:evo_js_crumb_user},success:function(e){openModalWindow(e,"auto","",!0,evo_js_lang_delete_user_data,[evo_js_lang_delete_selected_data,"btn-danger"])}}),!1}function user_add_org(e){return openModalWindow('<span class="loader_img loader_user_deldata absolute_center" title="'+evo_js_lang_loading+'"></span>',"450px","",!0,evo_js_lang_add_user_to_organization,evo_js_lang_add,!0),jQuery.ajax({type:"POST",url:evo_js_user_org_ajax_url,data:{ctrl:"organizations",action:"add_user",org_ID:e,display_mode:"js",crumb_user:evo_js_crumb_organization},success:function(e){openModalWindow(e,"450px","",!0,evo_js_lang_add_user_to_organization,evo_js_lang_add),jQuery("input.autocomplete_login").trigger("added")}}),!1}function user_edit(e,t){return openModalWindow('<span class="loader_img loader_user_deldata absolute_center" title="'+evo_js_lang_loading+'"></span>',"450px","",!0,evo_js_lang_edit_membership,evo_js_lang_edit,!0),jQuery.ajax({type:"POST",url:evo_js_user_org_ajax_url,data:{ctrl:"organizations",action:"edit_user",org_ID:e,user_ID:t,display_mode:"js",crumb_user:evo_js_crumb_organization},success:function(e){openModalWindow(e,"450px","",!0,evo_js_lang_edit_membership,evo_js_lang_edit)}}),!1}function user_remove(e,t){return openModalWindow('<span class="loader_img loader_user_deldata absolute_center" title="'+evo_js_lang_loading+'"></span>',"450px","",!0,'<span class="text-danger">'+evo_js_lang_remove_user_membership+"</span>",evo_js_lang_remove,!0),jQuery.ajax({type:"POST",url:evo_js_user_org_ajax_url,data:{ctrl:"organizations",action:"remove_user",org_ID:e,user_ID:t,display_mode:"js",crumb_user:evo_js_crumb_organization},success:function(e){openModalWindow(e,"450px","",!0,'<span class="text-danger">'+evo_js_lang_remove_user_membership+"</span>",evo_js_lang_remove)}}),!1}function add_user_automation(e){return openModalWindow('<span class="loader_img loader_add_user_automation absolute_center" title="'+evo_js_lang_loading+'"></span>',"auto","",!0,evo_js_lang_add_user_to_automation,evo_js_lang_add,!0),jQuery.ajax({type:"POST",url:evo_js_user_automation_ajax_url,data:{ctrl:"user",user_tab:"automation",user_ID:e,display_mode:"js",crumb_user:evo_js_crumb_user},success:function(e){openModalWindow(e,"auto","",!0,evo_js_lang_add_user_to_automation,evo_js_lang_add)}}),!1}function add_userlist_automation(){return openModalWindow('<span class="loader_img loader_add_userlist_automation absolute_center" title="'+evo_js_lang_loading+'"></span>',"auto","",!0,evo_js_lang_add_current_selection_to_automation,evo_js_lang_add_selected_users_to_automation,!0),jQuery.ajax({type:"POST",url:evo_js_userlist_automation_ajax_url,data:{ctrl:"users",action:"automation",display_mode:"js"},success:function(e){openModalWindow(e,"auto","",!0,evo_js_lang_add_current_selection_to_automation,evo_js_lang_add_selected_users_to_automation)}}),!1}function requeue_automation(e,t,n,r,i){var o=evo_js_lang_requeue_automation_for_finished_steps;return void 0!==r?o=evo_js_lang_requeue_automation_for_user.replace("%s",i):void 0!==t&&(o=evo_js_lang_requeue_automation_for_step_users.replace("%s",n)),openModalWindow('<span class="loader_img loader_requeue_automation absolute_center" title="'+evo_js_lang_loading+'"></span>',"auto","",!0,o,evo_js_lang_requeue,!0),jQuery.ajax({type:"POST",url:evo_js_requeue_automation_ajax_url,data:{ctrl:"automations",action:"requeue_form",autm_ID:e,source_step_ID:void 0===t?0:t,source_user_ID:void 0===r?0:r,display_mode:"js"},success:function(e){openModalWindow(e,"auto","",!0,o,evo_js_lang_requeue)}}),!1}function add_remove_userlist_tags(){return openModalWindow('<span class="loader_img loader_add_userlist_automation absolute_center" title="'+evo_js_lang_loading+'"></span>',"auto","",!0,evo_js_lang_add_remove_tags_to_users,evo_js_lang_make_changes_now,!0),jQuery.ajax({type:"POST",url:evo_js_userlist_tags_ajax_url,data:{ctrl:"users",action:"edit_tags",display_mode:"js"},success:function(e){openModalWindow(e,"auto","",!0,evo_js_lang_add_remove_tags_to_users,evo_js_lang_make_changes_now)}}),!1}function set_account_status(){return openModalWindow('<span class="loader_img loader_set_user_account_status absolute_center" title="'+evo_js_lang_loading+'"></span>',"500px","",!0,evo_js_lang_set_user_account_status,evo_js_lang_make_changes_now,!0),jQuery.ajax({type:"POST",url:evo_js_userlist_set_account_status_ajax_url,data:{ctrl:"users",action:"set_status",display_mode:"js"},success:function(e){openModalWindow(e,"500px","",!0,evo_js_lang_set_user_account_status,evo_js_lang_make_changes_now)}}),!1}function change_groups(){return openModalWindow('<span class="loader_img loader_change_groups absolute_center" title="'+evo_js_lang_loading+'"></span>',"500px","",!0,evo_js_lang_change_groups,evo_js_lang_make_changes_now,!0),jQuery.ajax({type:"POST",url:evo_js_userlist_change_groups_ajax_url,data:{ctrl:"users",action:"change_groups",display_mode:"js"},success:function(e){openModalWindow(e,"500px","",!0,evo_js_lang_change_groups,evo_js_lang_make_changes_now)}}),!1}function evo_rest_api_request(url,params_func,func_method,method){var params=params_func,func=func_method;"function"==typeof params_func&&(func=params_func,params={},method=func_method),void 0===method&&(method="GET"),jQuery.ajax({contentType:"application/json; charset=utf-8",type:method,url:restapi_url+url,data:params}).then(function(data,textStatus,jqXHR){"object"==typeof jqXHR.responseJSON&&eval(func)(data,textStatus,jqXHR)})}function evo_rest_api_print_error(e,t,n){if("string"!=typeof t&&void 0===t.code&&(t=void 0===t.responseJSON?t.statusText:t.responseJSON),void 0===t.code)var r='<h4 class="text-danger">Unknown error: '+t+"</h4>";else{r='<h4 class="text-danger">'+t.message+"</h4>";n&&(r+="<div><b>Code:</b> "+t.code+"</div><div><b>Status:</b> "+t.data.status+"</div>")}evo_rest_api_end_loading(e,r)}function evo_rest_api_start_loading(e){jQuery(e).addClass("evo_rest_api_loading").append('<div class="evo_rest_api_loader">loading...</div>')}function evo_rest_api_end_loading(e,t){jQuery(e).removeClass("evo_rest_api_loading").html(t).find(".evo_rest_api_loader").remove()}function evo_link_initialize_fieldset(n){if(0<jQuery("#"+n+"attachments_fieldset_table").length){var e=jQuery("#"+n+"attachments_fieldset_table").height();e=320<e?320:e<97?97:e,jQuery("#"+n+"attachments_fieldset_wrapper").height(e),jQuery("#"+n+"attachments_fieldset_wrapper").resizable({minHeight:80,handles:"s",resize:function(e,t){jQuery("#"+n+"attachments_fieldset_wrapper").resizable("option","maxHeight",jQuery("#"+n+"attachments_fieldset_table").height()),evo_link_update_overlay(n)}}),jQuery(document).on("click","#"+n+"attachments_fieldset_wrapper .ui-resizable-handle",function(){var e=jQuery("#"+n+"attachments_fieldset_table").height(),t=jQuery("#"+n+"attachments_fieldset_wrapper").height()+80;jQuery("#"+n+"attachments_fieldset_wrapper").css("height",e<t?e:t),evo_link_update_overlay(n)})}}function evo_link_update_overlay(e){jQuery("#"+e+"attachments_fieldset_overlay").length&&jQuery("#"+e+"attachments_fieldset_overlay").css("height",jQuery("#"+e+"attachments_fieldset_wrapper").closest(".panel").height())}function evo_link_fix_wrapper_height(e){var t=void 0===e?"":e,n=jQuery("#"+t+"attachments_fieldset_table").height();jQuery("#"+t+"attachments_fieldset_wrapper").height()!=n&&jQuery("#"+t+"attachments_fieldset_wrapper").height(jQuery("#"+t+"attachments_fieldset_table").height())}function evo_link_change_position(n,e,t){var r=n,i=n.value,o=n.id.substr(17);return jQuery.get(e+"anon_async.php?action=set_object_link_position&link_ID="+o+"&link_position="+i+"&crumb_link="+t,{},function(e,t){"OK"==(e=ajax_debug_clear(e))?(evoFadeSuccess(jQuery(r).closest("tr")),jQuery(r).closest("td").removeClass("error"),"cover"==i&&jQuery("select[name=link_position][id!="+n.id+"] option[value=cover]:selected").each(function(){jQuery(this).parent().val("aftermore"),evoFadeSuccess(jQuery(this).closest("tr"))})):(jQuery(r).val(e),evoFadeFailure(jQuery(r).closest("tr")),jQuery(r.form).closest("td").addClass("error"))}),!1}function evo_link_insert_inline(e,t,n,r,i){if(null==r&&(r=0),"undefined"!=typeof b2evoCanvas){var o="["+e+":"+t;n.length&&(o+=":"+n),o+="]",void 0!==i&&!1!==i&&(o+=i+"[/"+e+"]");var a=jQuery("#display_position_"+t);0!=a.length&&"inline"!=a.val()?(deferInlineReminder=!0,evo_rest_api_request("links/"+t+"/position/inline",function(e){a.val("inline"),evoFadeSuccess(a.closest("tr")),a.closest("td").removeClass("error"),textarea_wrap_selection(b2evoCanvas,o,"",r,window.document)},"POST"),deferInlineReminder=!1):textarea_wrap_selection(b2evoCanvas,o,"",r,window.document)}}function evo_link_delete(n,r,i,e){return evo_rest_api_request("links/"+i,{action:e},function(e){if("item"==r||"comment"==r||"emailcampaign"==r||"message"==r){var t=window.b2evoCanvas;if(null!=t)textarea_str_replace(t,new RegExp("\\[(image|file|inline|video|audio|thumbnail):"+i+":?[^\\]]*\\]","ig"),"",window.document)}jQuery(n).closest("tr").remove(),evo_link_fix_wrapper_height()},"DELETE"),!1}function evo_link_change_order(l,e,d){return evo_rest_api_request("links/"+e+"/"+d,function(e){var t=jQuery(l).closest("tr"),n=t.find("span[data-order]");if("move_up"==d){var r=n.attr("data-order"),i=jQuery(t.prev()).find("span[data-order]"),o=i.attr("data-order");t.prev().before(t),n.attr("data-order",o),i.attr("data-order",r)}else{r=n.attr("data-order");var a=jQuery(t.next()).find("span[data-order]"),s=a.attr("data-order");t.next().after(t),n.attr("data-order",s),a.attr("data-order",r)}evoFadeSuccess(t)},"POST"),!1}function evo_link_attach(e,t,n,r){return evo_rest_api_request("links",{action:"attach",type:e,object_ID:t,root:n,path:r},function(e){var t=jQuery("#attachments_fieldset_table .results table",window.parent.document),n=(t.parent,jQuery(e.list_content));t.replaceWith(jQuery("table",n)).promise().done(function(e){setTimeout(function(){window.parent.evo_link_fix_wrapper_height()},10)})}),!1}function evo_link_ajax_loading_overlay(){var e=jQuery("#attachments_fieldset_table"),t=!1;return 0==e.find(".results_ajax_loading").length&&(t=jQuery('<div class="results_ajax_loading"><div>&nbsp;</div></div>'),e.css("position","relative"),t.css({width:e.width(),height:e.height()}),e.append(t)),t}function evo_link_refresh_list(e,t,n){var r=evo_link_ajax_loading_overlay();return r&&evo_rest_api_request("links",{action:void 0===n?"refresh":"sort",type:e.toLowerCase(),object_ID:t},function(e){jQuery("#attachments_fieldset_table").html(e.html),r.remove(),evo_link_fix_wrapper_height()}),!1}function evo_link_sort_list(n){var r,i=jQuery("#"+n+"attachments_fieldset_table tbody.filelist_tbody tr");i.sort(function(e,t){var n=parseInt(jQuery("span[data-order]",e).attr("data-order")),r=parseInt(jQuery("span[data-order]",t).attr("data-order"));return(n=n||i.length)<(r=r||i.length)?-1:r<n?1:0}),$.each(i,function(e,t){r=(0===e?jQuery(t).prependTo("#"+n+"attachments_fieldset_table tbody.filelist_tbody"):jQuery(t).insertAfter(r),t)})}jQuery(document).ready(function(){jQuery("img.loadimg").each(function(){jQuery(this).prop("complete")?(jQuery(this).removeClass("loadimg"),""==jQuery(this).attr("class")&&jQuery(this).removeAttr("class")):jQuery(this).on("load",function(){jQuery(this).removeClass("loadimg"),""==jQuery(this).attr("class")&&jQuery(this).removeAttr("class")})})});